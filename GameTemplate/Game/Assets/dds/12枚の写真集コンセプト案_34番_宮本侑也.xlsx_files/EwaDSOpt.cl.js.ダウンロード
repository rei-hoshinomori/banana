'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1023:function(u,C,a){a.d(C,"a",function(){return c});u=a(0);class c extends Sys.EventArgs{constructor(b,f,e,d){super();this.type=b;this.y$=f;this.Uvh=e;this.bra=d}}Object(u.a)(c,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1024:function(u,C,a){a.d(C,"a",function(){return c});u=a(0);class c{}c.oVd="rr";c.yFj="rd";c.wFj="rbp";c.EWd="sa";Object(u.a)(c,"RtcReconnectParams",null,[])},1025:function(u,C,a){a.d(C,
"a",function(){return c});u=a(0);class c{constructor(b,f,e,d){this.FVi=b;this.nEa=f;this.MUi=e;this.Pii=d}}Object(u.a)(c,"ThrottlerManagerSettings",null,[])},1207:function(u,C,a){u=a(0);class c extends Sys.EventArgs{constructor(G,F){super();this.newState=G;this.oldState=F}}Object(u.a)(c,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class b extends Sys.EventArgs{constructor(G,F){super();this.Ueh=G;this.bra=F}}Object(u.a)(b,"ClientInfoEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(G){super();
this.presence=G}}Object(u.a)(f,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(G){super();this.W8c=G}}Object(u.a)(e,"PersistentStateClearedEventArgs",Sys.EventArgs,[]);class d extends Sys.EventArgs{constructor(G,F){super();this.type=G;this.fK=F}}Object(u.a)(d,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var h=a(1372);class l extends Sys.EventArgs{constructor(G,F=null){super();this.dI=G;this.ZPg=F}get type(){return this.dI}get y$(){return this.ZPg}}Object(u.a)(l,
"UpdateNotificationEventArgs",Sys.EventArgs,[]);class k extends Sys.EventArgs{constructor(){super()}}Object(u.a)(k,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class n extends Sys.EventArgs{constructor(G,F,O,M,P,B){super();this.skb=G;this.n$c=F;this.Fih=O;this.l2e=P;this.w8c=M;this.stopwatch=B}}Object(u.a)(n,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(G){super();this.hubConnection=G}}Object(u.a)(v,"RefreshProxyEventArgs",
Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(G,F){super();this.errorMessage=F}}Object(u.a)(x,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(G,F,O){super();this.type=G;this.presence=F;this.bra=O}}Object(u.a)(w,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var r=a(1023);class t extends Sys.EventArgs{constructor(){super()}}Object(u.a)(t,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class A extends Sys.EventArgs{constructor(G){super();
this.W8c=G}}Object(u.a)(A,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(G,F){super();this.type=G;this.ehk=F}}Object(u.a)(y,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var z=a(105);a.d(C,"a",function(){return E});class E{constructor(){this.$a=new z.a}yoj(G,F){this.$a.raiseEvent("CSC",new c(G,F))}qpj(G){this.$a.raiseEvent("RP",new v(G))}syc(G){this.$a.raiseEvent("RC",G)}spj(){this.$a.raiseEvent("RMID")}ppj(G,F,O,M,P,B){this.$a.raiseEvent("RPS",
new n(G,F,O,M,P,B))}v_f(G,F){this.$a.raiseEvent("UPSR",new y(G,F))}e_f(G,F){this.$a.raiseEvent("PU",new h.a(G,F))}apj(G){this.$a.raiseEvent("MPU",new f(G))}uPd(G,F,O,M){this.$a.raiseEvent("SUN",new r.a(G,F,O,M))}Hpj(G,F){this.$a.raiseEvent("UNR",new l(G,F))}n_f(G,F,O){this.$a.raiseEvent("SP",new w(G,F,O))}jpj(G,F){this.$a.raiseEvent("PSU",new d(G,F))}ipj(G){this.$a.raiseEvent("PSC",new e(G))}Voj(G){this.$a.raiseEvent("IPSC",new e(G))}Ipj(G){this.$a.raiseEvent("UPSC",new A(G))}wpj(G,F){this.$a.raiseEvent("SPC",
new t(G,F))}k_f(G,F){this.$a.raiseEvent("RCF",new x(G,F))}Poj(G){this.$a.raiseEvent("CPSWM",new k(G))}Gpj(G,F){this.$a.raiseEvent("UCI",new b(G,F))}G4(G){this.$a.addHandler("CSC",G)}t9(G){this.$a.removeHandler("CSC",G)}AYg(G){this.$a.addHandler("RP",G)}zYg(G){this.$a.addHandler("RC",G)}EYg(G){this.$a.addHandler("RMID",G)}yYg(G){this.$a.addHandler("RPS",G)}nZg(G){this.$a.addHandler("UPSR",G)}q1a(G){this.$a.addHandler("PU",G)}ZTa(G){this.$a.removeHandler("PU",G)}jXg(G){this.$a.addHandler("IPU",G)}lZg(G){this.$a.addHandler("UCI",
G)}RYg(G){this.$a.addHandler("SUN",G)}kXg(G){this.$a.addHandler("IUNR",G)}t1a(G){this.$a.addHandler("UNR",G)}MOb(G){this.$a.removeHandler("UNR",G)}J4b(G){this.$a.addHandler("PSU",G)}gAc(G){this.$a.removeHandler("PSU",G)}iXg(G){this.$a.addHandler("IPSU",G)}hXg(G){this.$a.addHandler("IPSC",G)}mZg(G){this.$a.addHandler("UPSC",G)}QYg(G){this.$a.addHandler("SP",G)}TYg(G){this.$a.addHandler("SPC",G)}static getInstance(){return E.Oa||(E.Oa=new E)}}E.Oa=null;Object(u.a)(E,"RtcEventHub",null,[829])},1235:function(u,
C,a){a.r(C);u=a(0);var c=a(15),b=a(88),f=a(199),e=a(914);class d{}d.Vbb="throttling_messageDelay";d.UFb="enabled";d.nEa="throttling_timeToWaitForResponse";d.Obb="throttling_maxNumberOfOutstandingMessages";d.vgf="throttling_globalMaxNumberOfOutstandingMessages";d.errorMessage="errorMessage";d.yjg="url";d.h9="queryString";d.VD="connectionString";Object(u.a)(d,"RtcFindSessionOutputFieldNameConstants",null,[]);var h=a(6),l=a(82),k=a(41),n=a(470),v=a(714),x=a(115),w=a(34),r=a(185);class t{constructor(){this.wgf=
this.vDf=this.wDf=this.CDf=0;this.Poc=!1;this.correlationId=this.VD=this.h9=this.o$c=this.errorMessage=null}get Hhh(){return this.o$c+"?"+this.h9}}Object(u.a)(t,"FindSessionResponse",null,[]);class A{}A.clientId="ClientId";A.Dhk="UserApp";A.userSessionId="usid";A.userType="UserType";A.Whk="UserVersion";A.hyc="qs";A.Yeh="clientProtocol";A.xYi="NoAuth";Object(u.a)(A,"RtcFindSessionInputQueryParamConstants",null,[]);class y{constructor(I,S,J,L,R,Y){this.OHa=null;const {FindSessionStrategy:Q}=a(1235);
this.sMg=I;I=String.format("{0}={1}",A.clientId,w.a.Rf(L));I=String.format("{0}&{1}={2}",I,A.userSessionId,w.a.Rf(R));I=String.format("{0}&{1}={2}",I,A.Dhk,w.a.Rf(J.toString()));I=String.format("{0}&{1}={2}",I,A.userType,w.a.Rf("1"));I=String.format("{0}&{1}={2}",I,A.Whk,w.a.Rf(S));I=String.format("{0}&{1}={2}",I,A.Yeh,w.a.Rf(Q.Weh));(S=y.Q_h(J,Y))&&(I=String.format("{0}&{1}",I,S));this.QEg=I}O1f(){this.OHa=this.sMg()}Hkd(){this.OHa&&""!==this.OHa||(this.O1f(),c.ULS.sendTraceTag(575784194,500,this.OHa&&
""!==this.OHa?50:15,"Query signature delegate called for refresh returned: {0} ",this.OHa));const I=String.format("{0}={1}",A.hyc,w.a.Rf(this.OHa));return String.format("{0}&{1}",I,this.QEg)}static Q_h(I,S){return 4===I?String.format("{0}={1}",A.xYi,"1"):S?S.yhi():null}}Object(u.a)(y,"FindSessionQueryStringGenerator",null,[]);var z=a(986),E=a(913),G=a(751),F=a(1025);class O{}O.lTh="FSType";Object(u.a)(O,"RtcFindSessionRequestHeaders",null,[]);class M{}M.grj="polling";Object(u.a)(M,"RtcFindSessionTypes",
null,[]);var P=a(1024);class B{}B.ujk="RTC-TokenProofkey";B.KJi="RTC-IsWacJsBootFsRequest";Object(u.a)(B,"RtcRequestHeaders",null,[]);a.d(C,"FindSessionStrategy",function(){return D});class D{constructor(I,S,J,L,R,Y,Q,W,Ga,pa,aa,Z,fa=null){this.Uje=(new Date(0)).getTime();this.ele=0;this.r_b=!1;this.Iqe=null;this.EQd=36E5;this.JYa=D.rmf;this.Jmb=0;this.lUa=null;this.ega=0;this.Agb=this.JMe=null;this.WMg=[d.UFb,d.errorMessage,d.yjg,d.VD,d.h9,d.vgf,d.Obb,d.nEa,d.Vbb];this.VMg=[d.UFb,d.errorMessage];
this.VD=this.sRa=null;this.zfe=new y(aa?aa:()=>h.AFrameworkApplication.ej,R,Y,Q,I,S);this.slb=Z;this.gi=L;this.lh=S;this.QGg=J;this.Ym=W;this.Eh=Ga;this.Tmb=fa;this.Afe=!1;this.kfc=9E4;pa&&pa.execute(ya=>{ya.dsb(()=>{c.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Ym);this.zfe.O1f()})});2>=100*Math.random()&&(this.EQd=3E5);z.a.instance&&(z.a.instance.d6e=this.EQd)}SPj(I){this.Agb=I}init(){this.Eh.EYg(Object(b.a)(this,this.KCj,"resetGetMachineIdDelay"));
this.Eh.G4(Object(b.a)(this,this.wX,"onConnectionStateChanged"))}wX(I,S){this.ega=S.newState;2===S.newState&&(this.Jmb=0)}t$e(){let I;I=this.lUa.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.lUa.h9,D.RNe,w.a.Rf(I)),correlationId:I}}odi(I,S,J,L,R){this.DJj(()=>{L(R,"GetMachineIdSuccess")&&(c.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.VD,this.Ym),I(this.Iqe),J(this.igi()))},Y=>{L(R,"GetMachineIdFailure")&&(c.ULS.sendTraceTag(4060129,
500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Ym),S(Y))},L,R)}Vyh(){this.WJe();this.kri()}DJj(I,S,J,L){c.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.VD);if(this.VD)I();else{var R=this.G$g();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(I,S,J,L)},R)}}sendFindSessionRequestToServerInternal(I,S,J,L){J(L,"RequestMachineId")&&(this.Uje=(new Date).getTime(),J=k.a.ve(),this.u$e(R=>{const Y=
k.a.ve();this.LUf(R);this.iYd();I();R=k.a.ve()-Y;c.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",R)},R=>{const Y=k.a.ve();this.WJe();z.a.instance&&z.a.instance.rz(2,3);S(R);R=k.a.ve()-Y;c.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",R)},!1),J=k.a.ve()-J,c.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",J))}kri(){this.JYa+=D.p9h;this.JYa=Math.min(this.JYa,D.zUi)}G$g(){var I=(new Date).getTime();I=this.Uje+this.JYa-I;0>I&&(I=0);return I}LUf(I){try{this.lUa=
I,this.sRa=I.Hhh,this.VD=I.VD,this.JMe=I.h9,this.Iqe=I.o$c}catch(S){c.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",S.toString())}}WJe(){this.VD=null;this.XJe()}iYd(){this.XJe();this.r_b=!0;this.ele=window.setTimeout(Object(b.a)(this,this.Osj,"refreshMachineId"),this.EQd)}XJe(){this.r_b&&(window.clearTimeout(this.ele),this.r_b=!1)}Osj(){this.r_b=!1;this.u$e(I=>{const S=this.JMe!==I.h9,J=this.VD!==I.VD,L=this.VD;this.LUf(I);0!==this.ega&&
(J?(c.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",L||"null",I.VD),this.Eh.syc()):(this.Eh.wpj(S,J),this.iYd()))},()=>{z.a.instance&&z.a.instance.rz(2,3);this.iYd()},!0)}KCj(){this.JYa=D.rmf}igi(){return new F.a(this.lUa.CDf,this.lUa.wDf,this.lUa.vDf,this.lUa.wgf)}a9j(I){if(Object.getType(I)!==Object)return null;for(let S in I);return this.Nnh(I)}Nnh(I){if(!(d.UFb in I))return null;const S=I[d.UFb];var J=S?this.WMg:this.VMg;for(const L of J)if(!(L in
I))return null;J=Object.assign(new t,{Poc:I[d.UFb],errorMessage:I[d.errorMessage],correlationId:r.a.create().toString()});S&&(J.o$c=I[d.yjg],J.h9=I[d.h9],J.VD=I[d.VD],J.wgf=I[d.vgf],J.vDf=I[d.Obb],J.wDf=I[d.nEa],J.CDf=I[d.Vbb]);return J}P5h(I,S){c.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.Tmb.jTh.continueWith(()=>{this.Tmb.jTh.result?(c.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),I(this.Tmb.kTh)):(c.ULS.sendTraceTag(50448154,
500,15,"FindSessionUtils find Session resulted in error"),S(this.Tmb.kTh))})}a7f(I,S,J,L,R=!1){return Y=>{E.a.instance.DNb(0,1);I&&I.stop();this.slb=this.Agb=null;this.BAf(Y.data,!0,S);var Q=G.RtcUtils.deserialize(Y.data.Fe,"FindSession",null);if(Q)if(Q=this.a9j(Q)){if(Q.Poc&&Q.h9&&Q.VD){c.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Ym);this.tPi(Y.data);J(Q);return}S.FindSessionFailureReason="FindSessionInvalidResponse";S.IsRtcEnabled=Q.Poc;S.IsQueryStringEmpty=
!Q.h9;S.IsConnectionStringEmpty=!Q.VD;c.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Ym,Q.Poc,!Q.h9,!Q.VD)}else S.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",c.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Ym);else S.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",
c.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Ym);this.l_f(S,R);L(null)}}V6f(I,S,J,L=!1){return R=>{E.a.instance.DNb(0,1);I&&I.stop();this.slb=this.Agb=null;this.BAf(R.data,!1,S);let Y=null;var Q="unknown";let W="unknown";R.data&&((Q=R.data.responseHeaders)&&D.RPb in Q&&(Y=Q[D.RPb].toString()),Q=v.a[R.data.status],W=R.data.httpStatus.toString());S.FindSessionFailureReason="FindSessionRequestFailed";S.HttpErrorCode=W;S.HttpErrorStatus=Q;S[D.RPb]=Y;c.ULS.sendTraceTag(4290721,
500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",Q,W,this.Ym,Y,L);this.l_f(S,L);J(W)}}u$e(I,S,J=!1){let L=null;c.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Ym);const R={};var Y=this.zfe.Hkd();R[n.a.v_]=r.a.create().toString();this.Agb&&""!==this.Agb?Y=String.format("{0}&{1}={2}",Y,P.a.oVd,this.Agb):this.slb&&""!==this.slb&&(Y=String.format("{0}&{1}={2}",Y,P.a.oVd,this.slb),R[B.ujk]="True",
R[B.KJi]="True");Y=this.QGg+"?"+Y;J&&(R[O.lTh]=M.grj);const Q={};Q.IsNetworkOfflineBeforeSendRequest=this.lh.B$a;Q.HasAvailableConnectionsBeforeSendRequest=this.lh.yif;Q.MaxConnectionsAllowed=this.lh.hsc;Q.IsRefreshMachineId=J;this.Tmb&&!this.Afe?(this.P5h(this.a7f(null,Q,I,S,J),this.V6f(null,Q,S,J)),this.Afe=!0):(this.gi&&(L=this.gi.qd("WebServiceCall","GetMachineIdFromTheServer")),z.a.instance&&z.a.instance.rz(2,0),0>this.lh.$aa(Y,1,null,R,[D.t$b,D.RPb,D.$Jb,D.nVd,D.ZEf,D.lHf,D.kHf],!1,1,this.a7f(L,
Q,I,S,J),this.V6f(L,Q,S,J),null,null,!1,null,this.kfc,"3",null,!0)&&(5<this.Jmb&&200>this.Jmb&&c.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Jmb),window.setTimeout(()=>{this.Jmb++;S("-1")},1E3)))}BAf(I,S,J){J||(J={});J.IsNetworkOfflineAfterRequestComplete=this.lh.B$a;J.IsRequestSucceeded=S;I&&(J.EnqueueTime=I.odc,J.InvokedTime=I.CG,J.CompletedTime=I.q5,I.responseHeaders&&(D.t$b in I.responseHeaders&&
(J.CorrelationId=I.responseHeaders[D.t$b]),D.$Jb in I.responseHeaders&&(J[D.$Jb]=I.responseHeaders[D.$Jb])));c.ULS.sendTraceTag(38633565,500,S?50:15,G.RtcUtils.ycb(J))}l_f(I,S){I||(I={});I.ConnectionState=e.a[this.ega];S||this.Eh.k_f(1,I)}tPi(I){try{var S=!1,J=!1,L=I.responseHeaders,R=l.a.vL(I.request.get_url());if(L&&D.nVd in L){const pa=L[D.nVd].toString().toLocaleLowerCase();J="true"===pa;S="false"===pa}L=!1;const Ga=0<=R.toLocaleLowerCase().indexOf("collab");J&&!Ga?L=!0:S&&Ga&&(L=!0);if(L){S=
{};S.HostName=R;S.Status=v.a[I.status];S.HttpStatus=I.httpStatus.toString();var Y=I.request.get_headers();for(let pa in Y){var Q=Y[pa];(R=pa)&&0<R.length&&(J=0,Q&&(J=Q.toString().length),S["r_"+R]=J)}if(I.responseHeaders){const pa=new f.a;pa.add(D.t$b);pa.add(D.$Jb);pa.add(D.RPb);pa.add(D.lHf);pa.add(D.kHf);pa.add(D.ZEf);D.uUg(S,I.responseHeaders,pa)}D.gUg(I.request.get_url(),S);var W=x.a.toJSON(S);c.ULS.sendTraceTag(559437006,500,15,W)}}catch(Ga){c.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",
Ga.toString())}}static createInstance(I,S,J,L,R,Y,Q,W,Ga,pa,aa,Z=null){return D.Foh(I,S,J,L,R,Y,Q,W,Ga,pa,aa,Z)}static Foh(I,S,J,L,R,Y,Q,W,Ga,pa,aa,Z=null){I=I||r.a.create().toString();I=new D(I,S,J,L,R,Y,Q,W,Ga,pa,null,aa,Z);I.init();return I}static uUg(I,S,J){for(let L of J)L in S&&(I[L]=S[L])}static gUg(I,S){if(I){var J=I.indexOf("?");if(-1!==J)for(I=I.substr(J+1).split("&"),J=0;J<I.length;++J){var L=I[J].split("=");if(2===L.length){const R=L[0];if(R&&0<R.length){let Y=0;if(L=L[1])Y=L.length;S["q_"+
R]=Y}}}}}}D.p9h=3E3;D.zUi=3E5;D.Weh="1.0";D.rmf=1E3;D.t$b="X-CorrelationId";D.RNe="corrid";D.RPb="RtcErrorCode";D.$Jb="X-OfficeCluster";D.nVd="X-NewEnv";D.ZEf="X-MSEdge-Ref";D.kHf="X-OFFICEFD";D.lHf="X-OfficeFE";Object(u.a)(D,"FindSessionStrategy",null,[934])},1371:function(u,C,a){a.r(C);a.d(C,"RealtimeChannelMetrics",function(){return d});u=a(0);var c=a(15),b=a(249),f=a(115),e=a(751);class d{constructor(){this.Bme=this.Cme=this.Dme=this.zme=this.yme=this.Ame=this.Sob=this.TVc=0;this.faa=this.nUc=
this.eob=this.iUc=this.Xha=this.$Tc=this.jta=this.Znb=this.YZa=this.ZTc=this.GYb=this.hZa=null;this.cVc=this.Aob=this.Fqe=this.mce=0;this.Fle=!1;this.a1f=this.mQd;this.d1f=this.pQd;this.c1f=this.oQd;this.h1f=this.rQd;this.g1f=this.qQd;this.wQd=this.xQd;this.ENb=this.uQd;this.DTa=this.sQd;this.ETa=this.tQd;this.b1f=this.nQd;this.zJb=this.LGd;this.gtc=this.NGd}mQd(){this.TVc++;this.ZTc=new Date;this.hZa||(this.hZa=new Date)}pQd(){this.Sob++;this.jta=new Date;this.GYb||(this.GYb=this.jta);this.eob=this.jta;
this.Thh()}oQd(){this.Ame++;this.$Tc=new Date}rQd(){this.yme++;this.YZa=new Date}qQd(){this.zme++;this.Znb=new Date}uQd(){this.Xha=new Date;this.Dme++}tQd(){this.faa||(this.faa=new Date);this.Cme++}sQd(){this.iUc=new Date;this.Bme++}xQd(){!this.Fle&&this.TVc&&(c.ULS.sendTraceTag(39321871,500,15,f.a.toJSON(this.agh())),this.Fle=!0)}nQd(h){let l,k;({Zkf:h,alf:l,exception:k}=e.RtcUtils.qQh(h));h&&h!==b.a.hK&&(c.ULS.sendTraceTag(40157596,500,15,f.a.toJSON({["HttpErrorCode"]:h,["HttpErrorStatus"]:l,["Exception"]:k})),
b.a.dpf(h)&&this.mce++,b.a.nuf(h)&&this.Fqe++)}LGd(){this.nUc=new Date}NGd(){this.YZa=this.eob=new Date}agh(){return{["numberOfConnectionAttempts"]:this.TVc,["numberOfSuccessfulConnections"]:this.Sob,["numberOfFailedConnections"]:this.Ame,["numberOfDisconnectedConnections"]:this.yme,["numberOfExplicitDisconnectedConnections"]:this.zme,["numberOfSentMessages"]:this.Dme,["numberOfReceivedMessages"]:this.Cme,["numberOfLostMessages"]:this.Bme,["firstConnectionAttempt"]:this.hZa?this.hZa:null,["firstMessageReceived"]:this.faa?
this.faa:null,["firstConnectionSuccess"]:this.GYb?this.GYb:null,["lastConnectionAttempt"]:this.ZTc?this.ZTc:null,["lastConnectionSuccess"]:this.jta?this.jta:null,["lastConnectionFailure"]:this.$Tc?this.$Tc:null,["lastMessageSent"]:this.Xha?this.Xha:null,["lastMessageLost"]:this.iUc?this.iUc:null,["lastDisconnect"]:this.YZa?this.YZa:null,["lastExplicitDisconnect"]:this.Znb?this.Znb:null,["lastTimeOnline"]:this.eob?this.eob:null,["lastTimeOffline"]:this.nUc?this.nUc:null,["maxDisconnectedTimeMs"]:this.Aob,
["maxExplicitDisconnectedTimeMs"]:this.cVc,["clientConnectionErrors"]:this.mce,["serverConnectionErrors"]:this.Fqe}}Thh(){this.hZa&&1===this.Sob&&(this.Aob=Math.max(this.Aob,this.jta.getTime()-this.hZa.getTime()));this.YZa&&1<this.Sob&&(this.Aob=Math.max(this.Aob,this.jta.getTime()-this.YZa.getTime()));this.Znb&&1<this.Sob&&(this.cVc=Math.max(this.cVc,this.jta.getTime()-this.Znb.getTime()))}static createInstance(h){d.Oa||(d.Oa=new d,c.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",
h));return d.Oa}}d.Oa=null;Object(u.a)(d,"RealtimeChannelMetrics",null,[935,69])},1372:function(u,C,a){a.d(C,"a",function(){return c});u=a(0);class c extends Sys.EventArgs{constructor(b,f){super();this.fK=b;this.N5=f}}Object(u.a)(c,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1503:function(u,C,a){a.r(C);var c={};a.r(c);a.d(c,"NamedSheetViewConversionManager",function(){return Ba});var b=a(0),f=a(88);class e{constructor(db,U){this.Nta=null;this.kpb=db;this.VLg=U}init(){this.kpb.continueWith(()=>{this.Nta=
this.kpb.result;this.Nta.u1a(Object(f.a)(this,this.$O,"onUsersUpdated"))})}$O(){e.tCe(this.Nta.Exa())&&(this.Nta.RSd(Object(f.a)(this,this.$O,"onUsersUpdated")),this.VLg.IsRealCoauthSession=!0)}static tCe(db){let U=null;for(const Ta of db)if(Ta)if(db=Ta.isAnonymous||!Ta.email?Ta.clientId:Ta.email.toUpperCase(),!U)U=db;else if(U!==db)return!0;return!1}}Object(b.a)(e,"CoauthTelemetry",null,[761]);var d=a(15),h=a(170),l=a(126),k=a(6),n;(function(db){db[db.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";
db[db.notImplemented=1]="notImplemented";db[db.renderHandled=2]="renderHandled";db[db.renderHandledWithVeto=3]="renderHandledWithVeto"})(n||(n={}));Object(b.b)("CoauthorGalleryTelemetryEndResult",n);var v=a(103),x=a(115),w=a(62);class r{constructor(db,U,Ta,wb,Qb,sc,Vc,Ld,le){this.Nne=this.wce=this.By=null;this.dYa=db;this.$1b=new h.a;this.Ta=Ta;this.qOc=U;this.csa=wb;this.xh=Qb;this.NWc=sc;this.Ita=Vc;this.aDg=Ld;this.Dge=this.zge=!1;this.z2b=0;this.uce=1;this.KFa=le;this.Bte=this.Ta.ra("PeoplesWellExtraButtonInfoIsEnabled");
this.bsa=Object(l.a)(String,k.AFrameworkApplication.Nc.Application)||""}get blg(){return this.$1b.task}init(){w.Task.WAA.call(null,this.Ita,this.qOc,this.NWc).continueWith(()=>{this.By=this.Ita.result;this.wce=this.qOc.result;this.Nne=this.NWc.result;w.Task.WAA.call(null,this.qOc.result.n9c,this.NWc.result.JHc).continueWith(()=>{this.uce=this.wce.n9c.result;this.z2b=this.Nne.JHc.result;this.By.u1a(Object(f.a)(this,this.bwc,"onUsersUpdatedEventListener"));this.By.Exa().length&&this.$O()})})}bwc(){this.$O()}$O(){this.aDg(this.By.Exa())?
(this.By.RSd(Object(f.a)(this,this.bwc,"onUsersUpdatedEventListener")),this.J4i(this.zge)):this.$1b.ex(1);this.zge=!0}J4i(db){this.Dge?this.blg.continueWith(()=>{d.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",n[this.blg.result])}):(this.Dge=!0,this.Mmj(0===this.uce&&!db))}Mmj(db){db?this.csa.wj(4,Object(f.a)(this,this.KJd,"onInteractiveReady")):this.$1b.ex(1)}KJd(){const db=this.xh.vA("AppInitStatus_interactivityReady");d.ULS.shipAssertTag(42259235,
325,!!this.z2b);const U=this.z2b-db,Ta={};Ta.InteractiveTime=db;Ta.ReactRenderComplete=this.z2b;Ta.HadTabSwitch=this.KFa();Ta.IsModernGallery=this.Bte;d.ULS.sendTraceTag(594883104,325,50,x.a.toJSON(Ta));this.Bte?(d.ULS.sendTraceTag(42062997,325,15,U.toString()),this.$1b.ex(this.z8d(U)?3:2)):d.ULS.sendTraceTag(594883103,325,15,U.toString())}z8d(db){const U=db>this.Ta.oe("CoauthorGalleryTimeToRenderDurationMs",1E4),Ta="Word"===this.bsa;if(this.KFa())return d.ULS.sendTraceTag(50455714,325,50,U.toString()),
!1;Ta&&v.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);U&&(Ta&&v.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),d.ULS.sendTraceTag(42062998,325,15,db.toString()));return U}}Object(b.a)(r,"CoauthorGalleryTelemetry",null,[759]);class t{constructor(db){this.By=null;this.kXb={};this.n0b={};this.vnb=null;this.Ita=db}ric(db){const U=new h.a;this.init().continueWith(()=>{db in this.kXb?
U.ex(this.kXb[db]):this.n0b[db]=U});return U.task}init(){if(this.vnb)return this.vnb.task;this.vnb=new h.a;this.Ita.continueWith(()=>{this.By=this.Ita.result;this.By.u1a(Object(f.a)(this,this.$O,"onUsersUpdated"));this.Utg();this.vnb.setResult(null)});return this.vnb.task}Utg(){const db=this.By.Exa();db.sort(Object(f.a)(this,this.yhh,"comparePresenceUsers"));this.kXb={};for(let U=0;U<db.length&&db[U]&&db[U].Nna;U++)this.cUg(this.kXb,db[U].clientId,U)}cUg(db,U,Ta){db[U]=Ta;U in this.n0b&&(this.n0b[U].ex(Ta),
delete this.n0b[U])}$O(){this.Utg()}yhh(db,U){return db.Nna>U.Nna?1:db.Nna<U.Nna?-1:0}}Object(b.a)(t,"CoauthorPositionFinder",null,[760]);var A=a(662),y=a(563),z=a(712),E=a(199),G=a(185);class F{constructor(){this.Ria=null;this.llb=Array(32)}xor(db){if(!db)throw Error.argumentNull("Guid argument cannot be null");const U=new F,Ta=new Sys.StringBuilder;for(let wb=0;wb<db.llb.length;wb++){const Qb=this.llb[wb]^db.llb[wb];U.llb[wb]=Qb;Ta.append(Qb.toString(16));7!==wb&&11!==wb&&15!==wb&&19!==wb||Ta.append("-")}U.Ria=
G.a.oca(Ta.toString());return U}toString(){return this.Ria.toString()}equals(db){if(!db)throw Error.argumentNull("Guid argument cannot be null");return this.Ria.equals(db.Ria)}static nkd(db){if(!db)throw Error.argumentNull("String input cannot be null");const U=new F;U.Ria=G.a.oca(db);const Ta=U.Ria.toString();let wb=0;for(let sc=0;sc<Ta.length;sc++){var Qb=db.charAt(sc);if(F.LCi(Qb))Qb=F.Goi(Qb,db.charCodeAt(sc)),U.llb[wb++]=Qb;else if(!F.bCi(Qb))throw Error.argument("String contains characters not valid in Guids");
}return U}static LCi(db){return"0"<=db&&"9">=db||"A"<=db&&"F">=db||"a"<=db&&"f">=db}static bCi(db){return"{"===db||"}"===db||"-"===db}static Goi(db,U){if("0"<=db&&"9">=db)return U-48;if("A"<=db&&"F">=db)return U-65+10;if("a"<=db&&"f">=db)return U-97+10;throw Error.argument("Char is not valid hex digit");}}Object(b.a)(F,"Guid",null,[]);class O{constructor(db,U,Ta,wb){this.Nta=null;this.Fde=this.Xle=!1;this.qke=0;this.kpb=db;this.PZc=U;this.Ta=Ta;this.p_a=wb;this.LCg=k.AFrameworkApplication.userNameUnknown||
k.AFrameworkApplication.limitedEdit;this.Uke=new A.a(y.a.Ah())}get ccd(){return this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.kpb.continueWith(()=>{this.Nta=this.kpb.result;this.Nta.u1a(Object(f.a)(this,this.$O,"onUsersUpdated"))})}$O(){this.Zfh(this.Nta.Exa())}Zfh(db){var U=0;const Ta=new z.a(y.a.Ah());for(const wb of db)if(wb&&wb.isAnonymous){k.AFrameworkApplication.e8("70eb6120;2gfeb930");if(Ta.Fb(wb.userName))Ta.ma(wb.userName).add(wb.clientId);
else{let Qb;Ta.add(wb.userName,(Qb=new E.a,Qb.add(wb.clientId),Qb))}wb.clientId!==this.p_a?(U++,2<=U&&!this.Xle&&this.yQi()):!this.Fde&&this.ccd&&"Guest"===wb.userName&&(d.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.Fde=!0)}if(this.ccd&&this.qke!==U){d.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",U+(this.LCg?1:0));this.qke=U;for(let wb of Ta.keys)2<=Ta.ma(wb).count&&(db=this.F4h(Ta.ma(wb)),this.Uke.contains(db)||(U={},U.guestsWithSameName=Ta.ma(wb).count,
U.identifier=db,d.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",U),this.Uke.add(db)))}}yQi(){d.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Xle=!0;this.ccd&&this.PZc&&this.PZc.continueWith(()=>{window.setTimeout(()=>{this.PZc.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}F4h(db){if(!db||1>=db.count)return"";let U=F.nkd(db.ma(0));for(let Ta=1;Ta<db.count;Ta++)U=U.xor(F.nkd(db.ma(Ta)));return U.toString()}}Object(b.a)(O,
"GuestCoauthTelemetry",null,[]);var M=a(562);class P{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(b.a)(P,"PL",null,[]);var B=a(43);class D{constructor(){this.ct=this.vt=this.d=0}static zbg(db,U,Ta){const wb=new D;wb.d=db;wb.vt=U;wb.ct=Ta;return B.c(wb)}}Object(b.a)(D,"VD",null,[]);var I=a(184);class S{constructor(db,U,Ta,wb,Qb,sc,Vc,Ld,le,Ce,Oe){this.Nqe=!1;this._id=db;this.Rp=U;this.Ire=Ta;this.SM=wb;this.DVc=Qb;this.e_c=sc;this.AIa=Vc;this.hGa=
Ld;this.nEg=le;this.KFa=Ce;this.jte=Oe;this.bsa=Object(l.a)(String,k.AFrameworkApplication.Nc.Application)||""}veto(db){const U=[this.DVc,this.e_c];this.jte&&U.push(this.Ire);w.Task.WAA.apply(null,U).continueWith(()=>{if(this.DVc.result<=this.e_c.result)db.ex(!1);else{this.jte&&(this.Rp=this.Ire.result);var Ta=this.SM-this.Rp,wb=new P;wb.id=this._id;wb.et=this.SM;wb.st=this.Rp;wb.d=this.SM-this.Rp;wb.mp=this.DVc.result;wb.tp=this.e_c.result;wb.ct=this.X1h(this.nEg);wb.vc=this.KFa();var Qb=B.c(wb),
sc="Word"===this.bsa,Vc="PowerPoint"===this.bsa;d.ULS.sendTraceTag(42078597,302,15,Qb);if(sc){const Ld=new Map;Ld.set("data",Qb);v.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Ld)}Ta>this.AIa.value&&!this.Nqe&&!wb.vc&&(this.Nqe=!0,db.ex(!0),wb=Object.assign(new I.a,{inStaging:!0,extendedProperties:new Map}),wb.extendedProperties.set("data",Qb),sc&&v.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,wb),Ta<this.hGa.value&&
(d.ULS.sendTraceTag(42078598,302,15,D.zbg(Ta,this.AIa.value,this.hGa.value)),Ta=k.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),Vc&&Ta&&v.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,wb)));db.task.isCompleted||db.ex(!1)}})}X1h(db){switch(db){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(b.a)(S,"PresenceLatencyActivityLogger",
null,[]);class J{constructor(db,U,Ta){this.Ube=this.tce=this.aXb=this.jXb=this.hYa=0;this._id=db;this.AIa=U;this.hGa=Ta;this.bsa=Object(l.a)(String,k.AFrameworkApplication.Nc.Application)||""}get Hze(){return this.hYa}set Hze(db){this.hYa=db;this.$7c()}get VKe(){return this.jXb}set VKe(db){this.jXb=db;this.$7c()}get VHe(){return this.aXb}set VHe(db){this.aXb=db;this.$7c()}get WKe(){return 0!==this.tce}get WHe(){return 0!==this.Ube}$7c(){!this.WKe&&this.hYa&&this.jXb&&(this.tce=this.veto(this.jXb,
"CoauthGalleryLightupDurationTooLong"));!this.WHe&&this.hYa&&this.aXb&&(this.Ube=this.veto(this.aXb,"CanvasPresenceLightupDurationTooLong"))}veto(db,U){const Ta=db-this.hYa;var wb=new P;wb.id=this._id;wb.et=db;wb.st=this.hYa;wb.d=Ta;var Qb=B.c(wb),sc="Word"===this.bsa;db="PowerPoint"===this.bsa;wb="CanvasPresenceLightupDurationTooLong"===U?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===U?d.ULS.sendTraceTag(572289499,302,15,Qb):d.ULS.sendTraceTag(571524118,
302,15,Qb);if(sc){var Vc=new Map;Vc.set("data",Qb);v.Health.instance.recordKpiUsage(wb,0,"wordcollabrel",Vc)}return Ta>this.AIa.value?(Vc=Object.assign(new I.a,{inStaging:!0,extendedProperties:new Map}),Vc.extendedProperties.set("data",Qb),Qb=Ta<this.hGa.value,Vc.extendedProperties.set("cash",Qb?"true":"false"),sc&&v.Health.instance.recordKpiFailure(wb,U,!1,!0,Vc),sc=k.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientRenderLatencyQoSError"),db&&sc&&v.Health.instance.recordQosError(U,
[wb],!1,!0,!0,!1,Vc),d.ULS.sendTraceTag(572289500,302,15,D.zbg(Ta,this.AIa.value,this.hGa.value)),Qb?2:1):3}}Object(b.a)(J,"PresenceLightupLatencyLogger",null,[]);var L=a(56),R=a(330);class Y{constructor(db,U,Ta,wb,Qb,sc,Vc,Ld=null,le=null,Ce=null){this.Doe={};this.pOc={};this.vje=new E.a;this.OWb=this.wnb=this.By=this.Ppb=null;this.vZc=this.uZc=0;this.AIa=new M.a(()=>Ld.WN("PresenceBootLatencyThreshold",1E4));this.hGa=new M.a(()=>Ld.WN("PresenceBootLatencyCutoffThreshold",6E4));this.xQg=new M.a(()=>
Ld.WN("PresenceLightupLatencyThreshold",2E3));this.nFg=new M.a(()=>Ld.WN("PresenceLightupLatencyCutoffThreshold",1E4));this.csa=wb;this.Ta=Ld;this.YLg=Qb;this.vce=db;this.Xpe=U;this.Ita=Ta;this.xh=sc;this.p_a=le;this.KFa=Vc;this.Gge=Ce;this.pNc=!1;this.init()}eDh(db,U,Ta=null){Ta&&(d.ULS.shipAssertTag(42274970,302,!this.p_a||this.p_a===Ta,"_myClientId is already set and you are trying to update it to something different"),this.p_a=Ta);const wb=new h.a;this.init().continueWith(()=>{this.t$i(db);this.fDh(wb,
db,U)})}get pGd(){return this.p_a||"{"+k.AFrameworkApplication.userSessionId+"}"}init(){if(this.wnb)return this.wnb.task;this.wnb=new h.a;this.KFa()&&d.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.vce.continueWith(()=>{const db=this.vce.result,U=db.n9c,Ta=db.BWi;Ta.continueWith(()=>{U.continueWith(()=>{this.Gge&&this.Gge.addQosPillar("RealTimeCoauth");this.R1j(U.result,Ta.result);this.wnb.setResult(null)})})});this.Xpe.continueWith(()=>{this.Ppb=this.Xpe.result;this.Ppb.G4(Object(f.a)(this,
this.Eaj,"onRtcConnection"));this.Ppb.t1a(Object(f.a)(this,this.r2i,"onCoauthorBootReceived"))});this.Ita.continueWith(()=>{this.By=this.Ita.result;this.By.u1a(Object(f.a)(this,this.bwc,"onUsersUpdatedEventListener"));0<this.By.Exa().length&&this.$O()});return this.wnb.task}M8e(){return this.xh.s5(L.a.wXa)?this.xh.vA(L.a.wXa):R.a.dR?window.performance.timing.fetchStart:-1}Haf(){this.OWb||(this.OWb=new h.a,this.csa.wj(4,()=>{this.OWb.ex(this.xh.vA("AppInitStatus_interactivityReady"))}));return this.OWb.task}Eaj(db,
U){if(!this.pNc&&2===U.newState)if(this.cKc){const Ta=this.Haf();Ta.continueWith(()=>{const wb=Date.now()-Ta.result,Qb={};Qb.clientId=this.pGd;Qb.bootTime=wb;this.pNc=!0;this.Ppb.P9(15,Qb)})}else db=Date.now()-this.M8e(),U={},U.clientId=this.pGd,U.bootTime=db,this.pNc=!0,this.Ppb.P9(15,U)}r2i(db,U){if(15===U.type){db=Date.now();U=U.y$;var Ta=U.bootTime;this.Lnd(U.clientId).Hze=db-Ta}}bwc(){this.$O()}$O(){const db=Date.now();var U=this.By.Exa();const Ta=new E.a;for(const wb of U)this.vje.contains(wb.clientId)||
(this.vje.add(wb.clientId),Ta.add(wb.clientId));if(0<Ta.count)for(let wb of Ta)U=this.Lnd(wb),U.WKe||(U.VKe=db)}t$i(db){db=this.Lnd(db);db.WHe||(db.VHe=Date.now())}Lnd(db){return db in this.pOc?this.pOc[db]:this.pOc[db]=new J(db,this.xQg,this.nFg)}R1j(db,U=0){this.uZc=db;this.vZc=U?U:(new Date).getTime()}fDh(db,U,Ta){Ta=Ta?Ta.getTime():(new Date).getTime();if(U in this.Doe)db.qB();else{const wb=this.cKc?0:this.afi(),Qb=this.cKc?this.bfi():null;Ta=new S(U,wb,Qb,Ta,this.ric(this.pGd),this.ric(U),this.AIa,
this.hGa,0,this.KFa,this.cKc);this.Doe[U]=Ta;Ta.veto(db)}}afi(){return 1===this.uZc?this.vZc:this.M8e()}bfi(){return 1===this.uZc?w.Task.Ua(this.vZc):this.Haf()}ric(db){return this.YLg.ric(db)}get cKc(){return this.Ta.ra("UseAppInteractiveBootTimeForPresenceTelemetry")}}Object(b.a)(Y,"PresenceBootTelemetry",null,[758]);var Q=a(142),W=a(260),Ga=a(224),pa=a(84),aa=a(528);class Z{get name(){return"Common.App.CoauthTelemetry"}Di(db){db.register(e,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").Uc().dd(()=>
new e(aa.a.dr(db.qc("Common.IPeopleInfoProvider")),k.AFrameworkApplication.Bf));db.register(r,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").Uc().dd(()=>new r(k.AFrameworkApplication.Qb,aa.a.dr(db.qc("Common.ICoauthoringTelemeryInfoProvider")),k.AFrameworkApplication.fa,Q.a.get_instance(),Ga.a.instance,aa.a.dr(db.qc("Common.IPeoplesWell")),aa.a.dr(db.qc("Common.IPeopleInfoProvider")),e.tCe,()=>this.lFe()));db.register(Y,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").Uc().dd(()=>
new Y(aa.a.dr(db.qc("Common.ICoauthoringTelemeryInfoProvider")),aa.a.dr(db.qc("Common.IRealtimeChannelBasic")),aa.a.dr(db.qc("Common.IPeopleInfoProvider")),Q.a.get_instance(),db.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Ga.a.instance,()=>this.lFe(),k.AFrameworkApplication.fa,null,v.Health.instance));db.register(t,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").Uc().dd(()=>new t(aa.a.dr(db.qc("Common.IPeopleInfoProvider"))));
db.register(O,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").Uc().dd(()=>new O(aa.a.dr(db.qc("Common.IPeopleInfoProvider")),aa.a.dr(db.qc("Common.ISystemInitiatedFeedback")),k.AFrameworkApplication.fa,"{"+k.AFrameworkApplication.userSessionId+"}"))}init(){k.AFrameworkApplication.fa.Hv(()=>{pa.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();pa.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();k.AFrameworkApplication.fa.ra("CoauthorGalleryTelemetryIsEnabled")&&
pa.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();k.AFrameworkApplication.fa.ra("CashTelemetryIsEnabled")&&(pa.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),pa.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}lFe(){return R.a.dR&&Ga.a.instance.s5(L.a.hVb)?0<Ga.a.instance.vA(L.a.hVb)[L.a.Kwg]:!1}static main(){W.a.instance.nj(new Z)}}Object(b.a)(Z,"CoauthTelemetryPackage",null,[4,5]);var fa=a(119),ya=a(42);class Aa{}Object(b.a)(Aa,
"NamedSheetViewConversionEntry",null,[]);var ja=a(9),za=a(120),ra=a(33),fb=a(1),Ua=a(58);const Ca=(db,U,Ta,wb,Qb,sc=null)=>{sc=db.Pa(1,sc);return Ua.g(db,"GetNamedSheetViewConversion",sc,U,Ta,wb,Qb,132)};var Ia=a(47),oa=a(23);const Da=(db,U)=>!!db&&!!U&&db.SheetName===U.SheetName&&(!!db.NamedObjectName&&db.NamedObjectName===U.NamedObjectName||!db.NamedObjectName&&!U.NamedObjectName&&Ia.E(db).Nd(Ia.E(U))),bb=(db,U,Ta)=>{if(!U||!U.Zb)return null;for(let wb=0;wb<U.Zb.count;wb++){const Qb=U.Zb.getItem(wb);
if(Qb&&Qb.type===Ta&&Qb.usedRange&&Qb.usedRange.contains(Ia.E(db))&&oa.a.equals(Qb.sheetName,db.SheetName,!0))return Qb}return null};var Za=a(36),Xa=a(149);let Ba=class extends ya.a{constructor(db){super();this.l4a=this.Tva=null;this.eLc=this.xwa=!1;this.fg=()=>{const U=this.$.ea.Pn;if(null===U||void 0===U?0:U.SheetChanges)for(const Ta of U.SheetChanges)if(2===Ta.Type){if(this.Tva)for(const wb of this.Tva)wb.Range.SheetName===Ta.Name&&(wb.Range.SheetName=Ta.NewName);if(this.l4a)for(const wb of this.l4a)wb.Range.SheetName===
Ta.Name&&(wb.Range.SheetName=Ta.NewName)}};this.HMf=()=>{d.ULS.sendTraceTag(537154395,0,50,"NamedSheetViewConversionManager.OnGridLoaded");this.eLc=!1;this.huc(this,Sys.EventArgs.Empty)};this.Xc=()=>{d.ULS.sendTraceTag(537154394,0,50,"NamedSheetViewConversionManager.OnWorkbookClosing");this.eLc=!0};this.huc=()=>{d.ULS.sendTraceTag(50620166,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: triggered with version [${this.$.ea.cBa}]`);if(!this.$.isEditMode||!this.$.ea.Ec||this.$.ea.E8a||
this.eLc||this.$.ea.cBa===ja.a.gbc)d.ULS.sendTraceTag(537154393,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: Request skipped [Edit Mode: ${this.$.isEditMode}] [IsSessionActive: ${this.$.ea.Ec}] [HasRaisedSessionEnded: ${this.$.ea.E8a}] [WorkbookClosed: ${this.eLc}]`);else{this.l4a=this.Tva=null;var U=this.$.qa.va.Bc();Ca(this.$.qa.va,this.p6i,this.o6i,null,U)}};this.p6i=U=>{if(ra.a.Aq(U.Errors)){this.xwa=!0;const Ta=[-1100324317,-1857233882];ra.a.Fh(U.Errors,Ta)&&d.ULS.sendTraceTag(537154392,
0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionSuccess Errors: [${ra.a.Ic(U.Errors)}]`);U=ra.a.bB(U.Errors,Ta,"NamedSheetViewConversionManager:OnGetNamedSheetViewConversionSuccess");this.$.ea.To(U)}else this.xwa=!1,U=U.Result,this.$.ea.cBa=U.ConversionVersion,this.mmj(U.NamedSheetViewConversionEntries),this.Aoj()};this.o6i=U=>{this.xwa=!0;U=za.a.lf(U.data);let Ta=!1;fb.EwaSettings.isChangeGateEnabled("OfficeVSO:6401332_RefreshTokenException")&&U.forEach(wb=>{-1537615947===wb.MessageId&&
(Ta=!0)});Ta?d.ULS.sendTraceTag(512274778,0,50,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${ra.a.Ic(U)}].`):d.ULS.sendTraceTag(537154391,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${ra.a.Ic(U)}].`)};this.$=db;d.ULS.shipAssertTag(537154397,0,!!this.$.ea,"NamedSheetViewConversionManager ctor: EwaControl.SessionStateManager should not be null");this.$.Xj(this.Xc);this.$.ea.SQ(this.HMf);this.$.ea.OXg(this.huc);this.$.ea.nv(this.fg);
this.$.ea.Ow&&this.huc(this,Sys.EventArgs.Empty)}rye(db){this.addHandler("SVCU",db)}Q4f(db){this.removeHandler("SVCU",db)}dispose(){this.l4a=this.Tva=null;this.$&&this.$.Ll(this.Xc);this.$.ea&&(this.$.ea.qP(this.HMf),this.$.ea.Myj(this.huc),this.$.ea.Xw(this.fg));this.$=null;super.dispose()}pkh(db){return this.xwa?null:this.vNe(db,this.l4a,"ConvertPresencePublicToPrivate")}okh(db){return this.xwa?null:this.vNe(db,this.Tva,"ConvertPresencePrivateToPublic")}mmj(db){db?(this.muh(db),this.Tva=db,this.l4a=
this.Hoh(this.Tva)):d.ULS.sendTraceTag(537154396,0,10,"NamedSheetViewConversionManager.ProcessConversionEntries: conversionEntries can be empty but not null")}Aoj(){d.ULS.sendTraceTag(537154390,0,50,"NamedSheetViewConversionManager.RaiseConversionUpdatedEvent: new version is update on client from server");this.raiseEvent("SVCU")}vNe(db,U,Ta){if(!U||!U.length)return d.ULS.sendTraceTag(537154389,0,50,`NamedSheetViewConversionManager.${Ta}: skipping convert due to ${U?"empty":"null"} ConversionEntries. `),
db;for(const wb of db){for(const Qb of U)!Qb.IsRow||!Da(Qb.Range,wb)||wb.FirstRow<=Qb.Range.FirstRow&&wb.LastRow>=Qb.Range.LastRow||(Ta={},Ta.SheetName=wb.SheetName,Ta.FirstRow=Ta.LastRow=wb.FirstRow,Ta.FirstColumn=Ta.LastColumn=wb.FirstColumn,Da(Qb.Range,Ta)?(Ta=wb.FirstRow-Qb.Range.FirstRow,0>Ta||Ta>=Qb.ConversionMap.length?d.ULS.sendTraceTag(537154388,0,10,`NamedSheetViewConversionManager.ConvertRanges: invalid mapIndex after adjust. Index: [${Ta}], ConversionMap.Length: ${Qb.ConversionMap.length}`):
(Ta=Qb.ConversionMap[Ta]-Ta,wb.FirstRow+=Ta,wb.LastRow=wb.FirstRow,wb.LastColumn=Math.min(wb.LastColumn,Qb.Range.LastColumn))):wb.FirstRow<Qb.Range.FirstRow&&wb.LastRow>=Qb.Range.FirstRow?wb.LastRow=Qb.Range.FirstRow-1:wb.LastColumn>=Qb.Range.FirstColumn&&(wb.LastColumn=Qb.Range.FirstColumn-1));if(0>wb.FirstRow||wb.FirstRow>ja.a.yz)wb.FirstRow=Math.max(Math.min(wb.FirstRow,ja.a.yz),0);if(0>wb.LastRow||wb.LastRow>ja.a.yz)wb.LastRow=Math.max(Math.min(wb.LastRow,ja.a.yz),0);if(0>wb.FirstColumn||wb.FirstColumn>
ja.a.Wx)wb.FirstColumn=Math.max(Math.min(wb.FirstColumn,ja.a.Wx),0);if(0>wb.LastColumn||wb.LastColumn>ja.a.Wx)wb.LastColumn=Math.max(Math.min(wb.LastColumn,ja.a.Wx),0)}return db}Hoh(db){if(!db||!db.length)return d.ULS.sendTraceTag(537154387,0,50,`NamedSheetViewConversionManager.CreateInverseConversionEntries: skip creating inverse due to ${this.Tva?"empty":"null"} ConversionEntries. `),db;const U=Array(db.length);for(let Ta=0;Ta<db.length;++Ta){const wb=new Aa;wb.Range=db[Ta].Range;wb.IsRow=db[Ta].IsRow;
wb.ConversionMap=Array(db[Ta].ConversionMap.length);wb.IsRow||(this.xwa=!0,d.ULS.sendTraceTag(537154386,0,10,"NamedSheetViewConversionManager.CreateInverseConversionEntries: adjusting presence against column sort map is NYI."));for(let Qb=0;Qb<db[Ta].ConversionMap.length;++Qb)wb.ConversionMap[db[Ta].ConversionMap[Qb]]=Qb;U[db.length-Ta-1]=wb}return U}muh(db){if(db&&db.length)for(const U of db)this.luh(U),db=U.IsRow?U.Range.LastRow-U.Range.FirstRow+1:U.Range.LastColumn-U.Range.FirstColumn+1,U.ConversionMap.length!==
db&&(d.ULS.shipAssertTag(537154385,0,!1,`NamedSheetViewConversionManager.DecompressEntries: decompressed conversion map doesn't match expected size - Expected: [${db}] | Actual: [${U.ConversionMap.length}]`),this.xwa=!0)}luh(db){const U=db.ConversionMap;if(U&&U.length)if(0>U[0])d.ULS.shipAssertTag(537154384,0,!1,"NamedSheetViewConversionManager.DecompressConversionMap: conversionMap starts with a negative number"),this.xwa=!0;else{var Ta=[];for(let wb=0;wb<U.length;++wb)if(0>U[wb]){const Qb=U[wb-
1],sc=-1*U[wb];for(let Vc=1;Vc<=sc;++Vc)Ta.push(Qb+Vc)}else Ta.push(U[wb]);db.ConversionMap=Ta}}};Ba=Object(fa.b)([Object(Xa.d)(Za.X),Object(fa.c)(0,Object(Za.A)())],Ba);Object(b.a)(Ba,"NamedSheetViewConversionManager",ya.a,[797,2]);var Wa=a(649),Na=a(845);class ta extends Sys.EventArgs{constructor(db){super();this.Yg=db}}Object(b.a)(ta,"ConnectionCompletedEventArgs",Sys.EventArgs,[]);var V=a(52),ia=a(40),X=a(54),la=a(55),sa=a(1207);class Va extends ya.a{constructor(db){super();this.GB=this.w9f=this.L9b=
null;this.Yhe=!1;this.eXd=null;this.EEc=!1;this.wX=(U,Ta)=>{if(2===Ta.newState){if(this.Yg){if(fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const wb=(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,435,436,1),Qb=>{Qb.result.mRi(wb)},this.$.ka,3)}this.raiseEvent("connectionCompleted",new ta(this.Yg),Ta)}else d.ULS.sendTraceTag(537167630,0,15,"RealTimeChannelController.OnConnectionStateChanged: new state is connected and this.RealTimeChannel is null");
this.L9b=Ta}else if(2===Ta.oldState||0===Ta.newState)this.L9b=null,this.raiseEvent("connectionLostEventKey")};this.xSa=()=>{if(this.Yg){const U=Object(l.a)(352,this.Yg);U&&(d.ULS.sendTraceTag(537167629,0,50,"RealTimeChannelController.OnWorkbookClosed: disconnecting from RTC for clientID {0}",this.$.workbookContext.ClientId),U.disconnect(),U.t9(this.wX))}this.GB=null};this.$=db;this.$.Xj(this.xSa);this.$.ea.P2c(this.xSa);if(this.EEc=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7654759_PassSessionExpirationManagerToRTC"))this.eXd=
Wa.a.create();db.da.Gb(38,U=>{this.EEc&&(this.eXd.instance=U);U.Eye(this.xSa)})}Vrb(db){this.addHandler("connectionCompleted",db)}Lzc(db){this.removeHandler("connectionCompleted",db)}I2c(db){this.addHandler("rtcInitialized",db)}HOb(db){this.removeHandler("rtcInitialized",db)}Cxe(db){this.addHandler("connectionLostEventKey",db)}h4f(db){this.removeHandler("connectionLostEventKey",db)}get Yg(){return this.GB}get Qvd(){return this.Yhe}dispose(){this.Yg&&this.Yg.t9(this.wX);this.$&&this.$.Ll(this.xSa);
this.GB=this.$=null;super.dispose()}bQe(db){ia.TaskExtensions.za(this.Kdf().task,U=>{db(U.result)},this.ka)}HMe(db,U){this.Yhe=U;this.N8i(db)}y3a(){this.Yg&&(this.raiseEvent("rtcInitialized"),2===this.Yg.connectionState&&this.L9b&&this.raiseEvent("connectionCompleted",new ta(this.Yg),this.L9b))}aOi(){d.ULS.sendTraceTag(537167633,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice");const db=(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,435,436,1),wb=>{wb.result.pRi(db)},
this.$.ka,3);var U=[];U.push(X.a.current.Lo(68));U.push(X.a.current.Lo(69));U=X.a.uCd(U,this.$.ka);const Ta=X.a.loadScript(9,0,1);return w.Task.BH(U,Ta)}N8i(db){const U=this.aOi();ia.TaskExtensions.za(U,()=>{d.ULS.sendTraceTag(537167632,0,50,`RealTimeChannelController.OnLoadRealTimeChannelSlice Before RealtimeChannel create. RealtimeChannel = null: ${void 0===Na.RealtimeChannel||null===Na.RealtimeChannel}`);if(fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const wb=
(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,435,436,1),Qb=>{Qb.result.qRi(wb)},this.$.ka,3)}this.GB=Na.RealtimeChannel.createInstance(db,this.$.xa.UserSessionId,k.AFrameworkApplication.x9f,k.AFrameworkApplication.de,this.EEc?this.eXd:null,2,la.b().Xff(),this.$.workbookContext.RtcEndpointUrl,void 0,new sa.a,void 0,void 0,this.$.workbookContext.RtcBootToken);d.ULS.sendTraceTag(571770432,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice RealtimeChannel created with clientID {0}",
db);fb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)&&(pa.a.instance.register(Na.RealtimeChannel,"AppRealtimeChannel.RealtimeChannel").as("Common.IRealtimeChannelBasic").as("AppRealtimeChannel.IRealtimeChannel").Uc().dd(()=>this.Yg),pa.a.instance.resolve("Common.IRealtimeChannelBasic"));this.Kdf().setResult(this.Yg);if(fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const wb=(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,
435,436,1),Qb=>{Qb.result.oRi(this.Qvd,wb)},this.$.ka,3)}this.raiseEvent("rtcInitialized");d.ULS.sendTraceTag(571770403,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice raise RealTimeChannelInitializedEventKey");const Ta=Object(l.a)(352,this.Yg);Ta&&(d.ULS.sendTraceTag(571770402,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice attach changed handler"),Ta.G4(this.wX),Ta.connect())},this.ka,3)}Kdf(){return this.w9f||(this.w9f=new h.a)}static la(db){db.da.Ja(26,new Va(db))}}Object(b.a)(Va,
"RealTimeChannelController",ya.a,[9,10]);var nb=a(10),ha=a(2),jb=a(105),Fb=a(112),Rb=a(26);class mb{constructor(db,U,Ta,wb,Qb,sc,Vc,Ld,le=!1){this.Vra=null;this.sQc=!0;this.XWc=this.jw=this.cNc=null;this.$a=new jb.a;this.MKg=db;this.V_a=U;this.ooe=Ta;this.moe=wb;this.bbe=sc;mb.Ce=Qb;this.iMg=Vc;this.Ata=Ld;this.GMg=le;w.Task.WAA(U,Ta).continueWith(Object(f.a)(this,this.ssi,"initOnTaskReady"))}w_f(){this.$a.raiseEvent("u",null,this)}ssi(){this.V_a.result&&this.ooe.result&&(this.jw=this.V_a.result,
this.XWc=this.ooe.result,this.jw.q1a(Object(f.a)(this,this.Soa,"onPresenceUpdated")),this.cNc=new Fb.a(2,2,this.bbe,Object(f.a)(this,this.Yck,"updateAwayClientsTask"),88),mb.Ce.jg(this.cNc))}Soa(db,U){(this.sQc||this.Brj(U.fK))&&mb.Ce.Lpa(this.cNc,0)}Brj(db){for(let Ta in db){var U=this.moe.Rcf({key:Ta,value:db[Ta]});if(U&&U.clientId&&(U=U.clientId.toLowerCase(),(U=this.Vra[U]||this.Vra[U.toUpperCase()])&&2===U.status))return!0}return!1}Yck(db){var U=this.jw.q_h();if(U){var Ta=new Date,wb=!1;if(this.sQc){this.Vra=
U;this.sQc=!1;var Qb=this.Vra;for(var sc in Qb){U=sc;var Vc=Qb[sc];Vc.bbb<Ta&&(Ta=Vc.bbb);2===Vc.status&&(wb=!0,this.XWc.P3f(U))}wb&&this.w_f();mb.Ce.Lpa(db,this.Pbf(Ta))}else{Vc=new E.a;sc=!1;var Ld=this.Vra;for(Qb in Ld){Ld=Qb;if(!(Ld in this.Vra)||this.MKg.clientId===Ld)continue;var le=this.Vra[Ld];const Ce=U[Ld];if(le&&Ce){le=le.status;const Oe=Ce.status;2===le&&1===Oe?(Vc.add(Ld),d.ULS.sendTraceTag(38052609,392,50,Ld+" returned from away")):1===le&&2===Oe&&(sc=wb=!0,this.XWc.P3f(Ld),d.ULS.sendTraceTag(38052610,
392,50,Ld+" went away"));1===Oe&&Ce.bbb<Ta&&(Ta=Ce.bbb)}}this.Vra=U;mb.Ce.Lpa(db,this.Pbf(Ta));(0<Vc.count||wb)&&this.w_f();0<Vc.count&&!this.GMg?(db=this.d2h(Vc),this.o7j(db)):db=new E.a;(sc||0<db.count)&&this.iMg(Rb.a.m9c,2)}}}o7j(db){if(db.count)for(let U of db)db=this.Ata.x5(String.format(CommonUIStrings.l_EditorsToastArriving,U),!1),db.image=5,db.Z6="CoAuth_AuthorStatus_16x16x32",this.Ata.CD(db)}d2h(db){const U=this.jw.xgc(),Ta=new E.a;for(let wb in U){const Qb={key:wb,value:U[wb]};if(db.contains(Qb.key)){const sc=
this.moe.Rcf(Qb);sc&&(Ta.add(sc.userName),db.remove(Qb.key))}}Ta.count||d.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Ta}Pbf(db){const U=new Date;return Math.max(db.getTime()+this.bbe-U.getTime(),0)}}mb.Ce=null;Object(b.a)(mb,"AwayManager",null,[]);var sb=a(438),Ya=a(108),Ma=a(302),xb=a(229);class qb extends xb.a{constructor(db){super();this.manager=null;this.$=db;this.kc()}create(){this.Pb(this.manager||(this.manager=new Ba(this.$)))}}Object(b.a)(qb,"NamedSheetViewConversionManagerFactory",
xb.a,[]);var Ra=a(92),Jb=a(545);class yb{constructor(db){this.Ra=new jb.a;this.hkb=this.disposed=!1;this.GLb=()=>{d.ULS.sendTraceTag(537154381,0,50,"PeopleInfoProvider.OnUserListUpdated fired");this.Ra.raiseEvent("UU",this)};this.$=db;this.$.ea.fba(this.GLb);this.hkb=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}dispose(){this.disposed||(this.$&&this.$.ea&&this.$.ea.v9(this.GLb),Ra.a.Rc([this.Ra]),this.$=this.Ra=null,this.disposed=!0)}u1a(db){this.Ra.addHandler("UU",
db)}RSd(db){this.Ra.removeHandler("UU",db)}Exa(){const db=[];for(const U of this.$.ea.to)db.push(this.jbi(U));d.ULS.sendTraceTag(537154383,0,50,`PeopleInfoProvider.GetAllUsers: Count: [${db.length}]`);return db}jbi(db){var U;this.hkb&&!this.presenceView&&(this.presenceView=this.$.da.Ba(25));return new sb.a(db.User.UserID,db.User.UserName,db.UserColor,new Jb.a(1),null,db.UserEmail,void 0,void 0,this.hkb?null===(U=this.presenceView)||void 0===U?void 0:U.isAnonymousUser(db.User.UserID):void 0,void 0,
void 0,db.JoinCoauthTime)}}Object(b.a)(yb,"PeopleInfoProvider",null,[814,2]);var Gb=a(659);class ub{CD(){d.ULS.sendTraceTag(537154380,0,50,"PresenceBootstrapper.AddNotificationBarEntry: User state changed from inactive to active")}removeEntry(){}get isVisible(){return!1}x5(db,U){return new Gb.a(db,U)}dispose(){}static get instance(){ub.Oa||(ub.Oa=new ub);return ub.Oa}}ub.Oa=null;Object(b.a)(ub,"NoOpNotificationBar",null,[813,2]);class Ja{Rcf(db){const U=db.key;db=db.value;if(!db)return null;const Ta=
db.SupportsChat?4:0;return Object(ha.a)(new sb.a,{clientId:U,Z7c:db.ChatThreadId,Y7c:db.ChatThreadDiscoveryUri,wDb:db.InChat,email:db.Cid,capabilities:new Jb.a(Ta),isAnonymous:db.IsAnonymous})}}Object(b.a)(Ja,"PresenceConverter",null,[828]);class zb extends xb.a{constructor(){super();this.ENe=null;this.kc()}create(){this.Pb(this.ENe||(this.ENe=new Ja))}static la(db){db.da.Ja(159,new zb)}}Object(b.a)(zb,"PresenceConverterFactory",xb.a,[]);var na=a(136),Ea=a(137);class ma{constructor(db){this.jXf=this.FNd=
this.lXf=this.hXf=this.jVf=this.lVd=this.n9f=this.v9f=this.u9f=!1;this.GNd=this.qMd=this.PPb=this.SPb=this.EBc=this.pVd=0;this.Vtf=!1;this.FGd=this.tub=0;this.Xoc=!1;this.zd=()=>{this.Xoc=!0;this.$.ea.Kk(this.zd)};this.$=db;R.a.dR&&(this.FGd=window.performance.timing.navigationStart);this.FGd||d.ULS.sendTraceTag(537154379,0,15,"Navigation start time is zero");this.$.ea.pk(this.zd)}pRi(db){this.u9f||(this.pVd=db,this.u9f=!0)}qRi(db){this.v9f||(this.EBc=db,this.v9f=!0)}oRi(db,U){this.n9f||(this.SPb=
U,this.Vtf=db,this.n9f=!0)}mRi(db){this.lVd||(this.PPb=db,this.lVd=!0)}TQi(db){!this.FNd&&this.lVd&&(this.GNd=db,this.FNd=!0)}OQi(db){this.jVf||(this.qMd=db,this.jVf=!0)}SQi(db){if(!this.hXf&&this.nja&&!this.Xoc){this.hXf=!0;const U=this.Pld();U.RtcIntializeToPeopleWellServiceCreate=this.qMd-this.SPb;U.PeopleWellServiceCreateToPresenceGalleryRender=db-this.qMd;U.PresenceGalleryRenderTotalTime=db-this.nja;Ea.b(this.$).Ld(na.a.iXf,U,void 0,!0)}}VQi(db){if(!this.lXf&&this.nja&&!this.Xoc){this.lXf=!0;
const U=this.Pld();U.RtcIntializeToRtcConnect=this.PPb-this.SPb;U.RtcConnectToPresenceSent=db-this.PPb;U.PresenceSentTotalTime=db-this.nja;Ea.b(this.$).Ld(na.a.mXf,U,void 0,!0)}}UQi(db){if(!this.jXf&&this.FNd&&this.nja&&!this.Xoc){this.jXf=!0;const U=this.Pld();U.RtcIntializeToRtcConnect=this.PPb-this.SPb;U.RtcConnectToPresenceRenderInitiate=this.GNd-this.PPb;U.PresenceRenderInitiateToPresenceRenderFinish=db-this.GNd;U.PresenceRenderTotalTime=db-this.nja;Ea.b(this.$).Ld(na.a.kXf,U,void 0,!0)}}dispose(){this.$=
null}Pld(){const db={};db.CoAuthorCountsOnBoot=this.$.ea.to.length;db.RtcConnectedLaterInSession=this.Vtf;db.BrowserVisibilityChanged=this.F6g();db.AppInteractiveAbsTime=this.nja;db.NavigationStartTime=this.FGd;db.AppInteractiveToRtcSliceDownloadInitialize=this.pVd-this.nja;db.RtcSliceDownloadInitializeToRtcSliceLoad=this.EBc-this.pVd;db.AppInteractiveToRtcSliceLoad=this.EBc-this.nja;db.RtcSliceLoadToRtcInitialize=this.SPb-this.EBc;return db}get nja(){if(this.tub)return this.tub;Ga.a.instance.s5("AppInitStatus_interactivityReady")&&
(this.tub=Ga.a.instance.vA("AppInitStatus_interactivityReady"));this.tub||d.ULS.sendTraceTag(537154378,0,15,"App interactive time is zero");return this.tub}F6g(){return R.a.dR&&Ga.a.instance.s5(L.a.hVb)?0<Ga.a.instance.vA(L.a.hVb)[L.a.Kwg]:!1}}Object(b.a)(ma,"PresenceTelemetry",null,[827,2]);class Ka extends xb.a{constructor(db){super();this.$=db;this.kc()}create(){this.Pb(this.$.da.Ba(435)||this.$.da.Ja(435,new ma(this.$)))}static la(db){db.da.Ja(436,new Ka(db))}}Object(b.a)(Ka,"PresenceTelemetryFactory",
xb.a,[]);var cb=a(1372),Fa=a(51),wa=a(48),ka=a(32),Oa=a(130),hb=a(16),Pa=a(20),ca=a(86);class ba extends ya.a{constructor(db){super();this.wte=db;this.bXc=this.Kta=null}get lVb(){return this.wte}get Mc(){return this.Kta||{}}set Mc(db){this.bXc=this.Kta;this.Kta=db;this.raiseEvent("userPresenceChanged")}get eOd(){return this.bXc}dispose(){this.raiseEvent("userPresenceChanged");this.raiseEvent("userLeft");this.bXc=this.Kta=this.wte=null;super.dispose()}}Object(b.a)(ba,"UserPresence",ya.a,[]);class ib extends ca.a{constructor(){super();
this.poe=this.noe=this.rB=null}get Gz(){return this.noe}ZYd(db){this.noe=db}get un(){return this.poe}tfg(db){this.poe=db}get Mc(){return this.rB.Mc}set Mc(db){this.rB.Mc=db}A3a(){}R7a(){return null}Rmd(){return null}mjg(){}njg(){}Rtg(){}bFc(){}vkc(){}static Ifk(db,U){const Ta=db.rB.Mc;Ra.a.Rc(db.Gz);Ra.a.Rc([db.rB]);db.rB=null;db.rB=new ba(U);db.ZYd([]);db.tfg(U);db.Mc=Ta}}Object(b.a)(ib,"IUserGridPresence",ca.a,[]);var Lb;(function(db){db[db.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";
db[db.peopleImageClassName=1]="peopleImageClassName";db[db.peopleImageClusterPath=4]="peopleImageClusterPath";db[db.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";db[db.imageDimension=6]="imageDimension";db[db.rtl=8]="rtl";db[db.pointerInputManager=9]="pointerInputManager";db[db.clickInputManager=10]="clickInputManager";db[db.vertical=11]="vertical";db[db.zIndex=12]="zIndex";db[db.contextMenuInputManager=13]="contextMenuInputManager";db[db.imageDomElement=14]="imageDomElement";
db[db.useIdleTooltip=15]="useIdleTooltip";db[db.viewportBoundsCallback=16]="viewportBoundsCallback";db[db.flipHorizontalDirection=17]="flipHorizontalDirection";db[db.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";db[db.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";db[db.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(Lb||(Lb={}));Object(b.b)("PresenceTooltipSettingKeys",Lb);class gc{constructor(){this.zQ={}}get(db,U=null){db=Lb[db];return"number"===typeof U?
(U=this.zQ[db])?Number.parseInvariant(U.toString()):0:this.zQ[db]}add(db,U){this.zQ[Lb[db]]=U}f1a(db,U){Lb[db]in this.zQ||(this.zQ[Lb[db]]=U)}remove(db){delete this.zQ[Lb[db]]}}Object(b.a)(gc,"PresenceTooltipSettings",null,[]);class Gc extends jb.a{constructor(db){super();this._element=null;this.element=db}get element(){return this._element}set element(db){this._element=db}get visible(){return"visible"===this.element.style.visibility}set visible(db){this.element.style.visibility=db?"visible":"hidden"}get rtl(){return"rtl"===
this.element.dir.toLowerCase()}set rtl(db){this.element.dir=db?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(db){this.element.style.zIndex=String(db)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(db){return this.element.ownerDocument.createElement(db)}oGc(){return!0}static hrh(db){return"prControl"+(db?"Rtl":"")}}Object(b.a)(Gc,"BasePresenceControl",jb.a,[2,77]);class Kb extends Sys.EventArgs{constructor(db,
U){super();this.type=db;this.$wa=U}}Kb.dna="InteractivityChanged";Object(b.a)(Kb,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class pb{static C3h(db){return pb.D3h(db)}static D3h(db){const U=document.createElementNS(pb.A9d,"svg");U.setAttribute("viewBox",String.format(pb.tth,pb.twg,pb.swg));U.appendChild(pb.Bfi(db));return U}static Bfi(db){const U=pb.twg/db,Ta=2*U,wb=pb.swg/2;db=(db-12-8)*U/2;const Qb=document.createElementNS(pb.A9d,"g");Sys.UI.DomElement.addCssClass(Qb,pb.sth);for(let sc=1;3>=
sc;sc++)Qb.appendChild(pb.U1h(sc,Ta,db+(6*sc-2)*U,wb));return Qb}static U1h(db,U,Ta,wb){const Qb=document.createElementNS(pb.A9d,"circle");Sys.UI.DomElement.addCssClass(Qb,String.format("{0}-{1}",pb.Odh,db));Qb.setAttribute("cx",String.format("{0}",Ta));Qb.setAttribute("cy",String.format("{0}",wb));Qb.setAttribute("r",String.format("{0}",U));return Qb}}pb.A9d="http://www.w3.org/2000/svg";pb.sth="prDancingDots";pb.Odh="prAnimateCircle";pb.tth="0 0 {0} {1}";pb.swg=40;pb.twg=120;Object(b.a)(pb,"ModernPresenceTooltipDancingDots",
null,[]);var nc=a(131),Wb=a(165),Ha=a(14),$a=a(93),Nb=a(133),rb=a(59),ec=a(34);class pc extends Gc{constructor(db,U){super(db);this.qte=this.Qsa=this.cOc=this.ZRc=this.MOc=this.FB=this.pj=null;this.vK=U.get(8,!1);this.mmb=U.get(6,0);this.eQg=U.get(15,!1);this.Re=U;this.kfe=0;this.element=db;this.element.className=pc.FUh;this.bI=document.createElement("span");this.element.appendChild(this.bI);this.XFg=pb.C3h(U.get(6,0));this.Uu(U);this._state=5}s2c(db){this.addHandler(Kb.dna,db)}Vzc(db){this.removeHandler(Kb.dna,
db)}get user(){return this.qte}get state(){return this._state}dispose(){this.element&&(this.pj.Aa(Ha.a.click,this.element,Object(f.a)(this,this.Gd,"onClick")),this.pj.Aa(Ha.a.dl,this.element,Object(f.a)(this,this.oGc,"stopPropagationAndPreventDefaultBehavior")),this.FB.Aa(Ha.a.pointerDown,this.element,Object(f.a)(this,this.onPointerDown,"onPointerDown")),this.FB.Aa(Ha.a.pointerOut,this.element,Object(f.a)(this,this.YO,"onPointerOut")),this.FB.Aa(Ha.a.pointerOver,this.element,Object(f.a)(this,this.cy,
"onPointerOver")),this.MOc.Aa(this.element,Object(f.a)(this,this.oGc,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}Uu(db){this.pj=db.get(10);this.pj.ta(Ha.a.click,this.element,Object(f.a)(this,this.Gd,"onClick"));this.pj.ta(Ha.a.dl,this.element,Object(f.a)(this,this.oGc,"stopPropagationAndPreventDefaultBehavior"));this.FB=db.get(9);this.FB.ta(Ha.a.pointerOver,this.element,Object(f.a)(this,this.cy,"onPointerOver"));this.FB.ta(Ha.a.pointerOut,this.element,Object(f.a)(this,this.YO,"onPointerOut"));
this.FB.ta(Ha.a.pointerDown,this.element,Object(f.a)(this,this.onPointerDown,"onPointerDown"));this.MOc=db.get(13);this.MOc.ta(this.element,Object(f.a)(this,this.oGc,"stopPropagationAndPreventDefaultBehavior"))}hide(db=null,U=0,Ta=0){this.eQg&&db?this.$Xj(db,U,Ta):(3===this.state&&this.n3f(),this.visible=!1,this._state=5)}$Xj(db,U,Ta=0){this.show(db,U,15,4,void 0,Ta)}Qhg(db,U,Ta=!1,wb=!1,Qb=!1,sc=0){this.show(db,U,20,Ta?2:wb?1:0,Qb,sc)}vXj(db,U,Ta,wb=!1,Qb=0){this.show(db,U,Ta+20,3,wb,Qb)}show(db,
U,Ta,wb=3,Qb=!1,sc=0){!db||wb===this.state&&this.Uni(U,Ta)||(this.rSg(wb,Qb,sc),this.h1a(db,wb,sc),this._state=wb,4===sc||0===sc&&!this.vK?this.element.style.left=U+"px":this.element.style.right=U+"px",this.element.style.top=Ta+"px",this.visible=!0)}h1a(db,U,Ta){this.qte=db;rb.a.fvb(this.bI);Nb.a.Heh(this.bI);this.bI.id="fly_"+db.clientId;this.bI.style.backgroundColor=db.color;4!==U?(this.bI.style.height=this.mmb+"px",this.bI.style.lineHeight=this.mmb+"px",Nb.a.yDa(this.bI,"border-radius",this.mmb+
"px")):4===Ta||0===Ta&&!this.vK?this.bI.style.left="0px":this.bI.style.right="0px";2!==U&&(4===U?rb.a.sDc(this.bI,""):1===U?this.bI.appendChild(this.XFg):(this.bI.setAttribute("dir","auto"),Ta=ec.a.P7h(db.userName),(!db.isAnonymous||k.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&Ta||0!==U?(db=db.userName,0===U&&(db=Ta,Nb.a.yDa(this.bI,"text-align","center")),rb.a.sDc(this.bI,db)):(this.ZRc||(this.ZRc=this.Zlh()),this.bI.appendChild(this.ZRc),
Nb.a.yDa(this.bI,"text-align","start"))))}Gd(db){if(0===this.state)return this.raiseEvent(Kb.dna,new Kb(1,db)),!0;3===this.state&&d.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}YO(db){3===this.state&&this.raiseEvent(Kb.dna,new Kb(3,db));return!1}cy(db){3!==db.Wb&&this.raiseEvent(Kb.dna,new Kb(2,db));return!1}onPointerDown(db){if(3!==db.Wb)return!0;this.raiseEvent(Kb.dna,new Kb(4,db));return!1}Zlh(){const db=document.createElement("img");db.src=nc.a.Lva("doughperson_white_glyph.svg");
db.setAttribute("Unselectable","on");$a.a.di(db,$a.a.fe,$a.a.ps);return Wb.createClusteredImageFromClusterWithImageClass(this.mmb,this.mmb,null,null,pc.IUh,"",!1,"",this.element.ownerDocument,db)}rSg(db,U=!1,Ta=0){if(!this.rEb(this.state)||!this.rEb(db))switch(Sys.UI.DomElement.removeCssClass(this.element,this.cOc),this.state){case 4:3===db?this.$ia(pc.ujd,pc.e5e):this.rEb(db)&&this.$ia(pc.sjd,pc.e5e);break;case 3:4===db?this.$ia(pc.xjd,pc.d5e):this.rEb(db)&&(U&&this.n3f(),this.$ia(pc.sjd,pc.d5e,
U?pc.HUh:""));break;case 0:case 1:case 2:4===db?this.$ia(pc.xjd,pc.vjd):3===db&&(U&&this.USg(),this.$ia(pc.ujd,pc.vjd,U?pc.g5e:"",3===Ta?pc.MUh:pc.KUh));break;default:4===db?this.$ia(pc.xjd):3===db?this.$ia(pc.ujd):this.rEb(db)&&this.$ia(pc.sjd)}}$ia(...db){this.cOc=db.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.cOc)}USg(){this.kfe=window.setTimeout(()=>{this.element&&(this.Qsa=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.Qsa),this.element.style.zIndex="2",this.Qsa.style.zIndex=
"1")},300)}n3f(){window.clearTimeout(this.kfe);this.Qsa&&(Sys.UI.DomElement.removeCssClass(this.Qsa,pc.vjd+" "+pc.g5e),Sys.UI.DomElement.addCssClass(this.Qsa,pc.GUh),w.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.Qsa.parentNode&&this.element.parentNode.removeChild(this.Qsa)}),Nb.a.pOb(this.element,"z-index"))}rEb(db){return 0===db||1===db||2===db}Uni(db,U){const Ta=Nb.a.VE(this.element.style.top);return Nb.a.VE(this.element.style.left)===db&&Ta===U}UTd(db){3===db&&
Nb.a.h5(this.element,"left")?(db=Nb.a.VE(this.element.style.left),Nb.a.pOb(this.element,"left"),this.element.style.right=-1*db+"px"):4===db&&Nb.a.h5(this.element,"right")&&(db=Nb.a.VE(this.element.style.right),Nb.a.pOb(this.element,"right"),this.element.style.left=-1*db+"px")}}pc.FUh="prModernFlyout UIFont";pc.xjd="flyoutIdle";pc.ujd="flyoutExpanded";pc.sjd="flyoutCollapsed";pc.e5e="flyoutFromIdle";pc.d5e="flyoutFromExpanded";pc.vjd="flyoutFromCollapsed";pc.g5e="flyoutStacked";pc.HUh="flyoutFromStacked";
pc.GUh="flyoutFadeOut";pc.IUh="cui-img-cont-float cui-img-20by20";pc.KUh="flyoutLtrDir";pc.MUh="flyoutRtlDir";Object(b.a)(pc,"ModernPresenceTooltipFlyoutControl",Gc,[]);class vb{constructor(db,U,Ta=2,wb=4){this.offsetTop=db;this.offsetLeft=U;this.pwg=Ta;this.Bkf=wb}}Object(b.a)(vb,"FlyoutsPositioningInfo",null,[]);var ob=a(41);class Tb{constructor(db=!1,U=!1){this.Vj=db;this.yQc=U}K8h(db,U,Ta,wb,Qb){const sc=Qb.y,Vc=Qb.height;var Ld=this.F0h(wb);const le=Ld+U,Ce=db*Ta+2*(db-1);Ta=null;1===db||this.Bah(Ld,
Ce,sc,Vc)?db=new vb(0,0,2):(db=this.hjd(le,Ce,sc,Vc),db.offsetTop-=Ld);this.yQc?Ta=new vb(0,0,void 0,this.Vj?4:3):(wb=this.E0h(wb,Qb),Ld=Math.max(0,Qb.x),Qb=Qb.width,U=wb+U,this.Cah(wb,Ld,Qb)?Ta=new vb(0,0,void 0,this.Vj?3:4):this.Dah(U,Ld)&&(Ta=new vb(0,0,void 0,this.Vj?4:3)),Ta||(Ta=this.VTh(wb,U,Ld,Qb)));return new vb(db.offsetTop,Ta.offsetLeft,db.pwg,Ta.Bkf)}F0h(db){return ob.a.D0h(db)}E0h(db,U){return this.Vj?U.width-ob.a.C0h(db):ob.a.B0h(db)}Bah(db,U,Ta,wb){return db+U<=Ta+wb}hjd(db,U,Ta,wb){let Qb=
1,sc=Math.max(Ta,db-U);U>db-Ta&&(Qb=2,sc=U<wb?wb-U:Ta);return new vb(sc,0,Qb)}Cah(db,U,Ta){return db+150<=U+Ta}Dah(db,U){return 150<=db-U}VTh(db,U,Ta,wb){wb-U>=db-Ta?db=4:(U=db,db=3);return new vb(0,U,void 0,db)}}Object(b.a)(Tb,"ModernPresenceTooltipPositioner",null,[]);class Rd{constructor(db,U,Ta,wb,Qb,sc,Vc){this.TM=db;this._parent=U;this.yce=Ta;this.wEg=wb;this.hIg=Qb;this.r0a=sc;this.vK=Vc;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(db,
U){if(3!==db)if(5!==db&&this.TM&&this.TM.length){if(4===db){var Ta=this.hIg;var wb=(this.r0a-Ta)/2;this.element.style.height=this.r0a+"px";this.element.style.width=this.r0a+"px";db=Nb.a.VE(this.TM[0].element.style.top);U=Nb.a.VE(this.vK?this.TM[0].element.style.right:this.TM[0].element.style.left)}else Ta=this.yce,wb=(this.r0a-Ta)/2,this.element.style.height=this.r0a+"px",this.element.style.width=this.f2h()+2*wb+"px",db=Nb.a.VE(this.TM[this.TM.length-1].element.style.top),U=this.X$g(this.TM[this.TM.length-
1].element,Ta,U);Nb.a.yDa(this.element,"border-radius",this.r0a+"px");this.element.style.top=db-wb-Ta+"px";this.vK?this.element.style.right=U-wb+"px":this.element.style.left=U-wb+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}X$g(db,U,Ta){return this.vK&&!Ta?Nb.a.VE(db.style.right):this.vK||Ta?this.vK&&Ta?-Nb.a.VE(db.style.left)-U:-Nb.a.VE(db.style.right)-U:Nb.a.VE(db.style.left)}f2h(){return this.TM&&
this.TM.length?this.yce+Math.min(this.TM.length-1,2)*this.wEg:0}}Object(b.a)(Rd,"ModernPresenceTooltipTarget",null,[]);var Jd=a(140),ld=a(234);class Yd extends Gc{constructor(db,U,Ta){super(db);this.K_a=this.naa=this.oZb=this.FGa=!1;this.LB=[];this.hZb={};this.Re=Ta;this.Vj=Ta.get(8,!1);this.Qge=Ta.get(15,!1);this.CFg=Ta.get(12,0);this.mva=Ta.get(6,0);this.V1b=U;this.Ote=Ta.get(16);this.yQc=Ta.get(17,!1);Ta.get(19,!1);this.cMg=Ta.get(20,!1);this.d_b=0;this.ZLg=new Tb(this.Vj,this.yQc);this.Pkb=this.H9e();
this.IWc=!1;this.kha=[];this.tnb=[];this.element.id=Yd.RXh();this.element.className=Gc.hrh(this.Vj);this.oxb&&(this.zIndex=this.oxb);this.rtl=this.Vj;this.fMj(U);this.Jha=this.createElement("div");this.Jha.className="prFlyoutContainer";this.element.appendChild(this.Jha);this.TM=[];this.Xsa=new Rd(this.nL,this.element,this.mva,4,6,32,this.Vj);this.FB=Ta.get(9);this.FB.ta(Ha.a.pointerDown,this.Xsa.element,Object(f.a)(this,this.Rcb,"onHitTarget"));this.FB.ta(Ha.a.pointerOver,this.Xsa.element,Object(f.a)(this,
this.Rcb,"onHitTarget"));this.FB.ta(Ha.a.pointerOut,this.Xsa.element,Object(f.a)(this,this.Rcb,"onHitTarget"))}get Hxc(){return ld.a.clone(this.LB)}get nL(){return this.TM}get oxb(){return this.CFg}get Dla(){return this.nL?this.nL.length:0}get vEa(){return 0<this.Dla?this.nL[0].state:5}get sqf(){return 3===this.vEa&&!this.FGa}s2c(db){this.addHandler(Kb.dna,db)}Vzc(db){this.removeHandler(Kb.dna,db)}dispose(){if(this.sqf)this.IWc=!0;else{if(this.nL)for(const db of this.nL)db.Vzc(Object(f.a)(this,this.Ucb,
"onInteractivityChanged")),Ra.a.Ka(db);this.TM=null;this.FB.Aa(Ha.a.pointerDown,this.Xsa.element,Object(f.a)(this,this.Rcb,"onHitTarget"));this.FB.Aa(Ha.a.pointerOver,this.Xsa.element,Object(f.a)(this,this.Rcb,"onHitTarget"));this.FB.Aa(Ha.a.pointerOut,this.Xsa.element,Object(f.a)(this,this.Rcb,"onHitTarget"));super.dispose()}}xY(){this.CKa();this.visible=!0}xga(){this.visible=!0;this.r2e();this.FGa=!0}hide(){this.B3f();this.Tjf();this.Xsa.update(this.vEa,this.K_a)}h1a(db){const U=this.vEa,Ta=this.FGa;
db.clientId||(db.clientId=(Yd.Che++).toString());if(db.clientId in this.hZb){var wb=this.gzb(db.clientId);if(0<=wb){wb=this.LB[wb];if(wb.color===db.color&&wb.userName===db.userName)return;this.Efb(db.clientId)}}this.hide();wb=new pc(this.createElement("div"),this.Re);wb.s2c(Object(f.a)(this,this.Ucb,"onInteractivityChanged"));this.Jha.insertBefore(wb.element,this.Jha.firstChild);this.hZb[db.clientId]=wb;Array.add(this.LB,db);Array.add(this.nL,wb);this.Aug(U,Ta);this.visible=!0}Efb(db){if(this.sqf)Array.add(this.tnb,
db);else{var U=this.vEa,Ta=this.FGa;this.hide();this.O3f(db);this.Aug(U,Ta)}}$bb(db){const U=this.gzb(db);if(!(0>=U)){var Ta=this.LB[U];db=this.hZb[db];Array.removeAt(this.LB,U);Array.insert(this.LB,0,Ta);Array.removeAt(this.nL,U);Array.insert(this.nL,0,db);this.Jha.removeChild(db.element);this.Jha.appendChild(db.element);this.CKa()}}Aug(db,U){0>=this.LB.length?this.hide():3===db&&U?this.xga():this.xY()}xRb(db,U){U?this.QRg(db):this.U2f(db)}kqa(db){db!==this.oZb&&(this.oZb=db,this.BYd(db))}position(db,
U){this.element.style.top=U+"px";this.element.style.left=db+"px"}CKa(db=!1){if(!db||this.naa){this.oZb&&this.BYd(!0);var U=Math.min(3,this.Dla)-1;db=0;var Ta=1,wb=0;this.K_a&&(db=this.Pkb,Ta=-1,wb=-this.mva);for(let Qb=this.Dla-1;Qb>U;Qb--)this.nL[Qb].Qhg(this.LB[Qb],-4*U*Ta+wb,!0,!1,!0,db);for(;0<=U;U--)this.nL[U].Qhg(this.LB[U],-4*U*Ta+wb,0<U,Array.contains(this.kha,this.LB[U].clientId),U!==this.d_b,db);this.d_b=0;this.Xsa.update(0,this.K_a);this.zIndex=this.oxb;this.FGa=!1;this.B3f(0);this.IWc&&
this.dispose()}}r2e(){this.oZb&&this.BYd(!1);this.zIndex=this.oxb+1;let db,U,Ta;({offsetX:U,offsetY:db,Akf:Ta}=this.rOj());for(let wb=0;wb<this.Dla;wb++)this.nL[wb].vXj(this.LB[wb],U,db+(this.mva+2)*wb,wb!==this.d_b,Ta)}Tjf(){let db=0,U=0;this.K_a&&(db=this.Pkb,U=-6);for(let Ta=0;Ta<this.Dla;Ta++)this.nL[Ta].hide(this.LB[Ta],U,db);this.zIndex=this.oxb;this.visible=this.FGa=!1;this.IWc&&this.dispose()}p9c(db=0){db?(this.naa=!0,w.Task.delay(db).continueWith(()=>{this.Qge?this.ppi():this.CKa(!0);this.naa=
!1})):this.Qge?this.hide():this.CKa()}ppi(){this.naa&&this.hide()}t5g(){if(k.AFrameworkApplication.sa&&k.AFrameworkApplication.sa.Qa.Sx&&Jd.c()){const db=appChrome.selectors.getShyState();return db.isActive&&0!==db.state}return!1}Ucb(db,U){db=this.vEa;this.t5g()||2!==U.type&&(4!==U.type||3===db)?4===U.type&&3===db?(this.naa&&(this.naa=!1),this.p9c()):3!==U.type||3!==db||this.FGa||(1<this.Dla?(this.naa=!0,w.Task.delay(250).continueWith(()=>{this.CKa(!0);this.naa=!1})):this.p9c()):(this.naa&&(this.naa=
!1),3!==db&&(this.r2e(),3===U.$wa.Wb&&this.p9c(2E3)));this.raiseEvent(Kb.dna,U)}Rcb(db){3===db.Wb?this.Ucb(this,new Kb(4,db)):db.eventName===Ha.a.pointerOver?this.Ucb(this,new Kb(2,db)):db.eventName===Ha.a.pointerOut&&this.Ucb(this,new Kb(3,db));return!1}fMj(db){this.element.style.width=db+"px";this.element.style.height=this.mva+"px"}O3f(db){this.U2f(db);db=this.gzb(db);if(!(0>db)){var U=this.LB[db];Array.removeAt(this.LB,db);delete this.hZb[U.clientId];U=this.nL[db];this.Jha.removeChild(U.element);
this.Re.get(18,!1)&&U.Vzc(Object(f.a)(this,this.Ucb,"onInteractivityChanged"));Array.removeAt(this.nL,db);U.dispose()}}B3f(db=5){if(this.tnb.length){this.visible&&this.Tjf();for(let U=0;U<this.tnb.length;U++)this.O3f(this.tnb[U]);Array.clear(this.tnb);0>=this.LB.length||5===db?this.hide():0===db&&this.xY()}}gzb(db){for(let U=0;U<this.LB.length;U++)if(this.LB[U].clientId===db)return U;return-1}QRg(db){if(-1===this.gzb(db))d.ULS.sendTraceTag(41706451,302,15,"Cannot set active editor because client id is invalid");
else{if(Array.contains(this.kha,db)){if(this.LB[0].clientId===db)return;Array.remove(this.kha,db)}Array.add(this.kha,db);this.$bb(db);1!==this.vEa&&this.CKa()}}U2f(db){-1===this.gzb(db)?d.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.kha,db)&&(Array.remove(this.kha,db),this.LB[0].clientId===db&&0<this.kha.length&&this.$bb(this.kha[this.kha.length-1]),this.LB[0].clientId===db&&1===this.vEa&&this.CKa())}BYd(db){db?Sys.UI.DomElement.addCssClass(this.Jha,
"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.Jha,"prBackgroundSelection")}rOj(){let db,U;U=db=0;var Ta=this.Pkb;if(this.Ote){const wb=this.Ote(this);if(!wb)return{offsetX:db,offsetY:U,Akf:Ta};const Qb=4===this.vEa;Ta=this.ZLg.K8h(this.Dla,Qb?6:this.mva,this.mva,this.element,wb);U=Ta.offsetTop;this.d_b=this.L7h(Ta.pwg,Ta.offsetTop);Ta=Ta.Bkf;Ta!==this.Pkb&&(this.UTd(Ta),this.element.dir=3===Ta?"rtl":"ltr",this.Pkb=Ta);Ta!==this.H9e()?(db=this.cMg?-2:Qb?-6:-this.mva,this.K_a=!0):this.K_a=
!1}return{offsetX:db,offsetY:U,Akf:Ta}}L7h(db,U){if(1===db)return this.Dla-1;db=Math.abs(U);return 0<db?db/(this.mva+2):0}UTd(db){for(let U=0;U<this.Dla;U++)this.nL[U].UTd(db)}H9e(){return this.Vj?3:4}static RXh(){return String.format("{0}-{1}","presencetooltip",Yd.Che++)}}Yd.Che=0;Object(b.a)(Yd,"ModernPresenceTooltipControl",Gc,[113,2]);var Ke=a(231),Bb=a(364),Ob=a(248);class ed{constructor(db){this.Re=db;this.Re.f1a(10,Ke.a.instance);this.Re.f1a(9,Ob.a.instance);this.Re.f1a(6,20);this.Re.f1a(13,
Bb.a.instance);this.Re.f1a(17,!1)}Kmh(){var db=document.createElement("div");this.Re.f1a(15,!1);return new Yd(db,20,this.Re)}}Object(b.a)(ed,"ModernPresenceTooltipFactory",null,[114]);var Sd=a(152),Pd=a(19),ic=a(67),Kc=a(171),dc=a(13),Hc=a(38),Uc=a(359),Fd;(function(db){db[db.none=0]="none";db[db.master=1]="master";db[db.fixed=2]="fixed";db[db.horizontal=3]="horizontal";db[db.vertical=4]="vertical";db[db.first=1]="first";db[db.last=4]="last"})(Fd||(Fd={}));Object(b.b)("PaneType",Fd);const Td=(db,
U,Ta)=>{if(!U)return null;db=db.So;return new Sys.UI.Point(U.x+db.x*(Ta?1:-1),U.y+db.y*(Ta?1:-1))};class ad extends ya.a{constructor(db,U,Ta){super();this.tWf=this.ZBa=null;this.TVd=!1;this.SA=()=>{this.xsd()};this.VG=()=>{this.xsd()};this.gridView=db;this.rtl=db.rtl;this.yxd=!1;this.Xm=new Hc.a(!0);for(let wb=0;4>wb;wb++)if(this.gridView.Cb.xyd(Ta,ad.jOa()[wb])||1===ad.jOa()[wb]){const Qb=U.Kmh(),sc=db.og(ad.jOa()[wb]).domElement;sc.insertBefore(Qb.element,sc.firstChild);this.Xm.add(Enum.toString(Fd,
ad.jOa()[wb]),Qb)}}s2c(db){this.addHandler("interactivityChanged",db)}Vzc(db){this.removeHandler("interactivityChanged",db)}get element(){return null}get Hxc(){const db=Hc.a.nd(this.Xm.Mv,Enum.toString(Fd,ad.jOa()[0]));return db?db.Hxc:null}get Yjj(){return this.tWf}dispose(){if(0<this.Xm.count){this.hide();const db=this.Xm.Mv;for(let U in db)db[U].dispose()}this.gridView=null;this.Xm.clear();super.dispose()}oPj(db){this.tWf=db}xY(){const db=this.Xm.Mv;for(let U in db)db[U].xY()}xga(){this.xsd();
const db=this.Xm.Mv;for(let U in db)db[U].xga()}hide(){this.fXa();const db=this.Xm.Mv;for(let U in db)db[U].hide()}h1a(db){const U=this.Xm.Mv;for(let Ta in U)U[Ta].h1a(db)}$bb(db){const U=this.Xm.Mv;for(let Ta in U)U[Ta].$bb(db)}Efb(db){const U=this.Xm.Mv;for(let Ta in U)U[Ta].Efb(db)}xRb(db,U){const Ta=this.Xm.Mv;for(let wb in Ta)Ta[wb].xRb(db,U)}kqa(db){this.yxd!==db&&(this.yxd=db,db=Hc.a.nd(this.Xm.Mv,Enum.toString(Fd,ad.jOa()[0])),this.ZBa&&db&&(db=dc.DOMElementExtensions.getWidth(db.element)/
2,this.position(this.yxd?this.ZBa.x+14+db:this.ZBa.x-14-db,this.ZBa.y)))}position(db,U){const Ta=this.Xm.Mv;for(let sc in Ta){var wb=Ta[sc],Qb=Enum.parse(Fd,sc);Qb=this.gridView.og(Qb);const Vc=Td(Qb,new Sys.UI.Point(db,U),!1);this.ZBa=new Sys.UI.Point(db,U);0>Vc.x&&(Vc.x+=Qb.domElement.scrollLeft);dc.DOMElementExtensions.updatePosition(wb.element,Vc.x,Vc.y,!1,this.rtl)}}xsd(){this.ZBa&&(this.position(this.ZBa.x,this.ZBa.y),this.TVd||(this.TVd=!0,this.gridView.Ca.gI(this.SA),this.gridView.Ca.mv(this.SA),
this.gridView.view.ls(this.VG)))}fXa(){this.TVd&&(this.gridView.Ca.BJ(this.SA),this.gridView.Ca.Lt(this.SA),this.gridView.view.oq(this.VG))}static jOa(){return ad.oba||(ad.oba=[1,3,2,4])}}ad.oba=null;Object(b.a)(ad,"PaneInvariantTooltip",ya.a,[113,2]);class Qd{}Qd.$Rb=!1;Qd.Bqa=!1;Object(b.a)(Qd,"PresenceViewSettings",null,[]);class Zb{constructor(db){this.Soc=!1;this.Pu=this.Era=this.nXf=null;this.NKb=U=>{const Ta=this.pda(U.Rz);Ta&&this.Fzc(Ta,U.eCa.clientId,U.Rz)};this.sLb=U=>{this.SJ(!1,U)};this.rLb=
U=>{this.SJ(!0,U)};this.SA=()=>{this.Bug()};this.VG=()=>{this.Bug()};this.IBa=()=>{this.pwb();this.clearCache()};this.Khi=U=>{U=dc.DOMElementExtensions.getBounds(U.element);U=new ic.a(U.x,U.y,U.width,U.height);for(const wb of ad.jOa()){var Ta=this.gridView.og(wb);Ta=dc.DOMElementExtensions.getBoundingClientRect(Ta.domElement);if((new ic.a(Ta.x,Ta.y,Ta.width,Ta.height)).Nd(U))return Ta}return null};this.Rgk=()=>{const U=this.QA;for(let Ta in U){const wb=U[Ta];if(wb){const Qb=wb.NPa(),sc=this.pda(wb.Rz),
Vc=Qb?this.Qcf(wb.Gxc,wb.paneType,wb.range):null;if(Vc!==sc){sc&&this.Fzc(sc,wb.eCa.clientId,wb.Rz);if(!Qd.Bqa)break;Vc&&Qb&&(Vc.h1a(wb.eCa),this.AXa[wb.Rz]=Vc,wb.gTb(Vc),this.rif(Vc,wb))}else this.rif(sc,wb)}}};this.qqi=Pd.a.$Kh;this.SOa=20;this.gridView=Pa.h(db);this.$=db;this.OMb={};this.AXa={};this.QA={};this.yXa={};this.$.ua&&this.$.ua.Lg(this.IBa);this.pwb()}dispose(){this.fXa();this.clearCache();this.$&&this.$.ua&&this.$.ua.ih(this.IBa);this.gridView=null}fXa(){this.Soc&&(this.gridView.Ca.BJ(this.SA),
this.gridView.Ca.Lt(this.SA),this.gridView.view.oq(this.VG),this.Soc=!1)}pbk(db){const U=this.QA[db],Ta=this.pda(db);U&&this.m3f(U);Ta&&this.Fzc(Ta,U.eCa.clientId,U.Rz);delete this.AXa[db];delete this.QA[db];delete this.yXa[db]}y7d(db){const U=db.Rz;this.QA[U]||(this.P8a(db),this.QA[U]=db)}d7d(db){this.Pu=db;this.u$i(db)}Wgk(db){const U=db.Rz,Ta=this.Qcf(db.Gxc,db.paneType,db.range),wb=this.pda(U);Ta&&Ta!==wb&&(db.gTb(Ta),this.AXa[U]=Ta,this.QA[U]=db,this.yXa[U]&&Ta.kqa(this.yXa[U]));wb!==Ta&&wb&&
this.Fzc(wb,db.eCa.clientId,db.Rz);!this.Soc&&this.gridView&&(this.gridView.Ca.gI(this.SA),this.gridView.Ca.mv(this.SA),this.gridView.view.ls(this.VG),this.Soc=!0)}Fzc(db,U,Ta){db.Efb(U);fb.EwaSettings.isChangeGateEnabled("OfficeVSO:3663630_ModernPresenceUxPerf")&&this.pda(Ta)===db&&delete this.AXa[Ta];db.Hxc&&db.Hxc.length||((U=db.Yjj)&&delete this.OMb[U],fb.EwaSettings.isChangeGateEnabled("OfficeVSO:3663630_ModernPresenceUxPerf")||this.pda(Ta)===db&&delete this.AXa[Ta],db.dispose())}m3f(db){db&&
(db.nSd(this.NKb),db.LSd(this.sLb),db.KSd(this.rLb),db.gTb(null))}P8a(db){db.q2c(this.NKb);db.T2c(this.sLb);db.S2c(this.rLb)}SJ(db,U){if(Qd.Bqa){U.Bla||this.y7d(U);this.Wgk(U);var Ta=this.pda(U.Rz);Ta&&(Ta.h1a(U.eCa),this.Pu===U.Rz&&Ta.$bb(U.Rz),U.NPa()?db?Ta.xga():Ta.xY():Ta.hide())}}u$i(db){const U=this.pda(db);Sd.a(()=>{null===U||void 0===U?void 0:U.$bb(db)},this.$.ka)}pda(db){return this.AXa[db]}Qcf(db,U,Ta){if(!db)return null;db=this.wnd(db,U,Ta);var wb=this.gridView.og(U).So;U=Zb.$ai(db,U,wb).toString();
wb=Hc.a.nd(this.OMb,U);wb||(wb=new ad(this.gridView,this.nXf,Ta),wb.position(db.x,db.y),wb.oPj(U),this.OMb[U]=wb);return wb}wnd(db,U,Ta){const wb=this.gridView.og(U).am,Qb=this.gridView.og(U).So;U=Uc.a.XN(U,wb.topLeft);let sc=Math.max(Qb.x,db.x-this.SOa/2-2);sc=Math.min(Math.max(U.x+Qb.x,sc),U.x+Qb.x+wb.width-this.SOa);db=Math.max(Qb.y,db.y-this.SOa/2+1);if(U.y+Qb.y>db||this.T7j(Ta))sc=Math.min(sc+this.SOa/4,U.x+Qb.x+wb.width-this.SOa);db=Math.min(Math.max(U.y+Qb.y,db),U.y+Qb.y+wb.height-this.SOa);
return new Sys.UI.Point(sc,db)}clearCache(){var db=this.QA;for(let U in db)this.m3f(db[U]);db=this.OMb;for(let U in db)db[U].dispose();this.AXa={};this.QA={};this.OMb={};this.yXa={};Ra.a.Ka(this.Era);this.Era=null}pwb(){const db=new gc;db.add(0,Pd.a.G_e);db.add(1,this.qqi);db.add(12,49);db.add(6,this.SOa);this.gridView&&(db.add(4,X.a.dg(3)),db.add(5,X.a.dg(3)),db.add(8,this.gridView.rtl));db.add(18,!0);this.nXf=new ed(db);db.add(16,this.Khi)}Bug(){Qd.Bqa&&(this.Era=Kc.AsyncMethodContext.vr(this.Rgk,
100,wa.a.mlj,this.Era))}rif(db,U){Qd.Bqa&&(this.yXa[U.Rz]&&db.kqa(this.yXa[U.Rz]),U.NPa()?U.Cqa(!0,!0):U.Cqa(!1,!0))}kqa(db,U){this.yXa[db]=U;(db=this.pda(db))&&db.kqa(U)}xRb(db,U){const Ta=this.pda(db);Ta&&Ta.xRb(db,U)}static $ai(db,U,Ta){return db.x.toString()+"-"+db.y.toString()+"-"+U.toString()+"-"+Ta.x.toString()+"-"+Ta.y.toString()}T7j(db){var U;db=Pa.h(this.$).Ca.Sla(db.topRight);return null===(U=null===db||void 0===db?void 0:db[0])||void 0===U?void 0:U.Hma}}Object(b.a)(Zb,"PresenceTooltipManager",
null,[2]);var Wc=a(109),md=a(122);class Nd extends ya.a{constructor(db,U,Ta,wb,Qb){super();this.sz=[];this.Z2a=null;this.visible=!1;this.ptb=this.vHb=null;this.Bla=!1;this.tZj=()=>{Ra.a.Ka(this.ptb);this.ptb=null;this.visible&&(this.NPa()?this.raiseEvent("showPresenceTooltip"):this.W6(!0))};this.MJd=sc=>{this.Efb(sc)};this.SA=()=>{this.zsg()};this.VG=()=>{this.zsg()};this.domElement=db;this.gridView=U;this.D_c=db.id;this.Fta=wb;this.$=Qb;this.Roc=!1;this.xkf();this.YWc=Ta;this.Hf=null;this.vD={};
this.vD.FirstColumn=0;this.vD.FirstRow=0;this.vD.LastColumn=0;this.vD.LastRow=0}q2c(db){this.addHandler("hidePresenceTooltip",db)}nSd(db){this.removeHandler("hidePresenceTooltip",db)}T2c(db){this.addHandler("showPresenceTooltip",db)}LSd(db){this.removeHandler("showPresenceTooltip",db)}S2c(db){this.addHandler("showFullPresenceTooltip",db)}KSd(db){this.removeHandler("showFullPresenceTooltip",db)}$Ia(db){this.addHandler("presenceChanged",db)}NCa(db){this.removeHandler("presenceChanged",db)}get Rz(){return this.D_c}get eCa(){return this.YWc}get paneType(){return this.Fta}get Gxc(){if(!this.domElement)return null;
var db=this.gridView.og(this.paneType).am,U=this.gridView.rtl,Ta=this.domElement.offsetWidth;if(!this.Hf&&4>=Ta){if(this.vD){Ta=this.gridView.hk;var wb=this.vD.FirstRow;U=U?this.vD.FirstColumn:this.vD.LastColumn;if(Ta&&!(wb>=Ta.top&&wb<=Ta.bottom&&U>=Ta.left&&U<=Ta.right))return wb=wb<=Ta.top?db.y:db.y+(wb>=Ta.bottom?db.height:db.height/2),U=U<=Ta.left?db.x:db.x+(U>=Ta.right?db.width:db.width/2),this.vHb=new Sys.UI.Point(U,wb)}return this.vHb}if(this.Hf){db=this.domElement.offsetTop-2;wb=parseInt(this.domElement.style.left,
10);let Qb=0;U&&(Qb=parseInt(this.domElement.parentNode.style.width,10)-Ta-wb,Qb-=this.gridView.pT.BQa&&this.gridView.pT.nAd?md.a.Uv:0);return this.vHb=new Sys.UI.Point((U?Qb:wb)+Ta+4,db)}return this.vHb=new Sys.UI.Point(parseInt(U?this.domElement.style.right:this.domElement.style.left,10)+Ta,this.domElement.offsetTop)}get range(){return Ia.E(this.vD)}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.dKe();this.fXa();Ra.a.Ka(this.ptb);this.domElement=this.gridView=
null;super.dispose()}S0d(db,U){const Ta=!!db&&!Ia.E(db).equals(Ia.E(this.vD)),wb=!!U&&(!this.Hf||this.Hf.get_id()!==U.get_id());if(Ta||wb)this.raiseEvent("presenceChanged"),this.dKe(),this.Bla=!1,this.vD=db,this.Hf=U,this.vHb=null}W6(db){this.visible=this.Bla=!1;db&&this.raiseEvent("hidePresenceTooltip")}bja(db){this.sz.push(db);this.xkf();db.$Ia(this.MJd)}Cqa(db,U){db?(this.visible=!0,U&&(this.ptb=Kc.AsyncMethodContext.vr(this.tZj,this.$.xa.ShowTooltipDelayInMs,wa.a.$7j,this.ptb))):this.W6(U)}gTb(){}Ljb(){if(this.domElement&&
this.visible){this.Z2a=dc.DOMElementExtensions.getBoundingClientRect(this.domElement);const db=Math.floor(this.Z2a.x);this.Z2a.x=db===this.Z2a.x?db:db+1;this.Z2a.y=Math.floor(this.Z2a.y)}}NPa(){if(!this.vD)return!1;const db=this.hbi();return db?this.gridView.TFi(db,this.paneType):!1}hbi(){if(this.range.isSingle){var db=this.gridView.Ca.Yxa(this.range,this.$.activeItemName);return db?(db=db.xt(this.range))?db.mE:null:null}return this.range}dKe(){for(let db=0,U=this.sz.length;db<U;db++)this.sz[db].NCa(this.MJd);
this.sz.length=0;this.fXa()}xkf(){!this.Roc&&1<=this.sz.length&&(this.Roc=!0,this.gridView.Ca.gI(this.SA),this.gridView.Ca.mv(this.SA),this.gridView.view.ls(this.VG))}fXa(){this.Roc&&!this.sz.length&&(this.Roc=!1,this.gridView&&(this.gridView.Ca.BJ(this.SA),this.gridView.Ca.Lt(this.SA),this.gridView.view.oq(this.VG)))}Efb(db){db.NCa(this.MJd);Array.remove(this.sz,db);this.fXa()}zsg(){this.Ljb();for(let db=0,U=this.sz.length;db<U;db++)this.sz[db].Ljb()}}Object(b.a)(Nd,"TooltipNotificationUnit",ya.a,
[880,2]);class kd extends ya.a{constructor(db,U,Ta,wb,Qb,sc,Vc,Ld){super();this.hc=null;this.QA={};this.Que=0;this.Hf=this.yua=null;this.Fta=0;this.NKb=le=>{this.yua&&this.yua!==le||(this.yua=null,this.W6(!1));this.raiseEvent("hidePresenceTooltip")};this.sLb=le=>{this.yua&&this.yua!==le||(this.yua=null,this.Cqa(!0,!1));this.raiseEvent("showPresenceTooltip")};this.rLb=le=>{this.yua||this.raiseEvent("showFullPresenceTooltip");this.yua=le};this.jLb=()=>{this.W6(!1);this.raiseEvent("presenceChanged")};
Ld=Ta===hb.a.instance.Lb(87)||Ld;this.YWc=new sb.a(U,Ta,wb,new Jb.a,null,null,null,null,Ld);this.gridView=db;this.D_c=U;this.highlight=Qb;this.Hz=sc;this.$=Vc}q2c(db){this.addHandler("hidePresenceTooltip",db)}nSd(db){this.removeHandler("hidePresenceTooltip",db)}T2c(db){this.addHandler("showPresenceTooltip",db)}LSd(db){this.removeHandler("showPresenceTooltip",db)}S2c(db){this.addHandler("showFullPresenceTooltip",db)}KSd(db){this.removeHandler("showFullPresenceTooltip",db)}$Ia(db){this.addHandler("presenceChanged",
db)}NCa(db){this.removeHandler("presenceChanged",db)}get Rz(){return this.D_c}get eCa(){return this.YWc}get paneType(){return this.Fta}get range(){return this.hc}get Gxc(){return this.hc||this.Hf?Td(this.gridView.og(this.paneType),this.gya(this.paneType).Gxc,!0):null}get Bla(){return this.gya(this.paneType).Bla}set Bla(db){const U=this.QA;for(let Ta in U)U[Ta].Bla=db}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.Hz&&this.Hz.pbk(this.Rz);const db=this.QA;
for(let U in db){const Ta=db[U];Ta.nSd(this.NKb);Ta.LSd(this.sLb);Ta.KSd(this.rLb);Ta.NCa(this.jLb);Ta.dispose()}this.Hz=this.hc=this.highlight=this.gridView=this.QA=null;super.dispose()}xjg(db,U,Ta=null){db?(this.hc=Ia.E(db),this.Fta=this.gridView.Cb.ti(this.hc.topRight)):Ta?(this.Hf=Ta,this.Fta=Ta.Dg.paneType):this.Fta=1;this.Que=U;this.gya(this.paneType);this.S0d(db,Ta)}S0d(db,U){const Ta=this.QA;for(let wb in Ta)Ta[wb].S0d(db,U)}W6(db){this.gya(this.paneType).W6(db);db=this.QA;for(let U in db)db[U].W6(!1)}Bwe(db){const U=
this.QA;for(let Ta in U){const wb=U[Ta];wb.bja(db.gya(wb.paneType))}}bja(db){this.gya(db.paneType).bja(db)}NPa(){let db=this.gya(this.paneType).NPa();const U=this.QA;for(let Ta in U)db=U[Ta].NPa()||db;return db}Cqa(db,U){this.Hz.y7d(this);this.gya(this.paneType).Cqa(db,U);U=this.QA;for(let Ta in U)U[Ta].Cqa(db,!1)}gTb(db){const U=this.QA;for(let Ta in U)U[Ta].gTb(db)}Ljb(){const db=this.QA;for(let U in db)db[U].Ljb();this.Hz.y7d(this)}gya(db){return this.fai(db,this.Que)}d7d(db){this.Hz.d7d(db)}fai(db,
U){const Ta=this.highlight?this.highlight.nE(U,db).Fg:this.Hf?this.Hf.get_element():null;U=kd.Wgi(U,db);let wb=Hc.a.nd(this.QA,U);wb||(wb=new Nd(Ta,this.gridView,this.eCa,db,this.$),this.QA[U]=wb,wb.q2c(this.NKb),wb.T2c(this.sLb),wb.S2c(this.rLb),wb.$Ia(this.jLb));return wb}static Wgi(db,U){return db.toString()+U.toString()}}Object(b.a)(kd,"PaneInvariantTooltipNotificationUnit",ya.a,[880,2]);class yd{constructor(db,U,Ta){this.Hf=this.objectId=this.KYb=null;this.un=db;this.$=U;this.Hz=Ta;this.Pv=new kd(Pa.h(this.$),
this.un.User.UserID,this.un.User.UserName,this.un.UserColor,null,Ta,this.$,this.un.IsAnonymous)}get Hf(){return this.KYb}set Hf(db){this.KYb=db}dispose(){this.aDb();Ra.a.Ka(this.Pv);this.objectId=this.$=this.un=this.Hf=null}bja(db){this.Pv.Bwe(db.Pv)}aDb(){this.Hf&&this.un&&this.un.User&&(this.Hf.iJc(!1,this.un.User.UserID,null),this.Pv.W6(!0))}vSb(){Qd.$Rb&&this.Hf&&this.un&&this.un.User&&(this.Hf.iJc(!0,this.un.User.UserID,this.un.UserColor),this.Pv.Ljb())}SJ(db){Qd.Bqa&&(this.Pv.Bla=db,this.Pv.Cqa(db,
!0))}DSb(db,U){this.Pv.xjg(null,0===U?49:50,db)}}Object(b.a)(yd,"FloatingObjectPresenceHighlight",null,[863,2]);var lc=a(642),Lc=a(75),nd=a(12),Wd=a(263),$d=a(160);class se extends lc.a{constructor(db,U,Ta){super(U,Pa.h(U),!0,!1,db.User.UserID);this.qz=[];this.Mnc=this.zSb=!1;this.B1=()=>{fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7486785_FixPresenterPresenceHighlightJSCrash")&&!this.qz||this.un.User.UserID!==this.BBb()||(d.ULS.sendTraceTag(521143967,0,50,`PresenceHighlight:onPresenterDetailsSaved called for User:
        ${this.un.User.UserID}, Logging presenter information: ${this.BBb()}, meetingId: ${this.$.xa.MeetingId}`),this.qz.forEach(wb=>{this.BUe(wb)}),this.qz=[])};se.f4a||(se.f4a={});this.un=db;this.Pv=new kd(this.gridView,this.un.User.UserID,this.un.User.UserName,this.un.UserColor,this,Ta,this.$,this.un.IsAnonymous);this.exd=$d.j(this.$);this.sFi=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:6191577_PresenterPresenceOnTop");this.iwd=$d.a(this.$);this.qqf=this.exd||this.iwd;this.B1=this.B1.bind(this);
this.qqf&&this.sNi()}dispose(){var db;Ra.a.Ka(this.Pv);super.dispose();const U=se.f4a;for(let wb in U){var Ta=wb;const Qb=U[wb];Qb&&!Qb.children.length&&(dc.DOMElementExtensions.gg(Qb),se.f4a[Ta]=null)}null===(db=se.excelLiveManager)||void 0===db?void 0:db.Ofb(this.B1);this.qz=null}bja(db){this.Pv.Bwe(db.Pv)}SJ(db){Qd.Bqa&&(this.Mnc||(this.Pv.Bla=db,this.Pv.Cqa(db,!0)),this.zSb=db&&this.Mnc)}DSb(db,U){this.Pv.xjg(db,0===U?49:50);this.zSb=!1}vSb(db){Qd.$Rb&&(this.Pv.Cqa(!0,!0),this.Ur([db]))}aDb(db){this.W6();
this.Hk(db)}uQe(db,U,Ta){Ta.className=Lc.a.AMh;Ta.style.borderColor=this.un.UserColor;this.iwd&&Ta.classList.add(Lc.a.b1e);const wb=document.createElement("div");49!==db&&50!==db&&(wb.style.backgroundColor=this.un.UserColor);Ta.appendChild(wb);wb.className=[Lc.a.CMh,Lc.a.BMh][db-49];db=Hc.a.nd(se.f4a,U.toString());if(!db){const Qb=this.gridView.og(U).domElement;db=document.createElement("div");Qb.insertBefore(db,Qb.firstChild);se.f4a[U.toString()]=db}db.appendChild(Ta);this.qqf&&this.bzh(wb)}ZCb(){}xdg(db,
U,Ta,wb){const Qb=this.UZg(wb,db,U);Wd.c(Ta,this.gridView.rtl,nd.HelperMethods.Yc(Qb.x));Ta.width=nd.HelperMethods.Yc(Qb.width);Ta.top=nd.HelperMethods.Yc(Qb.y);Ta.height=nd.HelperMethods.Yc(Qb.height);U=U.Fg;Ta=U.parentNode;50===db?se.fQd(Ta,U,!1):49===db&&(db=this.nE(50),wb.equals(db.fAa)?se.fQd(Ta,U,!1):se.fQd(Ta,U,!0));this.gkj()}$gg(){return!1}UZg(db,U,Ta){let wb=db.y+this.VAb(Ta,!1);Ta=db.x+this.VAb(Ta,!0)+md.a.Vkd(Ta.Fg.parentNode.parentNode,this.gridView.rtl);let Qb=db.width;db=db.height+
1;1>Ta&&-1<=Ta&&49===U&&(Qb-=1-Ta,Ta=1);1>wb&&-1<=wb&&49===U&&(db-=1-wb,wb=1);Qb=Math.max(0,Qb-1);db=Math.max(0,db-2);return new ic.a(Ta,wb,Qb,db)}gkj(){this.Pv.Ljb();this.Mnc=!1;this.zSb&&this.SJ(!0);this.zSb=!1}W6(){this.Mnc||(this.Pv.W6(!0),this.zSb=!1)}static fQd(db,U,Ta){Ta?U!==db.firstChild&&(db.removeChild(U),db.insertBefore(U,db.firstChild)):U!==db.lastChild&&(db.removeChild(U),db.appendChild(U))}bzh(db){var U;(null===(U=se.excelLiveManager)||void 0===U?0:U.NSa.Pu)?this.un.User.UserID===this.BBb()&&
(d.ULS.sendTraceTag(521143968,0,50,`PresenceHighlight:Distinct presenter presence called for User:${this.un.User.UserID}, Logging presenter information: ${this.BBb()}, meetingId: ${this.$.xa.MeetingId}`),this.BUe(db)):(d.ULS.sendTraceTag(509749071,0,50,`PresenceHighlight:PresenterCid is not yet saved for User:${this.un.User.UserID}`),this.qz.push(db))}BUe(db){this.iwd&&this.Svj(db);this.exd&&(d.ULS.sendTraceTag(509749070,0,50,`PresenceHighlight:distinctPresenterPresenceInternal called for User:${this.un.User.UserID}`),
this.wpi(db));this.exd&&this.sFi&&this.Rfk(db)}sNi(){se.excelLiveManager?se.excelLiveManager.gsb(this.B1):this.$.da.Gb(473,db=>{se.excelLiveManager=db;se.excelLiveManager.gsb(this.B1)})}wpi(db){Sd.a(()=>{db.style.backgroundColor=this.un.UserColor;db.classList.add(Lc.a.HMh);d.ULS.sendTraceTag(520648066,0,50,`PresenceHighlight:Highlighting presence for User: ${this.un.User.UserID}, Logging presenter information: ${this.BBb()}, meetingId: ${this.$.xa.MeetingId}`)},this.$.ka)}Svj(db){Sd.a(()=>{db.parentElement.classList.remove(Lc.a.b1e)},
this.$.ka)}Rfk(db){this.Pv.d7d(se.excelLiveManager.NSa.Pu);Sd.a(()=>{db.parentElement.classList.add(Lc.a.GMh)},this.$.ka)}BBb(){return se.excelLiveManager.NSa.Pu}}se.f4a=null;Object(b.a)(se,"PresenceHighlight",lc.a,[]);class je extends ib{constructor(db,U,Ta){super();this.zI=new Hc.a(!0);this.countFloatingObjects=this.iad=this.had=0;this.FOd=!1;this.Mr=()=>{this.VXd()};this.IBa=()=>{this.VXd()};this.rB=new ba(db);this.tfg(db);this.Hz=Ta;this.ZYd([]);this.$=U;this.$.ua.Lg(this.IBa);Pa.h(this.$).WU(this.Mr);
this.FOd=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence")}get Mc(){return this.rB.Mc}set Mc(db){this.rB.Mc=db;this.VXd()}bFc(){var db=1===this.Mc.PresenceType?50:49;for(let U=0;U<this.Gz.length;U++)this.Gz[U].vSb(db);for(db=0;db<this.zI.count;db++)this.zI.Mg(db).vSb()}vkc(){var db=1===this.Mc.PresenceType?50:49;for(let U=0;U<this.Gz.length;U++)this.Gz[U].aDb([db]);for(db=0;db<this.zI.count;db++)this.zI.Mg(db).aDb()}dispose(){this.$&&(this.$.ua&&this.$.ua.ih(this.IBa),
Pa.h(this.$).pP(this.Mr));this.uUe();Ra.a.Rc(this.Gz);Ra.a.Rc([this.rB]);this.rB=this.$=null;this.ZYd(null);this.zI=null;super.dispose()}uUe(){if(this.zI){for(let db=0;db<this.zI.count;db++)this.zI.Mg(db).dispose();this.zI.clear()}}A3a(db){1===this.Mc.Version?this.jdh(db):this.kdh(db)}jdh(db){if(db.Mc.SelectedRange&&this.Mc.SelectedRange){const U=this.Mc.SelectedRange.length,Ta=db.Mc.SelectedRange.length;for(let wb=0;wb<U;wb++)for(let Qb=0;Qb<Ta;Qb++)if(Da(this.Mc.SelectedRange[wb],db.Mc.SelectedRange[Qb])){this.Gz[wb].bja(db.R7a(Qb));
return}}}kdh(db){var U;let Ta=0,wb=0;if(this.Mc&&this.Mc.Object&&(null===(U=db.Mc)||void 0===U?0:U.Object)){U=this.Mc.Object.length;var Qb=db.Mc.Object.length;for(var sc=0;sc<U;sc++)if(this.Mc.Object[sc]&&this.fpd(this.Mc.Object[sc])){Ta++;for(var Vc=0;Vc<Qb;Vc++)if(db.Mc.Object[Vc]&&this.fpd(db.Mc.Object[Vc])&&(wb++,this.i4c(this.Mc.Object[sc],db.Mc.Object[Vc]))){var Ld=this.R7a(Ta),le=db.R7a(wb);if(Ld&&le){Ld.bja(le);return}}}else if(this.Mc.Object[sc]&&db.Mc.Object[sc]&&(0===this.Mc.Object[sc].ObjectType||
2===this.Mc.Object[sc].ObjectType))for(Vc=0;Vc<Qb;Vc++)if(db.Mc.Object[Vc]&&(0===db.Mc.Object[sc].ObjectType||2===db.Mc.Object[sc].ObjectType)&&this.Mc.Object[sc].ObjectId===db.Mc.Object[Vc].ObjectId&&(Ld=this.Rmd(this.Mc.Object[sc].ObjectId),le=db.Rmd(this.Mc.Object[sc].ObjectId),Ld&&le)){Ld.bja(le);return}}if(db.Mc.SelectedRange&&this.Mc.SelectedRange)for(U=this.Mc.SelectedRange.length,Qb=db.Mc.SelectedRange.length,sc=0;sc<U;sc++)for(Vc=0;Vc<Qb;Vc++)if(Da(this.Mc.SelectedRange[sc],db.Mc.SelectedRange[Vc])&&
(Ld=this.R7a(Ta+sc),le=db.R7a(wb+Vc),Ld&&le)){Ld.bja(le);return}}i4c(db,U){return!!db&&!!U&&U.ObjectType===db.ObjectType&&(1===db.ObjectType||3===db.ObjectType)&&!db.ObjectId.localeCompare(U.ObjectId)}R7a(db){return 0<=db&&this.Gz.length>db?this.Gz[db]:null}mjg(db){for(let U=0,Ta=this.Gz.length;U<Ta;U++)this.Gz[U].SJ(db)}Rmd(db){return db&&this.zI.Fb(db)?this.zI.getItem(db):null}njg(db,U=null){if(db)(db=this.zI.getItem(U))&&db.SJ(!0);else for(db=0;db<this.zI.count;db++)(U=this.zI.Mg(db))&&U.SJ(!1)}Rtg(db){ib.Ifk(this,
db)}lbd(db,U){if(db<U)return this.Gz[db];if(!this.un||!this.$||!this.Hz)return null;db=new se(this.un,this.$,this.Hz);this.Gz.push(db);return db}INj(){const db=this.Gz.length;var U=this.Mc.SelectedRange?this.Mc.SelectedRange.length:0,Ta=this.$.ua.na;for(let wb=0;wb<U;wb++){let Qb=this.lbd(wb,db);Qb&&this.Mc.SelectedRange[wb]&&(this.Mc.SelectedRange[wb].NamedObjectName?Qb.Hk([50,49]):(Qb.DSb(this.Mc.SelectedRange[wb],this.Mc.PresenceType),je.c7d(this.Mc.PresenceType,Qb,this.Mc.SelectedRange[wb],Ta,
this.un,this.Hz)))}Ta=!!this.rB&&!!this.rB.eOd&&this.rB.eOd.PresenceType!==this.rB.Mc.PresenceType;for(U=Ta?0:U;U<db;U++)this.Gz[U].Hk([1===this.rB.eOd.PresenceType?50:49])}fpd(db){return(null===db||void 0===db?0:db.ObjectId)&&(1===this.Fbf(db.ObjectType)||2===this.Fbf(db.ObjectType))&&(db=this.$.Zb.Xnd(db.ObjectId))?Ia.w(db):null}JNj(){const db=this.Gz.length,U=this.$.ua.na,Ta=this.Mc.SelectedRange?this.Mc.SelectedRange.length:0;var wb=this.Mc.Object?this.Mc.Object.length:0;for(var Qb=0;Qb<db;Qb++)this.Gz[Qb].Hk([50,
49]);this.peh();this.iad=this.had=Qb=0;for(var sc=0;sc<wb;sc++){var Vc=this.Mc.Object[sc],Ld=this.fpd(Vc);if(Ld){let le=this.lbd(Qb,db);1===Vc.ObjectType?this.had++:3===Vc.ObjectType&&this.iad++;Qb++;le.DSb(Ld,Vc.ObjectPresenceType);je.c7d(Vc.ObjectPresenceType,le,Ld,U,this.un,this.Hz)}}for(wb=0;wb<Ta;wb++)this.Mc&&this.Mc.SelectedRange&&(sc=this.Mc.SelectedRange[wb],sc.NamedObjectName||(Vc=!!U&&sc.SheetName===U.name,Ld=!!bb(sc,this.$,1),Vc&&Ld||(Vc=this.lbd(Qb+wb,db),Vc.DSb(sc,this.Mc.PresenceType),
je.c7d(this.Mc.PresenceType,Vc,sc,U,this.un,this.Hz))));0<(this.countFloatingObjects=this.Ubg())&&d.ULS.sendTraceTag(537154370,0,50,'{{"SetAllFloatingObjectPresenceHighlights":"Success"}')}peh(){this.Ubg();this.uUe()}Ubg(){let db=0;if(this.Mc&&this.Mc.Object)for(let U=0;U<this.Mc.Object.length;U++)this.gek(this.Mc.Object[U])&&db++;return db}Kph(db,U){if(this.zI.Fb(U))return U=this.zI.getItem(U),U.Hf=db,U;if(!this.un||!this.$||!this.Hz)return null;const Ta=new yd(this.un,this.$,this.Hz);Ta.Hf=db;this.zI.add(U,
Ta);return Ta}gek(db){let U=!1;if((null===db||void 0===db?0:db.ObjectId)&&(0===db.ObjectType||2===db.ObjectType||this.FOd&&5===db.ObjectType))try{const Ta=this.a6h(db);if(Ta){const wb=this.Kph(Ta,db.ObjectId);wb.DSb(Ta,db.ObjectPresenceType);5!==db.ObjectType&&wb.vSb();U=!0}}catch(Ta){throw d.ULS.sendTraceTag(537154369,0,10,`{"UpdatedFloatingObjectPresence":"Fail","Exception":"${Ta.stack}"}`),Ta;}return U}a6h(db){if(!db)return null;let U=null;this.FOd?-1!=db.ObjectType&&(U=Wc.a(this.$).GNa(db.ObjectId)):
2===db.ObjectType?U=Wc.a(this.$).GNa(db.ObjectId):0===db.ObjectType&&(db=this.$.Zb.Xnd(db.ObjectId),null===db||void 0===db?0:db.imageId)&&(U=Wc.a(this.$).R7h(db.imageId));return U}VXd(){try{1===this.Mc.Version?(this.INj(),d.ULS.sendTraceTag(537154368,0,50,'{{"SetGridHighlightPass":"V1"}')):(this.JNj(),d.ULS.sendTraceTag(537154339,0,50,`{"FloatingObjects":"${this.countFloatingObjects}","PivotTables":"${this.had}","QueryTables":"${this.iad}"}`))}catch(db){throw d.ULS.sendTraceTag(537154338,0,10,`{"SetGridHighlight Exception":"${db.stack}"}`),
db;}}Fbf(db){switch(db){case 0:return 0;case 1:return 1;case 3:return 2;case 2:return 9;default:return-1}}static c7d(db,U,Ta,wb,Qb,sc){const Vc=1===db?50:49;wb&&Ta&&wb.name===Ta.SheetName?(U.il(Ia.E(Ta),[Vc]),U.vSb(Vc),d.ULS.shipAssertTag(537154337,0,U.Pv.Rz===Qb.User.UserID,"UserID and UnitID should match"),sc.xRb(U.Pv.Rz,1===db)):U.aDb([Vc])}}Object(b.a)(je,"UserGridPresence",ib,[]);var Le=a(44),oe=a(799);class ue{constructor(db,U){this.yrf=this.Fyd=this.etf=!1;this.Cqd=this.Fkd=this.dCb=this.$zb=
0;this.svf=!0;this.ZF=db;this.$=U}xek(){this.$zb||(this.$zb=ob.a.ve(),this.xAa())}Aek(){this.dCb||(this.dCb=ob.a.ve(),this.xAa())}wek(){this.Fkd=ob.a.ve();this.LAf()}zek(db){this.Cqd=ob.a.ve();db&&(this.yrf=!0);this.LAf()}dispose(){this.ZF=this.$=null}static V6h(){return ue.Aqd}xAa(){this.$zb&&this.dCb?this.LA():window.setTimeout(()=>{this.LA()},ue.Aqd)}LAf(){this.Fkd&&this.Cqd?this.LA(!0):window.setTimeout(()=>{this.LA(!0)},ue.Aqd)}LA(db=!1){if(db?!this.Fyd:!this.etf)if(this.dCb||this.$zb){var U=
this.$.ea.UBb(this.ZF),Ta=this.$.ea.to;for(let wb of Ta)this.ZF!==wb.User.UserID&&(null===U||void 0===U?void 0:U.UserEmail)===(null===wb||void 0===wb?void 0:wb.UserEmail)&&(this.svf=!1);U={};U.UserSessionId=this.$.xa.UserSessionId;U.ClientID=this.ZF;U.IsUniqueUser=this.svf;U.IsUserRemovalLog=db;U.IsInactive=this.yrf;db||(U.GridPresenceTime=this.dCb,U.GalleryPresenceTime=this.$zb);U.GridPresenceRemovalTime=this.Cqd;U.GalleryPresenceRemovalTime=this.Fkd;d.ULS.sendTraceTag(508863559,0,50,`Grid Gallery presence telemetry: ${JSON.stringify(U)}`);
db?this.Fyd=!0:this.etf=!0}}}ue.Aqd=12E4;Object(b.a)(ue,"GridGalleryPresenceTelemetry",null,[2]);class df{constructor(db){this.zqd=null;this.$=db;this.AW={};this.avb=new Set}dispose(){for(let db in this.AW)this.AW[db].dispose(),delete this.AW[db];this.AW=null;this.avb.clear();this.$=this.avb=null}ltg(){var db=this.$.ea.to;for(let U of db)db=U.User.UserID,db===this.$.ea.clientId||this.avb.has(db)||this.nod(db).xek();for(let U in this.AW)this.$.ea.UBb(U)||(this.nod(U).wek(),this.N$f())}mtg(db,U=!1,
Ta=!1){db===this.$.ea.clientId||this.avb.has(db)||(db=this.nod(db),U?(db.zek(Ta),this.N$f()):db.Aek())}nod(db){if(!this.AW[db]){const U=new ue(db,this.$);this.AW[db]=U}return this.AW[db]}mji(){for(let db in this.AW)this.AW[db].Fyd&&(this.AW[db].dispose(),delete this.AW[db],this.avb.add(db)),this.zqd=null}N$f(){this.zqd||x.a.isEmpty(this.AW)||(this.zqd=w.Task.delay(ue.V6h()).continueWith(()=>{this.mji()}))}}Object(b.a)(df,"GridGalleryPresenceTelemetryHelper",null,[2]);class Se extends ya.a{constructor(db,
U,Ta,wb,Qb=null){super();this.lw={};this.w$b=this.x$b=0;this.BBd=this.Uwb=null;this.Yzf=3E4;this.trd=!1;this.SZd=!0;this.ANd=null;this.OKf=()=>{var sc=this.gpa;for(let Vc in sc)sc=Vc,this.ywe(sc)?(this.frc(sc,!0),delete this.Udb[sc],delete this.gpa[sc]):d.ULS.sendTraceTag(537154377,0,50,`PresenceView.OnEcsUserListChanged: pending userId=[${sc}] still not updated`);this.SRb&&this.nOa.ltg()};this.IKd=(sc,Vc)=>{sc={};sc.UpdatedCount=Vc.fK?Object.keys(Vc.fK).length:0;sc.DisconnectedCount=Vc.N5?Vc.N5.length:
0;sc.Location="canvas";Ea.b(this.$).Ld(na.a.INd,sc);sc=null;this.$.nc&&(sc=this.$.nc.hh("ModelUpdate","PresenceRendering"),sc.start());var Ld={};if(Vc.fK){if(fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const uf=(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,435,436,1),Ab=>{Ab.result.TQi(uf)},this.$.ka,3)}this.ozb||(this.kDd(!0),this.ozb=!0);const ef=Vc.fK;for(var le in ef){var Ce=ef[le];let uf=le;this.Htd[uf]=ka.a.Bb.Cc;if(!$d.i(this.$)||
null==Ce.NavigationState)if(this.qLe(uf,new Date),this.b_g(Ce),uf!==this.Uwb){var Oe=this.lw[uf];Oe||(this.ywe(uf)?this.frc(uf,!0):(uf in this.gpa?d.ULS.sendTraceTag(537154376,0,50,`PresenceView.OnSelectionPresenceChanged: userId=[${uf}] already pending update`):(this.Udb[uf]=ka.a.Bb.Cc,Ld[uf]=1),this.gpa[uf]=!0,Oe=this.Bai(uf),this.lw[uf]=this.GQe(Oe)),Oe=this.lw[uf],this.SRb&&this.nOa.mtg(uf));Oe&&(Oe.Mc=Ce,Ce.SelectedRange&&1<Ce.SelectedRange.length?this.x$b++:this.w$b++,this.N3f(uf),this.A3a(Oe))}}if(fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&
this.$.ea&&this.$.ea.COa){const uf=(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,435,436,1),Ab=>{Ab.result.UQi(uf)},this.$.ka,3)}}if(Vc.N5)for(let ef=0,uf=Vc.N5.length;ef<uf;ef++)le=Vc.N5[ef],this.Hdd[le]=ka.a.Bb.Cc,this.D3f(le,!0);if(Vc.N5&&0<Vc.N5.length||0<oe.a(Ld).length||0<oe.a(this.gpa).length)le=[],le.push(...oe.a(Ld)),le.push(...oe.a(this.gpa)),(Ld=this.$.da.Ba(292))&&Ld.Zjb(le,Vc.N5);sc&&sc.stop();this.trd=!1;sc=this.lw;for(let ef in sc)if(0===Object(l.a)(ib,
sc[ef]).Mc.CollabMode){this.trd=!0;break}this.raiseEvent("pcek",Vc)};this.fFa=(sc,Vc)=>{Vc&&this.$.Js&&(Vc.zsb.HasAnyNonOcsCoauthor=this.trd)};this.bLb=()=>{const sc=new cb.a({},null),Vc=this.Gra;for(let Ld in Vc){const le=Ld,Ce=Vc[Ld].Mc;Ce.SelectedRange=Ce.SelectedRangeRaw;sc.fK[le]=Ce}this.IKd(this,sc)};this.Dd=()=>{this.gif()};this.ZRi=()=>{this.BBd&&Oa.a(ka.a.Bb,this.BBd)<this.Yzf||(this.BBd=ka.a.Bb.Cc,this.LCd(),this.IOi(),this.sPi(),this.ozb||this.kDd(!1))};this.IBa=()=>{this.gif();const sc=
this.lw;for(let Vc in sc)this.A3a(sc[Vc])};this.Xc=()=>{this.LCd();this.ozb||this.kDd(!1);this.ozb=!1};this.tPf=()=>{const sc=this.lw;for(let Vc in sc)sc[Vc].dispose();this.lw={};this.CJe();this.Udb={};this.LWc={};this.sz.length=0;this.eFc()};this.Vea=(sc,Vc)=>{this.L1d(Vc.Yg)};this.Hdd={};this.Htd={};this.Udb={};this.LWc={};this.$=db;this.IRa=wb;this.Jl=U;this.Bqe=Ta;Qd.$Rb=!0;Qd.Bqa=!0;this.P8a();this.Hz=new Zb(db);this.$.ua&&this.$.ua.Lg(this.IBa);this.Jl.Vrb(this.Vea);db.qa&&this.$.qa.hja(this.fFa);
this.sz=[];this.Jl.y3a();db.da.Ja(25,this);this.ozb=!1;this.$.Xj(this.Xc);this.C4c=Fa.a.instance.ZD(this.ZRi,this.Yzf/2,wa.a.nlj,!0,!1);this.BNd=Qb;this.x4g=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7736608_AvoidLoggingForInactiveUser");if(this.SRb=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7867632_LogGridGalleryPresenceTelemetry"))this.nOa=this.ioh(),this.nOa.ltg()}$Ia(db){this.addHandler("pcek",db)}NCa(db){this.removeHandler("pcek",db)}get rM(){return this.Bqe}get Gra(){return this.lw}isAnonymousUser(db){var U,
Ta;return null===(Ta=null===(U=this.Gra[db])||void 0===U?void 0:U.Mc)||void 0===Ta?void 0:Ta.IsAnonymous}P3f(db){this.Gra[db]&&this.D3f(db,!1)}L1d(db){this.Uwb&&this.Uwb!==db.clientId&&(this.SZd=!1);!fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5657706_CorrectPresenceBootTelemetry")||this.$.ea.COa&&Le.PageLoadTrackingInfo.instance.eLj||(this.SZd=!1);this.rM.Dih(db);this.Uwb=db.clientId}a8h(db,U){let Ta,wb;Ta=[];wb=[];const Qb=this.Gra;for(let sc in Qb){const Vc=Qb[sc];if(U){const Ld=Ia.k(db,this.$);
this.Lff(Ld,Ta,wb,Vc)}else this.Kff(db,Ta,wb,Vc)}return{nwi:Ta,hBh:wb}}iTe(db,U,Ta,wb,Qb){(Qb=this.Gra[Qb])&&(U?this.Lff(db,Ta,wb,Qb):this.Kff(db,Ta,wb,Qb))}Shi(){const db=[],U=this.Gra;for(let Qb in U){var Ta=U[Qb],wb=Ta.Mc.SelectedRange;if(wb)for(const sc of wb){wb=Ia.E(sc);const Vc=Pa.h(this.$).ga.pa.u6;if(this.$.ua.na.sheetName===sc.SheetName&&wb.right===Vc.right&&wb.top===Vc.top){Ta=Ta.un;Ta=new sb.a(Ta.User.UserID,Ta.User.UserName,Ta.UserColor,new Jb.a(1),null,Ta.UserEmail,void 0,void 0,void 0,
void 0,void 0,Ta.JoinCoauthTime);db.push(Ta);break}}}return db}bFc(){Qd.$Rb=!0;Qd.Bqa=!0;const db=this.lw;for(let U in db)db[U].bFc()}vkc(){Qd.$Rb=!1;Qd.Bqa=!1;const db=this.lw;for(let U in db)db[U].vkc()}dispose(){this.zUb();this.$&&(this.$.ua&&this.$.ua.ih(this.IBa),this.$.qa&&this.$.qa.Fpa(this.fFa),this.$.Ll(this.Xc));this.Jl&&this.Jl.Lzc(this.Vea);this.C4c&&(this.C4c.dispose(),this.C4c=null);if(this.lw){const db=this.lw;for(let U in db)db[U].dispose()}this.SRb&&this.nOa&&(this.nOa.dispose(),
this.nOa=null);Ra.a.Rc([this.rM,this.Hz]);this.CJe();this.lw=this.$=this.Bqe=null;this.sz.length=0;super.dispose()}get gpa(){return this.LWc}ioh(){return new df(this.$)}zUb(){this.rM&&(this.rM.NCa(this.IKd),this.rM.Jxj(this.OKf),this.rM.hzj(this.tPf),this.rM.Gp(this.Dd));this.IRa.Q4f(this.bLb)}GQe(db){return new je(db,this.$,this.Hz)}ywe(db){const U=this.$.ea.UBb(db);if(U)if(db in this.lw)this.lw[db].Rtg(U);else{const Ta=this.GQe(U);this.lw[db]=Ta;this.A3a(Ta)}return!!U}Lff(db,U,Ta,wb){if(db)for(const Qb of db){if(Qb){if((db=
bb(Qb,this.$,1))&&Se.$pd(db.Tj,U,Ta,wb))break;if((db=bb(Qb,this.$,2))&&Se.$pd(db.Tj,U,Ta,wb))break}if(wb.Mc.SelectedRange)for(const sc of wb.Mc.SelectedRange)if(sc&&Qb&&Da(Qb,sc)){(1===wb.Mc.PresenceType?Ta:U).push(wb.rB.lVb.User);return}}}Kff(db,U,Ta,wb){db&&Se.$pd(this.g6h(db),U,Ta,wb)}b_g(db){db.SelectedRange&&(db.SelectedRangeRaw=this.suh(db.SelectedRange),db.SelectedRange=this.IRa.pkh(db.SelectedRange))}suh(db){const U=Array(db.length);for(let Qb=0;Qb<db.length;Qb++){var Ta=Qb,wb=db[Qb];const sc=
{};sc.SheetName=wb.SheetName;sc.FirstColumn=wb.FirstColumn;sc.FirstRow=wb.FirstRow;sc.LastRow=wb.LastRow;sc.LastColumn=wb.LastColumn;sc.NamedObjectName=wb.NamedObjectName;U[Ta]=sc}return U}g6h(db){if(db)switch(db.type){case 0:return(db=this.$.Zb.Ebf(db.id))?db.Tj:null;case 2:return db.Tj}return null}P8a(){this.rM.$Ia(this.IKd);this.rM.tYg(this.tPf);this.rM.wWg(this.OKf);this.rM.gp(this.Dd);this.IRa.rye(this.bLb)}tAf(db,U,Ta,wb){const Qb={};Qb.a=this.$.xa.UserSessionId;Qb.b=db;Qb.c=Ta?"PendingUserRemoved":
"Non-PendingUserRemoved";Qb.d=wb?"Disconnected":"Inactivity";Qb.e=U;la.b().Df(22,Qb,!0)}D3f(db,U){db in this.lw&&(this.N3f(db),this.lw[db].dispose(),delete this.lw[db],d.ULS.sendTraceTag(537154375,0,50,`PresenceView.RemovePresenceForUser: userId=[${db}] removed due to inactivity`),this.tAf(db,ka.a.Bb.Cc,!1,U));db in this.gpa&&(this.frc(db,!1),delete this.Udb[db],delete this.gpa[db],d.ULS.sendTraceTag(537154374,0,50,`PresenceView.RemovePresenceForUser: Pending userId=[${db}] removed due to inactivity`),
this.tAf(db,ka.a.Bb.Cc,!0,U));this.SRb&&this.nOa.mtg(db,!0,!U)}N3f(db){for(let U=this.sz.length-1;0<=U;U--)if(this.sz[U].User.UserID===db){this.sz.splice(U,1);for(const Ta of this.lw[db].Gz)this.Hz.kqa(Ta.Pv.Rz,!1);this.eFc()}}sPi(){if(this.w$b||this.x$b)this.$.xd(-70383382,-1,0,null),d.ULS.sendTraceTag(537154373,0,50,`PresenceView.LogDiscontinuousCountPresenceData: Discontinuous Presence Received with count= [${this.x$b}], Continuous Presence Received with count= [${this.w$b}]`);this.x$b=this.w$b=
0}CJe(){this.LCd();this.LWc=this.Udb=null}LCd(){const db=this.gpa;for(let U in db)this.frc(U,!1)}IOi(){var db=this.Hdd;for(let U in db)this.cAf(U,!0,db[U]);db=this.Htd;for(let U in db)this.cAf(U,!1,db[U]);this.Hdd={};this.Htd={}}Tq(db){var U;return(null===(U=this.Jl)||void 0===U?0:U.Yg)?(db=this.Jl.Yg.wma(db),1===(null===db||void 0===db?void 0:db.status)):!1}frc(db,U){var Ta=this.x4g?this.Tq(db):!0;if(this.$.Js&&this.$.ea.Ec&&Ta){Ta={};Ta.a=this.$.xa.UserSessionId;Ta.b=db;Ta.c=U;Ta.e=!1;Ta.d=-1;Ta.f=
ka.a.Bb.Cc;this.$.ea&&(Ta.e=this.$.ea.JN);if(db=this.Udb[db])Ta.d=Oa.a(ka.a.Bb,db);la.b().Df(20,Ta,!0)}}kDd(db){if(this.$.Js){const U={e:-1,f:-1,c:!1,d:!1};U.b=db;U.a=this.$.xa.UserSessionId;this.$.ea&&(U.c=this.$.ea.COa,U.d=this.$.ea.JN,U.e=this.$.ea.to.length,this.$.ea.jFa&&(U.f=Oa.a(ka.a.Bb,this.$.ea.Clk)));la.b().Df(21,U,!0)}}cAf(db,U,Ta){if(this.$.Js){const wb={};wb.a=this.$.xa.UserSessionId;wb.b=db;wb.c=U;wb.d=Ta;la.b().Df(19,wb,!0)}}gif(){const db=[],U=this.lw;for(let Ta in U){const wb=U[Ta];
if(this.rM.Nag(wb.Mc)){this.lxe(db,wb);Array.remove(this.sz,wb.rB.lVb);if(1===this.rM.Mc.PresenceType){const Qb={};Qb.a=1===wb.Mc.PresenceType?"Editing":"Non-Editing";Qb.b=this.$.xa.UserSessionId;Qb.c=ka.a.Bb.Cc;la.b().Df(18,Qb)}for(const Qb of wb.Gz)this.Hz.kqa(Qb.Pv.Rz,!0)}else for(const Qb of wb.Gz)this.Hz.kqa(Qb.Pv.Rz,!1)}this.sz.length=0;this.sz=db;this.eFc()}lxe(db,U){const Ta=U.rB.lVb;if(0===U.Mc.PresenceType){U=db.length;let wb;for(wb=0;wb<U&&0===this.lw[db[wb].User.UserID].Mc.PresenceType;wb++);
db.splice(wb,0,Ta)}else db.push(Ta)}A3a(db){this.rM.Nag(db.Mc)&&(this.lxe(this.sz,db),this.eFc());const U=db.rB.lVb.User.UserID,Ta=this.lw;for(let Qb in Ta){var wb=Ta[Qb];Qb!==U&&db.A3a(wb)}}eFc(){0<this.sz.length&&this.uZj()}uZj(){for(let db=0,U=this.sz.length;db<U;db++){const Ta=this.lw[this.sz[db].User.UserID];if(Ta)if(this.rM.D_f(Ta.Mc)){Ta.mjg(!0);for(const wb of Ta.Gz)this.Hz.kqa(wb.Pv.Rz,!0)}else{const wb=this.rM.Iaf(Ta.Mc);wb&&Ta.njg(!0,wb)}}}Bai(db){const U={User:{}};U.User.UserID=db;U.User.UserName=
hb.a.instance.Lb(87);U.UserColor="#AAAAAA";return U}qLe(db,U){this.SZd&&this.BNd&&(db&&U?this.ANd?this.ANd.eDh(db,U,this.Uwb):this.BNd.continueWith(()=>{this.ANd=this.BNd.result;this.qLe(db,U)}):d.ULS.sendTraceTag(537154372,0,15,`userId: [${db}], endTime: [${U}]`))}static $pd(db,U,Ta,wb){if(!wb||!wb.Mc||!wb.Mc.Object)return!1;for(const Qb of wb.Mc.Object)if(db&&Qb&&Qb.ObjectId&&!Qb.ObjectId.localeCompare(db))return(1===Qb.ObjectPresenceType?Ta:U).push(wb.rB.lVb.User),!0;return!1}}Object(b.a)(Se,"PresenceView",
ya.a,[811,812]);var bf;(function(db){db[db.chart=0]="chart";db[db.image=1]="image";db[db.slicer=2]="slicer";db[db.modernOfficeExtension=3]="modernOfficeExtension";db[db.interactiveReport=4]="interactiveReport";db[db.shape=5]="shape";db[db.cardView=6]="cardView";db[db.group=7]="group";db[db.ink=8]="ink";db[db.E1O=9]="E1O";db[db.unknown=99]="unknown";db[db.unsupported=100]="unsupported"})(bf||(bf={}));Object(b.b)("FloatingObjectType",bf);var Ye=a(233),gf=a(278),nf=a(30);class oc extends ya.a{constructor(db){super();
this.statusBarManager=null;this.$=db;this.$.da.Gb(29,U=>{this.statusBarManager=U;U.BK(this)})}qr(db){this.addHandler("OSC",db)}Rr(db){this.removeHandler("OSC",db)}RA(){this.raiseEvent("OSC")}ut(db,U){if("QueryOcsConnectionStatus"===db)db=this.$.ea.wab?hb.a.instance.ha(924):hb.a.instance.ha(925),nf.a.vp()?(U.LabelText=db,U.Visible=!0):U.Value=db;else return!1;return!0}ro(){return!0}dispose(){this.statusBarManager&&(this.statusBarManager.cH(this),this.statusBarManager=null);this.$=null;super.dispose()}}
Object(b.a)(oc,"OcsStatusBarManager",ya.a,[2,196,197]);class Ac extends ya.a{constructor(db,U){super();this.Xng=this.Yng=this.Yg=null;this.Xzf=this.hkb=this.rbg=!1;this.vo=()=>{this.$&&this.JWd(0,!1)};this.Ji=()=>{this.M3d?this.Yng(!1):(this.Mc.PresenceType=1,this.raiseEvent(Ac.J9),this.sendPresenceToService(!1))};this.Jg=()=>{this.M3d?this.Xng(!1):(this.Pgb(!1),this.FWd())};this.qLf=()=>{this.ga.Sa.Fc?this.JWd(1,!1):this.PWd(0,!1)};this.Soa=(Ta,wb)=>{this.raiseEvent(Ac.CNd,wb)};this.Dd=()=>{this.PWd(Pa.h(this.$).Eb?
1:0,!1)};this.zd=(Ta,wb)=>{Ye.a(wb)&&(this.Kta={})};this.bLb=()=>{this.Zag()};this.$Sf=(Ta,wb)=>{if(wb&&wb.methodName in Ac.cxc){Ta=!1;switch(Ac.cxc[wb.methodName]){case 0:wb=wb.parameters.cell;break;case 1:wb=wb.parameters.parameters.Location;break;case 2:wb=Ia.v(this.ga.pa.activeRange,this.$);Ta=!0;break;default:return}wb.LastColumn=wb.FirstColumn;wb.LastRow=wb.FirstRow;wb.NamedObjectName=null;this.Mc.SelectedRange=[wb];this.Mc.PresenceType=0;if(Ta){wb=[];for(var Qb of this.$.Zb.e$h())Ta={},Ta.ObjectType=
this.oda(Qb.type),Ta.ObjectPresenceType=1,Ta.ObjectId=Qb.Tj,wb.push(Ta);this.Mc.Object=wb}else Qb=bb(wb,this.$,1),wb=null,Qb&&(wb={},wb.ObjectType=this.oda(Qb.type),wb.ObjectPresenceType=0,wb.ObjectId=Qb.Tj),this.Mc.Object=[wb];this.raiseEvent(Ac.J9);this.sendPresenceToService(!1)}};this.tn=(Ta,wb)=>{wb.context.methodName in Ac.cxc&&(this.Mc.Object=[null],this.Pgb(!1))};this.Th=(Ta,wb)=>{wb.context.methodName in Ac.cxc&&(this.Mc.Object=[null],this.Pgb(!1))};this.Td=(Ta,wb)=>{wb.uO||(this.Kta={},this.$.Js?
this.P8a():this.zUb())};this.Xc=()=>{this.FWd()};this.Avf=()=>{this.Zag();this.bHf.RA()};this.$=db;this.ga=Pa.h(this.$).ga;this.IRa=U;this.$.Ql(this.Td);this.$.Xj(this.Xc);this.Kta={};this.z_a=new sb.a(null,null,null,null);this.nDa={};this.nDa.b=0;this.nDa.c=0;this.bHf=new oc(this.$);if(this.M3d=fb.EwaSettings.Tb())this.Yng=gf.b(Ta=>{this.Mc.PresenceType=1;this.raiseEvent(Ac.J9);this.sendPresenceToService(Ta)},40,this.$.ka,"SelectionPresenceManager.SendPresenceToService",!0),this.Xng=gf.b(Ta=>{this.Pgb(Ta);
this.FWd()},40,this.$.ka,"SelectionPresenceManager.SendCurrentPresence",!0);this.rbg=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence");this.hkb=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2");this.Xzf=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7808895_LogFloatingObjectSelection")}$Ia(db){this.addHandler(Ac.CNd,db)}NCa(db){this.removeHandler(Ac.CNd,db)}wWg(db){this.$.ea.fba(db)}Jxj(db){this.$.ea.v9(db)}gp(db){this.addHandler(Ac.J9,
db)}Gp(db){this.removeHandler(Ac.J9,db)}tYg(db){this.addHandler(Ac.DNd,db)}hzj(db){this.removeHandler(Ac.DNd,db)}get Mc(){return this.Kta}get amIAlone(){return!this.$.ea||this.$.ea.amIAlone}dispose(){this.$&&(this.zUb(),this.$.Rm(this.Td),this.$.Ll(this.Xc));this.Yg&&this.Yg.ZTa(this.Soa);Ra.a.Ka(this.bHf);this.$=this.Yg=null;super.dispose()}Dih(db){this.Yg?this.Yg.ZTa(this.Soa):this.P8a();(this.Yg=db)?(this.Yg.q1a(this.Soa),this.Pgb(!0)):this.zUb()}P8a(){this.ga.gp(this.Dd);Pa.h(this.$).KF(this.vo);
var db=Pa.h(this.$).wc;db.Bm(this.Jg);db.ao(this.Ji);this.$.ea.pk(this.zd);this.$.ea.dye(this.Avf);this.IRa.rye(this.bLb);db=this.$.qa.va;db.aJa(this.$Sf);db.ms(this.Th);db.Iy(this.tn);this.$.da.Gb(16,U=>{U.KWg(this.qLf);U.JWg(this.Jg)})}zUb(){this.ga.Gp(this.Dd);Pa.h(this.$).dH(this.vo);const db=Pa.h(this.$).wc;db.Qm(this.Jg);db.Un(this.Ji);this.$.ea.Kk(this.zd);this.$.ea.E4f(this.Avf);this.IRa.Q4f(this.bLb);this.$.qa.va.$Ta(this.$Sf);this.$.qa.va.Mt(this.Th);this.$.qa.va.Jz(this.tn);this.$.da.Gb(16,
U=>{U.Sxj(this.qLf);U.Rxj(this.Jg)});this.raiseEvent(Ac.DNd)}Nag(db){return this.D_f(db)||!!this.Iaf(db)}D_f(db){if(2===this.Mc.Version&&this.Mc.Object&&2===db.Version&&db.Object&&0<this.Mc.Object.length&&0<db.Object.length){var U=this.Mc.Object.length,Ta=db.Object.length;for(var wb=0;wb<U;wb++)for(var Qb=0;Qb<Ta;Qb++)if(this.i4c(this.Mc.Object[wb],db.Object[Qb]))return!0}if(this.Mc.SelectedRange&&db.SelectedRange)for(U=this.Mc.SelectedRange.length,Ta=db.SelectedRange.length,wb=0;wb<U;wb++)for(Qb=
0;Qb<Ta;Qb++)if(Ac.m2g(this.Mc.SelectedRange[wb],db.SelectedRange[Qb]))return!0;return!1}Iaf(db){if(2===this.Mc.Version&&this.Mc.Object&&2===db.Version&&db.Object&&0<this.Mc.Object.length&&0<db.Object.length){const U=this.Mc.Object.length,Ta=db.Object.length;for(let wb=0;wb<U;wb++)for(let Qb=0;Qb<Ta;Qb++)if(Ac.q_i(this.Mc.Object[wb],db.Object[Qb]))return this.Mc.Object[wb].ObjectId}return null}i4c(db,U){return!!db&&!!U&&db.ObjectType===U.ObjectType&&(1===db.ObjectType||3===db.ObjectType)&&!!db.ObjectId&&
!!U.ObjectId&&!db.ObjectId.localeCompare(U.ObjectId)}Zag(){this.Pgb(!1)}Pgb(db){this.ga.Sa.Fc?this.JWd(0,db):this.PWd(Pa.h(this.$).wc.Eb?1:0,db)}JWd(db,U){var Ta={};this.$.Fk(Ta);var wb=this.ga.Sa.Fc;if(wb){const Qb=wb.floatingObject;Ta.FirstColumn=-1;Ta.FirstRow=-1;Ta.LastColumn=-1;Ta.LastRow=-1;Ta.NamedObjectName=Qb?Qb.Jh():null;this.Mc.SelectedRange=[Ta];this.Mc.PresenceType=0;Ta=null;if(this.rbg){if(null===Qb||void 0===Qb?0:Qb.id)Ta={ObjectType:this.ibi(Qb.type),ObjectPresenceType:db,DialogType:0,
ObjectId:wb.Tj}}else if(Qb)switch(Qb.type){case 0:if(wb=this.$.Zb.Ebf(Qb.id))Ta={},Ta.ObjectType=this.oda(0),Ta.ObjectPresenceType=db,Ta.ObjectId=wb.Tj;break;case 2:Qb.id&&(Ta={},Ta.ObjectType=this.oda(9),Ta.ObjectPresenceType=db,Ta.ObjectId=Qb.Tj)}this.Mc.Object=[Ta];this.Xzf&&0<=(null===Qb||void 0===Qb?void 0:Qb.type)&&d.ULS.sendTraceTag(508913565,0,50,`FloatingObjectPresence {"SelectedFloatingObjectType":"${Qb.type}", 
              "SelectedFloatingObjectName":"${bf[Qb.type]}"}`)}this.raiseEvent(Ac.J9);this.sendPresenceToService(U)}PWd(db,U){if(!Pa.h(this.$).Eb&&!Pa.h(this.$).Wi){const wb=this.$.nc.hh("ModelUpdate","SendRangePresence");wb.start();var Ta=Ia.k(this.ga.pa.selectedRanges,this.$);this.Mc.SelectedRange=this.IRa.okh(Ta);this.Mc.Object=[];for(const Qb of Ta)if(Ta=bb(Qb,this.$,1)){const sc={};sc.ObjectType=this.oda(Ta.type);sc.ObjectPresenceType=0;sc.ObjectId=Ta.Tj;this.Mc.Object.push(sc)}this.Mc.PresenceType=
db;this.raiseEvent(Ac.J9);this.Mc.SelectedRange||this.Mc.Object?this.sendPresenceToService(U):d.ULS.sendTraceTag(537154371,0,50,`SelectionPresenceManager.SendRangePresence: skip sending range presence since selected range/object are both null.  UserId: [${this.Yg.clientId}]`);wb.stop()}}sendPresenceToService(db){if(this.$.ea.Vcc||!this.$.ea.K9b||db)if(this.amIAlone||++this.nDa.b,this.Yg){this.Mc.Version=2;this.Mc.ClientType=1;this.Mc.ChatThreadId=this.z_a.Z7c;this.Mc.ChatThreadDiscoveryUri=this.z_a.Y7c;
this.Mc.InChat=this.z_a.wDb;this.Mc.Cid=this.z_a.email;this.Mc.SupportsChat=!!this.z_a.capabilities&&this.z_a.capabilities.yOa(4);this.Mc.CollabMode=this.$.ea.wab?2:0;this.Mc.OcsCapable=this.$.ea.ocsCapable;this.hkb&&(this.Mc.IsAnonymous=k.AFrameworkApplication.userNameUnknown||k.AFrameworkApplication.limitedEdit);this.Yg.obg(this.Mc);if(fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.ea&&this.$.ea.COa){const U=(new Date).getTime();ia.TaskExtensions.za(V.GetServiceTaskFactory.Za(this.$.da,
435,436,1),Ta=>{Ta.result.VQi(U)},this.$.ka,3)}this.amIAlone||++this.nDa.c}}FWd(){this.$.Js&&(this.nDa.a=this.$.xa.UserSessionId,la.b().Df(26,this.nDa,!0));this.nDa.b=0;this.nDa.c=0}ibi(db){switch(db){case 0:return 0;case 2:return 2;case 5:return 5;default:return-1}}oda(db){switch(db){case 0:return 0;case 1:return 1;case 2:return 3;case 9:return 2;default:return-1}}static get cxc(){return Ac.$ne||(Ac.$ne={["ApplyFilter"]:1,["ApplyPivot"]:0,["ApplyPivotSort"]:0,["ApplyPivotSortByValue"]:1,["ApplyWellKnownPivotFilter"]:0,
["RemovePivotFilter"]:0,["SetCustomFilter"]:1,["SetTop10Filter"]:1,["TogglePivotDrill"]:0,["RefreshAll"]:2})}static q_i(db,U){return!!db&&!!db.ObjectId&&!!U&&!!U.ObjectId&&(0===db.ObjectType||2===db.ObjectType)&&db.ObjectType===U.ObjectType&&!db.ObjectId.localeCompare(U.ObjectId)}static m2g(db,U){return!db.NamedObjectName&&Da(db,U)}}Ac.CNd="presenceChanged";Ac.DNd="presenceDisabled";Ac.J9="selectionChanged";Ac.$ne=null;Object(b.a)(Ac,"SelectionPresenceManager",ya.a,[825,2,826]);var xa=a(100),Cb=a(71);
class bc extends xb.a{constructor(db){super();this.manager=null;this.$=db;this.kc()}create(){this.manager?this.Pb(this.manager):ia.TaskExtensions.za(Object(Cb.b)("OfficeVSO:7624673_NamedSheetViewConversionManagerService")?Object(xa.d)(Xa.a.resolve(Za.X,{Wa:this.La})):V.GetServiceTaskFactory.create(this.$.da,28,this.ka,this.La),db=>{this.Pb(this.manager||(this.manager=new Ac(this.$,db.result)))},this.ka,3)}}Object(b.a)(bc,"SelectionPresenceManagerFactory",xb.a,[]);var Fc=a(1310),Tc=a(7),gd=a(201);
class td extends ca.a{constructor(db,U,Ta){super();this.fTa=this.ENd=null;this.jLb=(wb,Qb)=>{if(Qb.fK){wb=[];const Vc=[];var sc=Pa.h(this.$).ga;const Ld=!(2===sc.gf||128===sc.gf);sc=Ld?Ia.k(sc.pa.selectedRanges,this.$):sc.Sa.Fc.floatingObject;Qb=Qb.fK;for(let Ce in Qb)this.presenceView.iTe(sc,Ld,wb,Vc,Ce);for(const Ce of this.oLa)wb.includes(Ce)||Vc.includes(Ce)||this.presenceView.iTe(sc,Ld,wb,Vc,Ce.UserID);this.oLa=[];this.oLa.push(...wb);this.oLa.push(...Vc);this.ENd&&(Ra.a.Ka(this.fTa),this.ENd=
this.fTa=null);const le=td.GFe(wb,Vc);this.fTa=new gd.a;this.ENd=ia.TaskExtensions.za(w.Task.delay(1),()=>{this.ariaLiveNotifier.afb(le,Tc.a.dva)},this.fTa.token,3)}};this.$=U;this.ariaLiveNotifier=db;this.presenceView=Ta;this.oLa=[];Ta.$Ia(this.jLb);this.$.da.Ja(231,this)}Jaf(db,U){this.oLa=[];({nwi:db,hBh:U}=this.presenceView.a8h(db,U));this.oLa.push(...db);this.oLa.push(...U);return td.GFe(db,U)}dispose(){this.presenceView.NCa(this.jLb);this.fTa&&(Ra.a.Ka(this.fTa),this.fTa=null);super.dispose()}static GFe(db,
U){return db.length||U.length?U.length?1===U.length?String.format(hb.a.instance.Lb(83),U[0].UserName):String.format(hb.a.instance.Lb(84),U.length):1===db.length?String.format(hb.a.instance.Lb(85),db[0].UserName):String.format(hb.a.instance.Lb(86),db.length):""}}Object(b.a)(td,"PresenceReadoutHandlerService",ca.a,[681]);const kb=(db,U,Ta,wb,Qb,sc,Vc,Ld=null)=>{Ld=db.Pa(1,Ld);Ld.Id=U;Ld.OnBehalfOfOcs=Ta;return Ua.g(db,"CheckPersistedContentUpdate",Ld,wb,Qb,sc,Vc,516)},Vb=(db,U,Ta,wb,Qb,sc,Vc,Ld=null)=>
{Ld=db.Pa(1,Ld);Ld.clientIdsToAdd=U;Ld.clientIdsToRemove=Ta;return Ua.g(db,"UpdatePresenceUsers",Ld,wb,Qb,sc,Vc,0)},qc=(db,U,Ta,wb,Qb,sc=null)=>{sc=db.Pa(1,sc);return Ua.g(db,"CheckWorkbookFileNameUpdate",sc,U,Ta,wb,Qb,0)},Bc=(db,U,Ta,wb,Qb,sc,Vc,Ld=null)=>{Ld=db.Pa(1,Ld);Ld.GenerateNotifications=U;Ld.DownloadNotifications=Ta;return Ua.g(db,"UploadLatencyTelemetry",Ld,wb,Qb,sc,Vc,128)};class $b{constructor(db){this.$=db}h7e(db){return db}pVf(db){return kb(this.$.qa.va,db.yth,db.Vtc,db.pH,null,null,
null)}Oze(db,U){if(!U)return db;if(!db)return d.ULS.shipAssertTag(537154133,0,!1,"CheckPersistedActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),U;db.Vtc=U.Vtc&&db.Vtc;return db}}Object(b.a)($b,"CheckPersistedActionAggregationPerformer",null,[677,678]);class tc{}Object(b.a)(tc,"RevisionGeneratedNotification",null,[]);class Xc{}Object(b.a)(Xc,"StateDownloadedNotification",null,[]);var qd=a(190);class Cd extends ca.a{constructor(db){super();this.mergeSuspensionManager=
this.jf=null;this.Jza=!1;this.oMd=null;this.DGc=this.CGc=this.EGc=this.pe=!1;this.ALb=(U,Ta)=>{this.Jza!==Ta.Jza&&(this.oMd=(this.Jza=Ta.Jza)?null:ka.a.Bb.Cc)};this.Td=()=>{this.$.Js&&this.o3j()};this.zd=(U,Ta)=>{Ta.Ec||this.ys(U,Ta)};this.ys=()=>{if(0<this.YCa.length||0<this.Fga.count)d.ULS.sendTraceTag(537154128,13,15,`Dropping ${this.YCa.length} revisionGeneratedNotifications and ${this.Fga.count} stateDownloadedNotifications.`),this.YCa=[],this.Fga=new qd.a;this.rtb.cancel();this.fsg();this.n6d();
this.tck()};this.UPf=(U,Ta)=>{this.m3j();this.n3j();U=new tc;U.Xluid=Ta.Tj;U.NotificationReceivedOn=ka.a.Bb.Cc.toISOString();U.CurrentPresenceUserCount=this.$.ea.to.length;U.OurCollabModeIsUsingOcs=this.$.ea.wab;U.SenderCollabMode=Ta.uKj;U.SenderClientType=Ta.tKj;U.SessionSiteIdentifier=Ta.R9;U.CommandTimeInMs=Ta.Bgh;d.ULS.sendTraceTag(537154127,13,50,`ContentLatencyTracker.OnRemoteRevisionGenerated: RevisionGeneratedNotification: ${JSON.stringify(U)}`);this.YCa.push(U)};this.Bj=()=>{this.jOe(this.$.ea.We,
"OnBlockCacheConsistent")};this.YPf=(U,Ta)=>{(U=Object(l.a)(791,Ta.Ie))&&this.jOe(U.QF,"OnRenderedContent")};this.khk=()=>{if(!this.$.ea.Ec)d.ULS.sendTraceTag(537154122,13,15,"ContentLatencyTracker.UploadLatencyTelemetryPeriodically: session isn't active");else if(this.YCa.length||this.Fga.count){var U=null;0<this.YCa.length&&(U=this.YCa,this.YCa=[]);var Ta=null;if(0<this.Fga.count){Ta=Array(this.Fga.count);let wb=0;for(let Qb of this.Fga.values)Ta[wb++]=Qb;this.Fga=new qd.a}d.ULS.sendTraceTag(537154120,
13,100,`ContentLatencyTracker.UploadLatencyTelemetryPeriodically: Uploading ${U?U.length:0} revisionGeneratedNotifications and ${Ta?Ta.length:0} stateDownloadedNotifications.`);Bc(this.$.qa.va,U,Ta,this.ydj,null,null,null)}};this.ydj=U=>{U.Result&&0<U.Result&&this.TEd()};this.$=db;this.Ca=Pa.h(this.$).Ca;this.viewport=Pa.h(this.$).view;this.contentRefreshManager=this.$.da.Ba(292);this.Af=this.$.Af;this.YCa=[];this.Fga=new qd.a;this.rtb=Fa.a.instance.ZD(this.khk,3E4,wa.a.jjh,!1,!1);this.$.Ql(this.Td);
this.$.ea.pk(this.zd);this.$.ea.P2c(this.ys);this.$.da.Gb(291,U=>{this.jf=U});this.$.da.Gb(343,U=>{this.pe||(this.mergeSuspensionManager=U,this.mergeSuspensionManager.R4b(this.ALb),this.mergeSuspensionManager.oNb())});d.ULS.sendTraceTag(537154131,13,50,"ContentLatencyTracker initialized");this.Td(this.$,null)}dispose(){this.pe=!0;this.rtb&&(this.rtb.dispose(),this.rtb=null);this.contentRefreshManager&&(this.fsg(),this.contentRefreshManager=null);this.Ca&&(this.n6d(),this.Ca=null);this.viewport&&(this.n6d(),
this.viewport=null);this.Af&&(this.Af=null);this.$&&(this.$.Rm(this.Td),this.$.ea.Kk(this.zd),this.$.ea.b5f(this.ys),this.$=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.lAc(this.ALb),this.mergeSuspensionManager=null);super.dispose()}o3j(){this.EGc||(this.contentRefreshManager.CYg(this.UPf),this.EGc=!0,this.rtb.Zq())}fsg(){this.EGc&&(this.contentRefreshManager.nzj(this.UPf),this.EGc=!1)}m3j(){this.CGc||(this.Ca.rw(this.Bj),this.CGc=!0)}n6d(){this.CGc&&(this.Ca.Vw(this.Bj),this.CGc=
!1)}n3j(){this.DGc||(this.viewport.DYg(this.YPf),this.DGc=!0)}tck(){this.DGc&&(this.viewport.qzj(this.YPf),this.DGc=!1)}jOe(db,U){if(db!==ja.a.Oe&&!this.Fga.Fb(db)){var Ta=ka.a.Bb.Cc.toISOString();Ta=Object(ha.a)(new Xc,{StateId:db,DownloadedOn:Ta,IsHidden:this.jf?this.jf.ui:"visible"!==window.document.visibilityState,DocumentLastUnhidden:this.jf&&this.jf.Ypc?this.jf.Ypc.toISOString():null,LastLostRtcConnection:this.contentRefreshManager&&this.contentRefreshManager.nxf?this.contentRefreshManager.nxf.toISOString():
null,LastOffline:this.Af&&this.Af.jAa?this.Af.jAa.toISOString():null});this.mergeSuspensionManager&&(Ta.IsPendingMergeBlockedByClient=this.Jza,this.oMd&&(Ta.PendingMergeBlockedByClientLastEnded=this.oMd.toISOString()));d.ULS.sendTraceTag(537154124,13,50,`ContentLatencyTracker.CreateAndAddstateDownloadedNotifications: ${U} - StateDownloadedNotification: ${JSON.stringify(Ta)}`);this.Fga.add(db,Ta)}}TEd(){k.AFrameworkApplication.Bf&&k.AFrameworkApplication.Bf.TEd()}}Object(b.a)(Cd,"ContentLatencyTracker",
ca.a,[]);var Xd=a(915),ge=a(916);class ve extends Sys.EventArgs{constructor(db,U,Ta,wb,Qb){super();this.Tj=db;this.uKj=U;this.tKj=Ta;this.R9=wb;this.Bgh=Qb}}Object(b.a)(ve,"RevisionGeneratedEventArgs",Sys.EventArgs,[]);class Ie{constructor(db,U,Ta,wb){this.kKc=this.Fxc=this.Swc=this.Qkc=0;this.Aie=this.nof=!1;this.clientId=db;this.hth=U;this.$=wb;this.QRi=ob.a.ve()+Ta}get fsf(){return this.Aie}vfk(){this.Fxc||(this.Fxc=ob.a.ve(),this.xAa())}sfk(){this.Qkc||(this.Qkc=ob.a.ve(),this.xAa())}ufk(){this.Swc||
(this.Swc=ob.a.ve(),this.xAa())}wfk(db){this.kKc||(this.kKc=ob.a.ve(),this.nof=db,this.xAa())}xAa(db=0){this.fsf||(db&&db>this.QRi?this.LA(!0):this.Fxc&&this.Swc&&this.Qkc&&this.kKc&&this.LA(!1))}dispose(){this.$=null}LA(db){const U={};U.CoAuthorsCount=this.$.ea.to.length;U.HostNotificationTime=this.Qkc;U.PeerNotificationTime=this.Swc;U.PresenceNotificationTime=this.Fxc;U.UserFetchTime=this.kKc;U.IsAlreadyFetchedFromServer=this.nof;U.IsTimeout=db;U.ClientId=this.clientId;U.CurrentUserClientId=this.hth;
fb.EwaSettings.isChangeGateEnabled("OfficeVSO:6875242_useStringLiteralToPrintJsonObjectInLogs")?d.ULS.sendTraceTag(541388879,0,50,`Host Notification Latency Entry: ${JSON.stringify(U)}`):d.ULS.sendTraceTag(541388879,0,50,"Host Notification Latency Entry: {0}",U);this.Aie=!0}}Object(b.a)(Ie,"HostNotificationLatencyEntry",null,[2]);class Ee{constructor(db,U,Ta){this.yth=db;this.Vtc=U;this.pH=Ta}}Object(b.a)(Ee,"PersistedContentUpdateActionParameters",null,[]);class pf{constructor(db,U,Ta){this.iOc=
{};this.jOc={};this.pH=Ta;this.J5b(db,this.iOc);this.J5b(U,this.jOc)}get S8c(){return oe.a(this.iOc)}get T8c(){return oe.a(this.jOc)}get Sqf(){return!this.S8c.length&&!this.T8c.length}tbk(db){this.J5b(db.S8c,this.iOc);this.J5b(db.T8c,this.jOc)}J5b(db,U){if(db)for(const Ta of db)U[Ta]=!0}}Object(b.a)(pf,"UpdatePresenceUsersActionParameters",null,[]);class Xe extends ya.a{constructor(db,U,Ta,wb){super();this.Yg=null;this.uHd=!1;this.$je=this.currentUserId=this.Isd=null;this.pKd=(Qb,sc)=>{if(sc.fK){Qb=
sc.fK;for(let Vc in Qb)(Qb=Vc)&&Qb!==this.currentUserId&&!this.D3a.has(Qb)&&this.hic(Qb).vfk()}};this.GC=()=>{this.j1f()};this.ifa=(Qb,sc)=>{this.uHd=!0;Qb=Object(l.a)(Object,sc.y$);if(1===sc.type){var Vc=fb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1);if(null===Qb||void 0===Qb?0:Qb[ja.a.Spi]){if(!Vc||!Object(l.a)(String,Qb[ja.a.Jkf]))return;var Ld=this.kNe(Object(l.a)(String,Qb[ja.a.Jkf]));Object(l.a)(String,Qb[ja.a.Kkf])===ja.a.Qpi?(Ld=[Ld],Ld[0]===this.currentUserId||
this.D3a.has(Ld[0])||this.hic(Ld[0]).sfk(),this.bhg(Ld)&&this.Zjb(Ld,null)):Object(l.a)(String,Qb[ja.a.Kkf])===ja.a.Rpi&&Ld!==this.currentUserId&&this.Zjb(null,null)}else{sc=Array.isArray(sc.y$)?sc.y$:null;!sc&&Qb&&(sc=Array.isArray(Qb[ja.a.ZVe])?Qb[ja.a.ZVe]:null);if(sc&&Vc)for(Ld of sc)Ld===this.currentUserId||this.D3a.has(Ld)||this.hic(Ld).ufk();sc&&!this.bhg(sc)||this.Zjb(sc,null);return}}if(Qb)if(0===sc.type)({R0f:Ld}=this.$sb(Qb)).returnValue?(this.hSa(Qb),ja.a.We in Qb&&(this.$.ea.KY(Qb[ja.a.We],
"ContentRefreshManager.OnUpdateNotificationReceived"),this.xsg())):d.ULS.sendTraceTag(22905367,0,50,`RTC ContentUpdate session identifier mismatch. Received: ${Ld}. Expected: ${this.$.ea.R9}. Ignoring this update.`);else{if(3===sc.type){if(!(ja.a.m9f in Qb)){d.ULS.sendTraceTag(537154117,13,10,"RTC WetContentUpdate does not specify a type. Ignoring this update.");return}sc=Qb[ja.a.m9f];sc===ja.a.EFj?this.kmi(Qb):sc!==ja.a.CFj&&sc!==ja.a.GFj&&sc!==ja.a.HFj&&sc!==ja.a.FFj&&sc!==ja.a.DFj&&d.ULS.sendTraceTag(537154081,
13,50,`RTC WetContentUpdate of unknown type ${sc}. Ignoring this update.`);return}if(4===sc.type){if(this.$sb(Qb).returnValue)return;this.$.ea.Lzi()&&this.adh();if(this.Twj)return;Ld=!1;ja.a.wVf in Qb&&(Ld=Qb[ja.a.wVf]);if(this.$.ea.wab&&Ld)return;Vc=Qb[ja.a.Qhj];this.$.ea.Ec&&Vc&&this.Phj.sVf(new Ee(Vc,Ld,this.N1i))}else if(8===sc.type)return}2===sc.type?Qb&&this.$sb(Qb).returnValue||(d.ULS.sendTraceTag(537154079,0,50,"RTC : FileNameUpdate received. Now invoking CheckWorkbookFileNameUpdate web method"),
qc(this.$.qa.va,null,null,null,null)):12!==sc.type||Qb&&this.$sb(Qb).returnValue||this.raiseEvent("LabelUpdateEventKey")};this.N1i=Qb=>{var sc=Qb.Errors;ra.a.Aq(sc)?(sc=ra.a.bB(sc,[1552731907],"ContentRefreshManager"),ra.a.oja(sc)||this.$.ea.To(sc)):(sc=Qb.StateId+1,Qb.Result&&this.$.ea.We<sc&&this.$.ea.KY(ja.a.Oe,"ContentRefreshManager.OnCheckForUpdateSuccess"))};this.Th=()=>{this.vFj&&this.uHd&&this.$.ea.Vcc&&this.xsg()};this.QJf=()=>{this.uHd=!1;this.$.ea.oga=500;this.$je=ka.a.Bb.Cc};this.Vea=
(Qb,sc)=>{this.L1d(sc.Yg)};this.$=db;this.Jl=U;this.$.qa.ms(this.Th);this.Jl.Vrb(this.Vea);this.Jl.Cxe(this.QJf);this.Phj=Ta;this.Pfk=wb;this.NOa={};this.D3a=new Set;this.Jl.y3a();fb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)&&(this.currentUserId=this.$.workbookContext.ClientId,this.j1f(),this.$.ea.fba(this.GC));this.Twj=fb.EwaSettings.isChangeGateEnabled("OfficeVSO:7792548_RemoveWebRequestsForPersistedContentUpdates")}CYg(db){this.addHandler("ekcrmrrg",
db)}nzj(db){this.removeHandler("ekcrmrrg",db)}n1a(db){this.addHandler("ekcrmmcu",db)}Kfb(db){this.removeHandler("ekcrmmcu",db)}wXg(db){this.addHandler("LabelUpdateEventKey",db)}xyj(db){this.removeHandler("LabelUpdateEventKey",db)}get nxf(){return this.$je}get vFj(){return!!this.Yg&&2===this.Yg.connectionState}Zjb(db,U){this.$.ea.Ec&&(d.ULS.sendTraceTag(39150978,0,50,`ContentRefreshManager.UpdatePresenceUsers: clientIdsToAdd=[${db?db.join(","):"null"}] clientIdsToRemove=[${U?U.join(","):"null"}]`),
this.Pfk.sVf(new pf(db,U,null)))}dispose(){this.Yg&&(this.Yg.MOb(this.ifa),this.Yg.ZTa(this.pKd));this.$&&(this.$.qa.Mt(this.Th),this.$.ea.v9(this.GC));this.Jl&&(this.Jl.Lzc(this.Vea),this.Jl.h4f(this.QJf));this.$=this.Yg=this.D3a=this.NOa=null;super.dispose()}L1d(db){this.Yg&&(this.Yg.MOb(this.ifa),this.Yg.ZTa(this.pKd));this.Yg=Object(l.a)(352,db);this.Yg.t1a(this.ifa);fb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)&&this.Yg.q1a(this.pKd);this.currentUserId=
this.Yg.clientId}j1f(){const db=!this.Yg;var U=this.$.ea.to;for(const Ta of U)(U=Ta.User.UserID)&&U!==this.currentUserId&&!this.D3a.has(U)&&this.hic(U).wfk(db)}kmi(db){if(ja.a.l9f in db&&ja.a.k9f in db&&ja.a.j9f in db){var U=db[ja.a.j9f];1!==U||ja.a.R9 in db&&ja.a.DBc in db||d.ULS.sendTraceTag(537154076,13,10,`RTC WetContentUpdate was sent from ECS and is missing some expected fields. Has SessionSiteIdentifier: ${ja.a.R9 in db}, Has UserOperationTimeInMs: ${ja.a.DBc in db}.`);var Ta;({R0f:Ta}=this.$sb(db)).returnValue||
(db=new ve(db[ja.a.l9f],db[ja.a.k9f],U,Ta,ja.a.DBc in db?db[ja.a.DBc]:0),this.raiseEvent("ekcrmrrg",db,this))}else d.ULS.sendTraceTag(537154077,13,10,"RTC WetContentUpdate is missing some critical fields. Ignoring this update.")}$sb(db){db=ja.a.R9 in db?db[ja.a.R9]:null;return{returnValue:this.$.ea.R9===db,R0f:db}}xsg(){this.$.ea.oga=Math.max(Xe.D4g,this.$.ea.oga)}bhg(db){for(const U of db)if(!this.$.ea.UBb(U))return!0;return!1}adh(){this.$.xd(1562177611,-1,0,null)}hSa(db){ja.a.hEf in db&&ja.a.iEf in
db&&ja.a.lEf in db&&(db=Object(ha.a)(new Xd.a,{Pending:db[ja.a.iEf],Current:db[ja.a.hEf],SuspensionStartTimestamp:db[ja.a.lEf]}),this.raiseEvent("ekcrmmcu",new ge.a(db),this))}hic(db){db=this.kNe(db);if(!this.NOa[db]){const U=new Ie(db,this.currentUserId,4E4,this.$);this.NOa[db]=U}this.O$f();return Object(l.a)(Ie,this.NOa[db])}kNe(db){if(!db)return db;let U=db.toLocaleLowerCase();U.startsWith("{")||(U="{"+db+"}");return U}O$f(){this.Isd||x.a.isEmpty(this.NOa)||!fb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",
!1)||(this.Isd=w.Task.delay(2E4).continueWith(()=>{this.Ppi()}))}Ppi(){const db=[],U=ob.a.ve(),Ta=this.NOa;for(let Qb in Ta){var wb=Qb;const sc=Object(l.a)(Ie,Ta[Qb]);sc.xAa(U);sc.fsf&&(sc.dispose(),db.push(wb))}for(const Qb of db)delete this.NOa[Qb],this.D3a.add(Qb);this.Isd=null;this.O$f()}}Xe.D4g=3E4;Object(b.a)(Xe,"ContentRefreshManager",ya.a,[679]);var Ve=a(205),wf=a(77);class Ff{constructor(db){this.$=db}h7e(db){return db+5E3}pVf(db){return this.$.ea.Ec?ia.TaskExtensions.ts(ia.TaskExtensions.ts(w.Task.delay(0),
()=>Vb(this.$.qa.va,db.S8c,db.T8c,db.pH,null,null,null),Ve.a.none,0,wf.a.current),()=>w.Task.delay(5E3),Ve.a.none,0,wf.a.current):w.Task.Ua(!0)}Oze(db,U){if(!U)return db;if(!db)return d.ULS.shipAssertTag(537154073,0,!1,"UpdatePresenceUsersActionAggregationPerformer.AggregateActionParameters: Received null newActionParameter"),U;if(U.Sqf)return U;if(db.Sqf)return db;U.tbk(db);return U}}Object(b.a)(Ff,"UpdatePresenceUsersActionAggregationPerformer",null,[677,678]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.CoauthTelemetry");
Z.main();Type.registerNamespace("Common.App.CollabControls");Type.registerNamespace("Common.App.Presence");Type.registerNamespace("RealtimePresenceUI");nb.a.Fa(Va.la);(()=>{nb.a.Fa(db=>{fb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&Ka.la(db);const U=db.da,Ta=Object(Cb.b)("OfficeVSO:7624673_NamedSheetViewConversionManagerService");Ta||U.Ja(28,new qb(db));U.Ja(158,new bc(db));nb.a.Fa(zb.la);const wb=V.GetServiceTaskFactory.create(db.da,158,U.ka,1),Qb=Ta?Object(xa.d)(Xa.a.resolve(Za.X,
{Wa:1})):V.GetServiceTaskFactory.create(db.da,28,U.ka,1);ia.TaskExtensions.za(ia.TaskExtensions.ke([wb,Qb],U.ka),()=>{const sc=new h.a,Vc=U.Ba(26);Vc.bQe(Object(f.a)(sc,sc.setResult,"setResult"));const Ld=new Se(db,Vc,wb.result,Qb.result,aa.a.dr(pa.a.instance.qc("Common.App.CoauthTelemetry.IPresenceBootTelemetry")));Ma.a.getInstance(db.da).add(Ld);U.Ja(159,new zb);ia.TaskExtensions.za(V.GetServiceTaskFactory.create(U,159,U.ka,1),le=>{const Ce=new h.a;Ce.setResult(Ld);new mb(Object(ha.a)(new sb.a,
{clientId:db.workbookContext.ClientId}),sc.task,Ce.task,le.result,Ya.a.instance,k.AFrameworkApplication.fa.ra("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:k.AFrameworkApplication.fa.oe("AwayCoauthorThresholdMs",9E5),Object(f.a)(k.AFrameworkApplication.Qb,k.AFrameworkApplication.Qb.processAction,"processAction"),ub.instance)},U.ka)},U.ka,3);pa.a.instance.register(191,"Microsoft.Office.Excel.WebUI.Client.ISessionStateManager").as("Common.ICoauthoringTelemeryInfoProvider").Uc().dd(()=>db.ea);pa.a.instance.resolve("Common.ICoauthoringTelemeryInfoProvider");
pa.a.instance.register(yb,"Microsoft.Office.Excel.WebUI.Client.Presence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").Uc().dd(()=>new yb(db));pa.a.instance.resolve("Common.IPeopleInfoProvider")})})();nb.a.Fa(Fc.a.la);nb.a.Fa(db=>{const U=db.da,Ta=V.GetServiceTaskFactory.Za(db.da,211,212,1);U.Gb(25,wb=>{ia.TaskExtensions.za(Ta,Qb=>{U.Ba(231)||new td(Qb.result,db,wb)},U.ka,3)})});(()=>{nb.a.Fa(db=>{const U=Object(Cb.b)("OfficeVSO:7629428_MigrateSharedUIControlsFactoryService")?Object(xa.d)(Xa.a.resolve(Za.mb,
{Wa:0})):V.GetServiceTaskFactory.Za(db.da,12,477,0);ia.TaskExtensions.za(U,Ta=>{var wb=db.da.Ba(291),Qb=new $b(db);wb=Ta.result.aOe(Qb,Qb,wb,"persisted");Qb=new Ff(db);Ta=Ta.result.aOe(Qb,Qb,null,"updatePresence");db.da.Ja(292,new Xe(db,db.da.Ba(26),wb,Ta));Ma.a.getInstance(db.da).add(new Cd(db));Ma.a.getInstance(db.da).add(wb)},db.ka)})})();String(c);window.___1684305534366_closurehack=c},751:function(u,C,a){a.r(C);a.d(C,"RtcUtils",function(){return e});u=a(0);var c=a(15),b=a(845),f=a(43);class e{static b8c(d,
h=b.RealtimeChannel.$Ed){let l;try{l=f.c(d)}catch(k){throw d=String.format("Failed to JSON-serialize payload : {0}",k),c.ULS.sendTraceTag(18637072,500,10,d),Error.argument("payload",d);}if(l.length>h)throw d=String.format("Payload exceeds maximum length: {0} > {1}.",l.length,h),c.ULS.sendTraceTag(18637074,500,10,d),Error.argument("payload",d);return l}static deserialize(d,h,l){if(!d)return null;if(Object.getType(d)!==String){var k=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
h,Object.getType(d).getName(),l);c.ULS.sendTraceTag(18637075,500,10,k);return null}k=null;try{k=f.a(d)}catch(n){d=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",h,n,l),c.ULS.sendTraceTag(18637077,500,10,d)}return k}static ycb(d){if(!d)return"";if("string"===typeof d)return d.toString();try{return f.c(d)}catch(h){return d.toString()}}static qQh(d){let h,l,k;h=0;k=l=null;if(!d)return{Zkf:h,alf:l,exception:k};try{const n=d.source;n&&Object.getType(n)===
String&&(k=n);const v=d.context;v&&(d=v,h=d.status?d.status:0,l=d.statusText?d.statusText:null)}catch(n){}return{Zkf:h,alf:l,exception:k}}}Object(u.a)(e,"RtcUtils",null,[])},845:function(u,C,a){a.r(C);u=a(0);var c=a(15),b=a(88),f=a(170),e=a(914),d=a(106),h=a(6);class l{constructor(Ba,Wa){this.status=Ba;this.bbb=Wa}}Object(u.a)(l,"UserStatusInfo",null,[]);var k=a(82),n=a(583),v=a(199);class x{constructor(Ba){this.messageId=Ba;this.lKj=(new Date).getTime();this.CBd=new v.a}}Object(u.a)(x,"MessageLatencyDetails",
null,[]);class w{constructor(Ba,Wa,Na){this.raa=null;this.UUc=this.DYc=0;this.Re=Wa;this.Ele=Na;this.aqb=!1;this.Eh=Ba;this.Eh.t1a(Object(b.a)(this,this.yrj,"receiveMessage"))}start(){if(this.Ele&&!this.aqb){const Ba=this.Re.t9f;this.UUc=this.Re.q9f;Ba<=this.UUc?(c.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Re.t9f,this.Re.q9f),
this.Ele=!1):(this.aqb=!0,this.DYc=window.setInterval(Object(b.a)(this,this.sendMessage,"sendMessage"),Ba))}}sendMessage(){if(this.aqb){const Ba=n.a.create().toString();this.raa=new x(Ba);this.Eh.uPd(16,Ba,!1,new f.a);window.setTimeout(()=>{this.vQi(Ba)},this.UUc)}}vQi(Ba){this.raa&&this.raa.messageId===Ba&&(0<this.raa.CBd.count?(Ba=this.raa.CBd.toArray().join(","),c.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",Ba)):c.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.raa=null)}stop(){this.DYc&&(window.clearInterval(this.DYc),this.aqb=!1)}yrj(Ba,Wa){16===Wa.type?this.Eh.uPd(17,Wa.y$,!1,new f.a):17===Wa.type&&this.aqb&&Wa.y$&&this.vmj(Wa.y$)}vmj(Ba){Ba&&this.raa&&Ba.toString()===this.raa.messageId&&(Ba=(new Date).getTime()-this.raa.lKj,this.raa.CBd.add(Ba))}static get instance(){return w.Oa}static kod(Ba,Wa,Na){return w.instance||(w.Oa=new w(Ba,Wa,Na))}}w.Oa=null;Object(u.a)(w,"ClientToClientMessageTelemetry",null,[]);var r=a(986),t=a(913);class A{constructor(Ba,
Wa){this.data=Ba;this.timeStamp=Wa}}Object(u.a)(A,"PresenceData",null,[]);class y{constructor(Ba){this.Laa=!1;this.w0a=0;this.FOc=!1;this.setTimeout=y.ddd;this.clearTimeout=y.Scd;this.$Ri=Object(b.a)(this,this.nRi,"logRtcConnectingUsageStatement");this.Ym=Ba}A2i(){this.Laa||(this.w0a=this.setTimeout(()=>{this.Laa=!1;this.CAf()},8E3),this.Laa=!0,this.FOc=!1)}D3i(){this.zN()}ncj(){this.CAf()}CAf(){this.zN();this.FOc||(this.FOc=!0,this.$Ri())}nRi(){c.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",
this.Ym)}zN(){this.Laa&&this.clearTimeout(this.w0a);this.w0a=0;this.Laa=!1}static ddd(Ba,Wa){return window.setTimeout(Ba,Wa)}static Scd(Ba){window.clearTimeout(Ba)}}Object(u.a)(y,"ConnectedUsageKpiLogger",null,[942]);class z{constructor(){this.a1f=this.mQd;this.d1f=this.pQd;this.c1f=this.oQd;this.h1f=this.rQd;this.g1f=this.qQd;this.wQd=this.xQd;this.ENb=this.uQd;this.DTa=this.sQd;this.ETa=this.tQd;this.b1f=this.nQd;this.zJb=this.LGd;this.gtc=this.NGd}mQd(){}pQd(){}oQd(){}rQd(){}qQd(){}uQd(){}tQd(){}sQd(){}xQd(){}nQd(){}LGd(){}NGd(){}}
Object(u.a)(z,"NoopRealtimeChannelMetrics",null,[935,69]);class E{}E.OUb="presenceUpdated";E.updateNotification="updateNotification";E.zVf="persistentStateCleared";E.updatePersistentState="persistentStateUpdated";Object(u.a)(E,"RtcClientMethodNames",null,[]);class G{}G.fqi="realtimeChannelHub";G.OUb="UpdatePresence";G.P9="SendUpdateNotification";G.Qld="GetCompletePersistentStateWithMetadata";G.updatePersistentState="UpdatePersistentState";G.Njb="UpdateClientInfo";Object(u.a)(G,"RtcHubMethodNames",
null,[]);class F{constructor(Ba){this.Zs=Ba}wuj(Ba){this.Zs.on(E.OUb,Ba)}Yuj(Ba){this.Zs.on(E.updateNotification,Ba)}uuj(Ba){this.Zs.on(E.updatePersistentState,Ba)}tuj(Ba){this.Zs.on(E.zVf,Ba)}Ybk(Ba){this.Zs.off(E.OUb,Ba)}hck(Ba){this.Zs.off(E.updateNotification,Ba)}Xbk(Ba){this.Zs.off(E.updatePersistentState,Ba)}Wbk(Ba){this.Zs.off(E.zVf,Ba)}OUb(Ba){return this.Zs.invoke(G.OUb,Ba)}Njb(Ba){return this.Zs.invoke(G.Njb,Ba)}P9(Ba,Wa){return this.Zs.invoke(G.P9,Ba,Wa)}Qld(Ba){return this.Zs.invoke(G.Qld,
Ba)}updatePersistentState(Ba,Wa){return this.Zs.invoke(G.updatePersistentState,Ba,Wa)}}Object(u.a)(F,"RealtimeChannelProxy",null,[939,940,941]);class O{constructor(){this.dNc=this.abe=!1;this.bNc=0;this.kOc=this.$Yc=this.ZYc=this.yMc=!1;this.lQc=0;this.Wpe=!1;this.Vpe=this.Upe=0;this.dYc=!1;this.iYc=this.gYc=this.jYc=this.eYc=0;this.hYc=!1}get A4g(){return this.dNc}get z4g(){return this.bNc}get R_g(){return this.yMc}get zUj(){return this.ZYc}get AUj(){return this.$Yc}get Veh(){return this.kOc}get kfc(){return this.lQc}get rtcJsClientFrequentlyLogsMetrics(){return this.Wpe}get o9f(){return this.Upe}get BFj(){return this.Vpe}get rtcClientMessageTelemetryEnabled(){return this.dYc}get xFj(){return this.eYc}get t9f(){return this.jYc}get q9f(){return this.gYc}get s9f(){return this.iYc}get r9f(){return this.hYc}static createInstance(Ba){const {RealtimeChannel:Wa}=
a(845);return Ba?Object.assign(new O,{abe:Ba.ra("AwayStatusManagerIsEnabled"),dNc:Ba.ra("AwayStatusOneMinuteTimeoutIsEnabled"),bNc:Ba.oe("AwayCoauthorThresholdMs",9E5),yMc:Ba.ra("RtcAllowCrossDomainAccessEnabled"),ZYc:Ba.ra("ShouldLogOnContentNotification"),$Yc:Ba.ra("ShouldLogOnHostSubscriptionNotification"),kOc:Ba.ra("RtcClientMetricsEnabled"),lQc:Ba.oe("RtcFindSessionRequestTimeoutInMS",6E4),Wpe:Ba.ra("RtcJsClientFrequentlyLogsMetrics"),Upe:Ba.oe("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),Vpe:Ba.oe("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),dYc:Ba.ra("RtcClientMessageTelemetryEnabled"),eYc:Ba.oe("RtcClientMessageTelemetrySampleSize",5),jYc:Ba.oe("RtcSendTelemetryMessageIntervalInMS",3E5),gYc:Ba.oe("RtcLogClientMessageMetricsTimeOutInMs",2E4),iYc:Ba.oe("RtcMaxPayloadSizeInCharactersOverride",Wa.$Ed),hYc:Ba.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new O,{abe:!1,dNc:!1,bNc:9E5,yMc:!1,ZYc:!1,$Yc:!0,kOc:!1,lQc:9E4,
dYc:!1,eYc:5,jYc:3E5,gYc:2E4,iYc:Wa.$Ed,hYc:!1})}}Object(u.a)(O,"RealtimeChannelSettings",null,[938]);var M=a(1207),P=a(126),B=a(386);class D{constructor(Ba){this.Eqb=null;this.ega=0;this.FMa=!1;this.Eh=Ba;this.Eh.G4(Object(b.a)(this,this.wX,"onConnectionStateChanged"))}wX(Ba,Wa){this.ega=Wa.newState}cdj(){c.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Eh.syc()}Tsi(Ba){this.Eqb.init(Ba)}}Object(u.a)(D,"ARtcMessageHandler",null,[]);var I=a(371);
class S{constructor(){this.Presence=null;this.TimeStamp=0}}Object(u.a)(S,"PresenceDataEntryForClients",null,[]);var J=a(115);class L{constructor(Ba,Wa=""){this.yNg=Ba;this.qK=Wa}send(){return this.yNg()}get messageId(){return this.qK}}Object(u.a)(L,"MessageHandler",null,[958]);class R{constructor(){this.Kbe=this.DOc=!1;this.callback=null}Kcb(Ba){this.callback=Ba;this.Ipg()}bDf(Ba){this.DOc||(this.DOc=!0,this.LEg=Ba,this.Ipg())}Ipg(){this.DOc&&this.callback&&!this.Kbe&&(this.Kbe=!0,this.callback(this.LEg))}}
Object(u.a)(R,"CompletionTask",null,[]);class Y{constructor(){this.Dle=new R;this.Ble=new R}cvc(Ba){this.Dle.Kcb(Ba)}bvc(Ba){this.Ble.Kcb(Ba)}JIb(Ba){this.Dle.bDf(Ba)}OAa(Ba){this.Ble.bDf(Ba)}UEd(){this.JIb(2);this.OAa(2)}}Object(u.a)(Y,"MessageStatus",null,[959]);class Q extends Sys.EventArgs{constructor(Ba,Wa,Na,ta){super();this.kTd=Ba;this.reconnectDelay=Wa;this.reason=Na;this.EWd=ta}}Object(u.a)(Q,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var W=a(1023);class Ga{constructor(){this.BZc=
this.Rp=null}get fd(){return this.Rp?this.BZc?this.BZc.getTime()-this.Rp.getTime():(new Date).getTime()-this.Rp.getTime():0}start(){this.Rp=new Date}stop(){this.BZc=new Date}}Object(u.a)(Ga,"SimpleStopwatch",null,[]);var pa=a(1024),aa;(function(Ba){Ba[Ba.contentUpdate=0]="contentUpdate";Ba[Ba.editorsTableUpdate=1]="editorsTableUpdate";Ba[Ba.fileNameUpdate=2]="fileNameUpdate";Ba[Ba.wetContentUpdate=3]="wetContentUpdate";Ba[Ba.persistedContentUpdate=4]="persistedContentUpdate";Ba[Ba.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";Ba[Ba.replicationTelemetry=6]="replicationTelemetry";Ba[Ba.lockUpdate=7]="lockUpdate";Ba[Ba.collabServiceContentUpdate=8]="collabServiceContentUpdate";Ba[Ba.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";Ba[Ba.saveTargetUpdate=10]="saveTargetUpdate";Ba[Ba.uploadToOcsUpdate=11]="uploadToOcsUpdate";Ba[Ba.labelUpdate=12]="labelUpdate";Ba[Ba.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";Ba[Ba.subscribeOrExtend=14]="subscribeOrExtend";
Ba[Ba.elapsedBootTelemetry=15]="elapsedBootTelemetry";Ba[Ba.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";Ba[Ba.clientToClientResponseMessage=17]="clientToClientResponseMessage";Ba[Ba.verifyNotificationPipeline=18]="verifyNotificationPipeline";Ba[Ba.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";Ba[Ba.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";Ba[Ba.last=21]="last"})(aa||(aa={}));Object(u.b)("UpdateNotificationType",aa);var Z=a(592),fa=a(613),ya=a(614);
class Aa extends D{constructor(Ba,Wa,Na,ta,V,ia,X,la,sa,Va){super(X);this.Zs=null;this.Ske=!1;this.qK=0;this.JWc=new B.a;this.SJg=Aa.N2h();this.vWc=h.AFrameworkApplication.fa.Va("OwningFeatureCrewForRtcNotificationKpis");this.Re=Ba;this.ume=this.tme=0;this.Eqb=Wa;this.Eqb.S4b(Object(b.a)(this,this.cdj,"onTooManyUndeliveredMessages"));this._clientId=Na;this.mMg=V;this.Eh.AYg(Object(b.a)(this,this.Z$i,"onRefreshProxyRequired"));this.Eh.yYg(Object(b.a)(this,this.Y$i,"onRefreshAllPersistentStateRequest"));
this.Eh.RYg(Object(b.a)(this,this.P9,"sendUpdateNotification"));this.Eh.jXg(Object(b.a)(this,this.Z7i,"onInternalPresenceUpdated"));this.Eh.kXg(Object(b.a)(this,this.$7i,"onInternalUpdateNotificationReceived"));this.Eh.iXg(Object(b.a)(this,this.Y7i,"onInternalPersistentStateUpdated"));this.Eh.hXg(Object(b.a)(this,this.X7i,"onInternalPersistentStateCleared"));this.Eh.QYg(Object(b.a)(this,this.BQb,"sendPersistentState"));this.Eh.lZg(Object(b.a)(this,this.Njb,"updateClientInfo"));this.gi=ia;this.Ym=
ta;this.ym=la;this.rD=sa;this.Bob=Va;this.bsa=Object(P.a)(String,h.AFrameworkApplication.Nc.Application)||""}Z$i(Ba,Wa){this.Zs=this.mMg(Wa.hubConnection);this.Eqb.reset();this.Zs.wuj(Object(b.a)(this,this.Soa,"onPresenceUpdated"));this.Zs.uuj(Object(b.a)(this,this.z1,"onPersistentStateUpdated"));this.Zs.tuj(Object(b.a)(this,this.kKd,"onPersistentStateCleared"));this.Zs.Yuj(Object(b.a)(this,this.ifa,"onUpdateNotificationReceived"))}wX(Ba,Wa){this.ega=Wa.newState;2===Wa.newState&&this.XJj()}XJj(){for(let Ba of this.JWc)this.P9(null,
new W.a(Ba.key,Ba.value,!1,new f.a));this.JWc=new B.a}Y$i(Ba,Wa){Wa.w8c();for(Ba=0;3>Ba;++Ba)this.FJj(Ba,Wa)}FJj(Ba,Wa){try{this.Zs.Qld(Ba).done(Na=>{Wa.skb(Wa.n$c,"GetCompletePresenceSuccess")&&(Wa.Fih.ncj(),c.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Ym),this.Eh.spj(),this.k$i(Ba,Na),this.Eh.Poj(Na),Wa.l2e.Fb(Ba)&&this.Eh.n_f(Ba,Wa.l2e.ma(Ba),new f.a))}).fail(Na=>{const {RtcUtils:ta}=a(751);Wa.skb(Wa.n$c,"GetCompletePresenceFail")&&(c.ULS.sendTraceTag(3249541,
500,15,"Failed to retrieve complete session state : {0} for [{1}]",ta.ycb(Na),this.Ym),this.Eh.syc())}).always(()=>{Wa.stopwatch&&Wa.stopwatch.stop()})}catch(Na){c.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",Wa.n$c,Na.message)}}BQb(Ba,Wa){var {RtcUtils:Na}=a(751);Ba=Wa.presence;let ta;const V=Wa.bra;this.rD.rz(1,0);try{ta=Na.b8c(Ba,this.Bob)}catch(X){this.rD.rz(1,
3);c.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",X.message);V.setException(X);return}Na=new d.a;Na.ia(this._clientId,Object.assign(new S,{Presence:Ba,TimeStamp:(new Date).getTime()}));this.Eh.v_f(Wa.type,Na);if(2!==this.ega)this.ym.DTa(),this.rD.rz(1,2),V.setResult(null);else{var ia=this.qK.toString();++this.qK;Ba=new L(()=>this.ZJj(Wa.type,ta,ia),ia);Ba=this.dog(0,Wa.type).add(Ba);Ba.cvc(X=>{2===X&&this.rD.rz(1,6);V.setResult(null)});
Ba.bvc(()=>{})}}ZJj(Ba,Wa,Na){let ta=null;const V=new Ga,ia=new Y;c.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Ym);if(2!==this.ega)return this.ym.DTa(),this.rD.rz(1,2),c.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Ym),ia.UEd(),ia;this.gi&&20>this.tme&&(ta=this.gi.qd("WebServiceCall","Send Presence Message"),this.tme++);V.start();ia.JIb(1);try{this.Zs.updatePersistentState(Ba,Wa).done(()=>{this.ym.ENb();this.rD.rz(1,
1);c.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Na,this.Ym);ia.OAa(1);V&&(V.stop(),V.fd>this.Re.o9f?this.rD.rz(1,4):this.rD.rz(1,5))}).fail(X=>{const {RtcUtils:la}=a(751);this.FMa||(this.ym.DTa(),this.rD.rz(1,3),c.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Na,la.ycb(X),this.Ym));ia.OAa(2)}).always(()=>{ta&&ta.stop()})}catch(X){c.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
X.message),this.rD.rz(1,3),ia.OAa(2)}return ia}Njb(Ba,Wa){({RtcUtils:Ba}=a(751));const Na=Wa.Ueh,ta=Wa.bra;let V;try{V=Ba.b8c(Na,this.Bob)}catch(ia){c.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",ia.message);ta.setException(ia);return}try{this.Zs.Njb(V).done(()=>{c.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(ia=>{const {RtcUtils:X}=a(751);this.FMa||c.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",
X.ycb(ia));ta.setResult(null)})}catch(ia){c.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",ia.message),ta.setResult(null)}}P9(Ba,Wa){({RtcUtils:Ba}=a(751));const Na=Wa.type,ta=Wa.y$,V=Wa.Uvh,ia=Wa.bra;let X;this.rD.rz(0,0);try{X=Ba.b8c(ta,this.Bob)}catch(sa){this.rD.rz(0,3);c.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",sa.message);ia.setException(sa);return}if(2!==this.ega)V?
this.JWc.ia(Na,ta):(this.ym.DTa(),this.rD.rz(0,2)),ia.setResult(null);else{var la=this.qK.toString();++this.qK;Wa=new L(()=>this.sKj(Na,X,la),la);Wa=this.dog(1,Na).add(Wa);Wa.cvc(sa=>{2===sa&&this.rD.rz(0,6);ia.setResult(null)});Wa.bvc(()=>{})}}sKj(Ba,Wa,Na){let ta=null;const V=new Ga,ia=new Y;c.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.Ym);if(2!==this.ega)return this.ym.DTa(),this.rD.rz(0,2),c.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",
this.Ym),ia.UEd(),ia;this.gi&&3===Ba&&20>this.ume&&(ta=this.gi.qd("WebServiceCall","Send WetContent Update"),this.ume++);V.start();ia.JIb(1);this.Zs.P9(Ba,Wa).done(()=>{this.ym.ENb();this.rD.rz(0,1);c.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Na,this.Ym);ia.OAa(1);V&&(V.stop(),V.fd>this.Re.o9f?this.rD.rz(0,4):this.rD.rz(0,5))}).fail(X=>{const {RtcUtils:la}=a(751);this.FMa||(this.ym.DTa(),this.rD.rz(0,3),c.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",
Na,la.ycb(X),this.Ym));ia.OAa(2)}).always(()=>{ta&&ta.stop()});return ia}gx(){this.Zs.Ybk(Object(b.a)(this,this.Soa,"onPresenceUpdated"));this.Zs.Xbk(Object(b.a)(this,this.z1,"onPersistentStateUpdated"));this.Zs.Wbk(Object(b.a)(this,this.kKd,"onPersistentStateCleared"));this.Zs.hck(Object(b.a)(this,this.ifa,"onUpdateNotificationReceived"))}Z7i(Ba,Wa){this.Soa(Wa.fK,Wa.N5)}Soa(Ba){this.ym.ETa();this.z1(0,Ba)}Y7i(Ba,Wa){this.z1(Wa.type,Wa.fK)}k$i(Ba,Wa){const Na={};for(let ta in Wa)Na[ta]=Wa[ta].Presence;
this.ePf(Ba,Na,Wa)}z1(Ba,Wa){this.ym.ETa();this.ePf(Ba,Wa)}ePf(Ba,Wa,Na=null){var {RtcUtils:ta}=a(751);if(c.ULS.vga(500,100))for(var V in Wa);delete Wa[this._clientId];if(!J.a.isEmpty(Wa)){for(var ia in Wa)V=ia,Wa[V]=ta.deserialize(Wa[ia],"Presence",V,!1,this.Bob);ta=new d.a;ia=(new Date).getTime();for(let X in Wa){V=Wa[X];let la=X,sa;Na?(sa=Na[la],sa.Presence=V):sa=Object.assign(new S,{Presence:V,TimeStamp:ia});ta.ia(la,sa)}this.Eh.v_f(Ba,ta);switch(Ba){case 0:this.Ske||(c.ULS.sendTraceTag(4539734,
500,50,"Raising first presence update notification for [{0}]",this.Ym),this.Ske=!0,h.AFrameworkApplication.Bf&&h.AFrameworkApplication.Bf.PTi());this.Eh.e_f(Wa,[]);break;default:this.Eh.jpj(Ba,Wa)}}}X7i(Ba,Wa){this.kKd(Wa.W8c)}kKd(Ba){this.ym.ETa();if(c.ULS.vga(500,100))for(let Wa=0;Wa<Ba.length;++Wa);Ba.length&&(this.Eh.Ipj(Ba),this.Eh.ipj(Ba),this.Eh.e_f({},Ba))}$7i(Ba,Wa){this.ifa(Wa.type,Wa.y$)}ifa(Ba,Wa=null){this.Re.zUj&&0===Ba&&c.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");
if(0===Ba&&this.vWc&&0<this.vWc.length){var Na=Object.assign(new Z.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.vWc,vetoPillar:"RealTimeCoauth"});(Na=I.a.getInstance(Na))&&Na.logKpiUsage(this.SJg)}this.Re.AUj&&13===Ba&&c.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",Wa||"<none>"));this.ym.ETa();5===Ba?(Wa=(Ba=this.Ngj(Wa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",
Ba.reason,Ba.reconnectDelay):"Received client reconnection request from the server without params.",c.ULS.sendTraceTag(18637071,500,50,Wa),this.Eh.syc(Ba)):(Wa=a(751).RtcUtils.deserialize(Wa,String.format("UpdateNotification-{0}",aa[Ba]),null,!1,this.Bob),this.Eh.Hpj(Ba,Wa))}Ngj(Ba){try{if(!Ba||""===Ba)return null;const Wa=JSON.parse(Ba);return new Q(Wa[pa.a.oVd],Wa[pa.a.wFj],Wa[pa.a.yFj],Wa[pa.a.EWd])}catch(Wa){return c.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Wa.message),
null}}dog(Ba,Wa){return this.Eqb.ggi(this.hgi(Ba,Wa))}hgi(Ba,Wa){return Ba+","+Wa}static N2h(){var Ba=new Map;Ba.set("SkipAria","True");Ba=Object.assign(new fa.a,{extendedProperties:Ba});return Object.assign(new ya.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:Ba,blockFutureEmissionDurationInMs:3E5})}}Object(u.a)(Aa,"RtcMessageHandler",D,[]);var ja=a(105);class za{constructor(Ba,Wa=""){this.xmb=this.Dqb=0;this.fTc=!1;this.v0a=this.w2b=null;this.RZa=!1;this.Dqe=Ba;this.eog=
Wa;this.setTimeout=za.ddd;this.qIa=this.Dqb=this.xmb=0}vQd(){0<this.qIa&&0<this.xmb&&c.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.eog,this.xmb,this.qIa);0<this.qIa&&0<this.Dqb&&c.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.eog,this.Dqb,this.qIa)}get x$a(){return this.fTc}SDc(Ba,Wa){this.Dqb++;this.lvb(!0);this.fTc=!0;this.w2b=Ba;this.v0a=Wa}lvb(Ba){this.fTc=!1;this.v0a&&Ba&&(this.xmb++,this.v0a.UEd());
this.v0a=this.w2b=null}static ddd(Ba,Wa){return window.setTimeout(Ba,Wa)}}Object(u.a)(za,"ThrottlerBase",null,[]);class ra extends za{constructor(Ba,Wa=""){super(Ba,Wa);this.Obb=this.nEa=0;this.$a=new ja.a;this.QZa=!1;this.P_b=this.CXb=this.qXb=this.f_c=0;this.B2b=[];this.clearTimeout=ra.Scd}add(Ba){this.RZa||this.init(ra.oSe,ra.gSe);this.qIa++;const Wa=new Y;this.x$a?this.SDc(Ba,Wa):this.P_b<this.Obb?this.yQb(Ba,Wa):(this.SDc(Ba,Wa),this.QZa=!1);return Wa}yQb(Ba,Wa){Ba=this.Dqe(Ba);const Na=this.setTimeout(Object(b.a)(this,
this.f9i,"onMessageWaitTimeExpired"),this.nEa);++this.P_b;Array.add(this.B2b,Na);const ta=this.qXb;Ba.cvc(V=>{Wa.JIb(V)});Ba.bvc(V=>{this.qXb===ta&&(this.e9i(ta,Na),Wa.OAa(V))})}e9i(Ba,Wa){this.qXb===Ba&&(--this.P_b,this.clearTimeout(Wa),Array.remove(this.B2b,Wa),this.x$a&&this.jKj())}jKj(){this.x$a&&!this.QZa&&(this.f_c=this.setTimeout(Object(b.a)(this,this.kKj,"sendThrottledMessageFromTimer"),0),this.QZa=!0)}kKj(){this.QZa=!1;if(this.x$a){const Ba=this.w2b,Wa=this.v0a;this.lvb(!1);this.yQb(Ba,Wa)}}f9i(){++this.CXb;
this.CXb>Math.floor(this.Obb/2)&&(this.CXb=-1E9,this.$a.raiseEvent("TMUDM"))}S4b(Ba){this.$a.addHandler("TMUDM",Ba)}reset(){this.qIa=this.Dqb=this.xmb=this.CXb=0;++this.qXb;for(const Ba of this.B2b)this.clearTimeout(Ba);this.P_b=0;this.B2b=[];this.lvb(!0);this.QZa&&(this.clearTimeout(this.f_c),this.f_c=0,this.QZa=!1)}init(Ba,Wa){this.RZa||(this.nEa=Ba,this.Obb=Wa,this.RZa=!0)}static createInstance(Ba,Wa=""){return new ra(Ba,Wa)}static Scd(Ba){window.clearTimeout(Ba)}}ra.oSe=15E3;ra.gSe=5;Object(u.a)(ra,
"MaxOutstandingThrottler",za,[955,954]);class fb extends za{constructor(Ba,Wa=""){super(Ba,Wa);this.Vbb=0;this.cob=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(Ba){this.RZa||(this.Vbb=Ba,this.RZa=!0)}add(Ba){this.RZa||this.init(fb.WRe);this.qIa++;const Wa=this.currentTime(),Na=new Y;this.cob>Wa&&(this.cob=Wa);this.x$a?(this.lvb(!0),this.SDc(Ba,Na)):this.cob+this.Vbb<=Wa?this.yQb(Ba,Na):(this.SDc(Ba,Na),this.setTimeout(Object(b.a)(this,this.iKj,"sendThrottledMessage"),this.cob+
this.Vbb-Wa));return Na}iKj(){if(this.x$a){const Ba=this.w2b,Wa=this.v0a;this.lvb(!1);this.yQb(Ba,Wa)}}yQb(Ba,Wa){this.cob=this.currentTime();Ba=this.Dqe(Ba);Ba.cvc(Na=>{Wa.JIb(Na)});Ba.bvc(Na=>{Wa.OAa(Na)})}static createInstance(Ba,Wa=""){return new fb(Ba,Wa)}}fb.WRe=200;Object(u.a)(fb,"MaxRateThrottler",za,[953,954]);class Ua{vPe(Ba,Wa=""){return ra.createInstance(Ba,Wa)}$oh(Ba,Wa=""){return fb.createInstance(Ba,Wa)}}Object(u.a)(Ua,"ThrottlerFactory",null,[937]);var Ca=a(1025);class Ia{constructor(Ba){this.Re=
null;this.Ay=!1;this.$a=new ja.a;this.hVc=new d.a;this.gVc=new d.a;this.g_c=Ba;this.tZa=this.g_c.vPe(Wa=>Wa.send(),"GlobalMaxOustandingThrottler");this.tZa.S4b(()=>{this.$a.raiseEvent("TMUDM")})}init(Ba){this.Ay||(this.Re=Ba,this.tZa.init(this.Re.nEa,this.Re.Pii),this.Ay=!0)}ggi(Ba){this.Ay||this.init(new Ca.a(fb.WRe,ra.oSe,ra.gSe,Ia.NUi));if(!({value:Wa}=this.hVc.nd(Ba)).returnValue){if(!({value:Wa}=this.gVc.nd(Ba)).returnValue){var Wa="MaxOutstandingThrottler-"+Ba;Wa=this.g_c.vPe(Object(b.a)(this.tZa,
this.tZa.add,"add"),Wa);Wa.init(this.Re.nEa,this.Re.MUi);Wa.S4b(()=>{this.$a.raiseEvent("TMUDM")});this.gVc.add(Ba,Wa)}const Na="MaxRateThrottler-"+Ba;Wa=this.g_c.$oh(Object(b.a)(Wa,Wa.add,"add"),Na);Wa.init(this.Re.FVi);this.hVc.add(Ba,Wa)}return Wa}reset(){for(let Ba of this.hVc)Ba.value.vQd();for(let Ba of this.gVc)Ba.value.vQd(),Ba.value.reset();this.tZa.vQd();this.tZa.reset()}S4b(Ba){this.$a.addHandler("TMUDM",Ba)}}Ia.NUi=1E3;Object(u.a)(Ia,"ThrottlerManager",null,[936]);var oa;(function(Ba){Ba[Ba.unspecified=
0]="unspecified";Ba[Ba.word=1]="word";Ba[Ba.excel=2]="excel";Ba[Ba.powerPoint=3]="powerPoint";Ba[Ba.test=4]="test";Ba[Ba.wacFrontEnd=5]="wacFrontEnd";Ba[Ba.oneNote=6]="oneNote";Ba[Ba.visio=7]="visio";Ba[Ba.officeMobile=8]="officeMobile";Ba[Ba.cosmosDBChangefeed=9]="cosmosDBChangefeed";Ba[Ba.last=10]="last"})(oa||(oa={}));Object(u.b)("RtcClientAppName",oa);const Da=(Ba,Wa,Na,ta,V,ia,X,la,sa=null,Va=null,nb=null,ha=null)=>{const jb=O.createInstance(h.AFrameworkApplication.fa),Fb=h.AFrameworkApplication.buildVersion?
h.AFrameworkApplication.buildVersion:"1.0",Rb=bb(Ba,Wa,X,Fb),mb=jb.Veh?a(1371).RealtimeChannelMetrics.createInstance(Rb):new z;var sb=r.a.create(V);jb.rtcJsClientFrequentlyLogsMetrics&&sb.x1j(jb.BFj);var Ya="";Ya=sa&&""!==sa?sa:"/rtc2/";sb.b4e=k.a.vL(Ya);const Ma=Ya+"signalr";sa=Ya+"findsession";const xb=G.fqi;Ya=new Ua;nb=nb||M.a.getInstance();c.ULS.shipAssertTag(556867617,500,jb.s9f<=a(845).RealtimeChannel.yDf,"Client attempting to override max payload size beyond absolute limit");const qb=Math.min(jb.s9f,
a(845).RealtimeChannel.yDf);sb.xDf=qb;sb=new Aa(jb,new Ia(Ya),Ba,Rb,Ra=>new F(Ra.createHubProxy(xb)),la,nb,mb,sb,qb);Va||(Va=a(1235).FindSessionStrategy.createInstance(Wa,V,sa,la,Fb,X,Ba,Rb,nb,ia,ta,ha));Va.kfc=jb.kfc;Wa=new y(Rb);Na=Na?Na.split(","):null;Ba=new (a(845).RealtimeChannel)(Ba,Na,Rb,la,()=>$.hubConnection(Ma),Va,sb,Wa,nb,mb,jb,V);Ba.init();return Ba},bb=(Ba,Wa,Na)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Ba,Za(oa[Na]),Za("browser"),Wa),Za=Ba=>Ba?Ba.charAt(0).toLocaleUpperCase()+
Ba.substring(1,Ba.length):Ba;a.d(C,"RealtimeChannel",function(){return Xa});class Xa{constructor(Ba,Wa,Na,ta,V,ia,X,la,sa,Va,nb,ha){this.AZc=!1;this.v3=null;this.YH=new d.a;this.Mlb=1;this.wQ=null;this.hv=!1;this.aUc=(new Date(0)).getTime();this.ure=0;this._clientId=Ba;this.H2b=Wa;this.NM=0;this.gi=ta;this.EOc=la;this.qNg=X;this.lCg=sa;this.NEg=V;this.fsa=ia;this.Ym=Na;this.ym=Va;this.Re=nb;this.lh=ha;this.jOg=1>100*Math.random()}get sRa(){return this.fsa.sRa}set sRa(Ba){this.fsa.sRa=Ba}get bDa(){return this.qNg}get Eh(){return this.lCg}init(){this.Eh.zYg(Object(b.a)(this,
this.Tbc,"disconnectAndCreateNewConnection"));this.Eh.nZg(Object(b.a)(this,this.rdj,"onUpdatePersistentStateRequestReceivedInternal"));this.Eh.mZg(Object(b.a)(this,this.qdj,"onUpdatePersistentStateClearedRequestReceived"));this.lh.G1c(this.ym);h.AFrameworkApplication.zib(()=>{this.ym.wQd();r.a.instance&&r.a.instance.dDd()});this.EPe();this.Vxh();this.Eh.TYg(Object(b.a)(this,this.Ddk,"updateConnectionQueryString"))}Vxh(){try{const Na=$.signalR;if(!Na)throw Error.invalidOperation("Failed to retrieve Signalr object");
const ta=Na.version;if(!ta)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===ta){var Ba=Na.transports;if(!Ba)throw Error.invalidOperation("Failed to retrieve transports object");var Wa=Ba.longPolling;if(!Wa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Wa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Wa.supportsKeepAlive=this.Brh()}}catch(Na){c.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Na.message)}}Brh(){return()=>!1}EPe(){const Ba=++this.Mlb;this.aUc=(new Date(0)).getTime();this.wQ=this.NEg();this.Eh.qpj(this.wQ);this.wQ.stateChanged(Wa=>{this.C2i(Wa,Ba)});this.wQ.connectionSlow(Object(b.a)(this,this.ccj,"onSlowConnection"));this.wQ.error(Object(b.a)(this,this.Rbj,"onSignalRError"));this.wQ.log=Object(b.a)(this,this.Sbj,"onSignalRLog")}skb(Ba,Wa){return Ba!==this.Mlb?(c.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
Wa),!1):!0}connect(){2!==this.NM&&1!==this.NM&&(c.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Ym),this.EOc.A2i(),t.a.instance.y1j(),this.wX(1,this.NM),this.zkg())}zkg(){const Ba=this.Mlb;this.AZc=!1;this.ym.a1f();this.fsa.odi(Object(b.a)(this,this.Aih,"connectSignalrConnection"),Object(b.a)(this,this.oLf,"onFailureToConnect"),Object(b.a)(this.bDa,this.bDa.Tsi,"initThrottlerManager"),Object(b.a)(this,this.skb,"verifyConnectionToken"),Ba)}oLf(Ba=null){this.ym.c1f();
let Wa=null;!Ba||"documentsessiondeleted"!==(Wa=Ba.toLowerCase())&&"documentsessionexpired"!==Wa?this.Tbc():(c.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Ym,Ba),this.disconnect())}Tbc(Ba,Wa=null){c.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.v3);Ba=(Ba=2===this.NM||1===this.NM)&&!this.bDa.FMa;let Na=!0,ta=0;Wa&&Object.getType(Wa)!==Object.getType(Sys.EventArgs.Empty)&&
Wa.kTd&&""!==Wa.kTd&&(Ba=!0,this.fsa.SPj(Wa.kTd),Na=Wa.EWd,ta=Wa.reconnectDelay);Ba&&this.wX(1,this.NM);++this.Mlb;this.bDa.gx();this.x2j(Na);this.fsa.Vyh();this.EPe();Ba&&window.setTimeout(Object(b.a)(this,this.zkg,"startConnecting"),Math.min(ta,3E4))}Ddk(){let Ba=null;const Wa=({correlationId:Ba}=this.fsa.t$e()).returnValue;this.wQ.qs=Wa;c.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Ym,Ba)}Aih(Ba){this.aUc=(new Date).getTime();
let Wa=null;this.wQ.qs=({correlationId:Wa}=this.fsa.t$e()).returnValue;this.Re.R_g&&(this.wQ.url=Ba,r.a.instance&&(r.a.instance.IMe=k.a.vL(Ba)));let Na=null;this.gi&&(Na=this.gi.qd("WebServiceCall","ConnectToServer"));c.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Ym);Ba={};this.H2b&&(Ba.transport=1===this.H2b.length?this.H2b[0]:this.H2b);Ba.pingInterval=null;t.a.instance.DNb(1,0);Ba.waitForPageLoad=!1;this.wQ.start(Ba,null).done(ta=>{this.ym.d1f();t.a.instance.DNb(1,
1,!0);c.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",ta.id,Wa)}).fail(ta=>{c.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.fsa.VD,Wa,this.Ym);this.oLf();this.ym.b1f(ta);t.a.instance.DNb(1,1,!1);this.Eh.k_f(0,{["CorrelationId"]:Wa,["ErrorDetails"]:ta,["ConnectionState"]:e.a[this.NM]})}).always(()=>{Na&&Na.stop();r.a.instance&&(r.a.instance.WPc=!1)})}disconnect(){0===
this.NM?c.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Ym):(this.ym.g1f(),r.a.instance&&(r.a.instance.WPc=!0),c.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Ym),this.bDa.FMa=!0,this.EOc.D3i(),this.wX(0,this.NM),this.Tbc(),this.bDa.FMa=!1)}x2j(Ba){const Wa=this.Z$g(),Na=this.wQ,ta=this.v3,V=()=>{if(this.AZc)c.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");
else try{this.AZc=!0,Na.stop(!0,Ba)}catch(ia){c.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",ia.message)}};0<Wa?(c.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",ta,Wa),window.setTimeout(V,Wa)):(c.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",ta),V())}Z$g(){let Ba=0;0===this.wQ.state&&(Ba=this.aUc+Xa.Ekk-(new Date).getTime(),0>Ba&&(Ba=0));return Ba}get connectionState(){return this.NM}G4(Ba){this.Eh.G4(Ba)}t9(Ba){this.Eh.t9(Ba)}obg(Ba){this.BQb(0,
Ba)}BQb(Ba,Wa){const Na=new f.a;this.Eh.n_f(Ba,Wa,Na);return Na.task}q1a(Ba){this.Eh.q1a(Ba)}ZTa(Ba){this.Eh.ZTa(Ba)}J4b(Ba){this.Eh.J4b(Ba)}gAc(Ba){this.Eh.gAc(Ba)}VBb(Ba){return this.qhi(Ba)}xgc(){return this.mNa(0)}mNa(Ba){const Wa={};for(let Na of this.YH)Na.value.Fb(Ba)&&(Wa[Na.key]=Na.value.ma(Ba).data);return Wa}qhi(Ba){return this.YH.Fb(Ba)&&this.YH.ma(Ba).Fb(0)?this.YH.ma(Ba).ma(0).data:null}rdj(Ba,Wa){for(let Na of Wa.ehk)this.YH.Fb(Na.key)||this.YH.ia(Na.key,new B.a),Ba=Na.value,this.YH.ma(Na.key).ia(Wa.type,
new A(Ba.Presence,new Date(Ba.TimeStamp))),Na.key===this._clientId&&0===Wa.type&&this.Eh.apj(Ba.Presence)}qdj(Ba,Wa){for(const Na of Wa.W8c)this.YH.remove(Na)}k_h(){const Ba=new B.a;if(!this.YH.Fb(this._clientId))return Ba;for(let Wa of this.YH.ma(this._clientId))Ba.ia(Wa.key,Wa.value.data);return Ba}P9(Ba,Wa=null,Na=!1){const ta=new f.a;this.Eh.uPd(Ba,Wa,Na,ta);return ta.task}t1a(Ba){this.Eh.t1a(Ba)}MOb(Ba){this.Eh.MOb(Ba)}wma(Ba){let Wa,Na;return({value:Wa}=this.YH.nd(Ba)).returnValue&&({value:Na}=
Wa.nd(0)).returnValue?new l(this.uhi(Na),Na.timeStamp):null}q_h(){const Ba={};for(let Wa of this.YH)Wa.value.nd(0).returnValue&&(Ba[Wa.key]=this.wma(Wa.key));return Ba}Njb(Ba){const Wa=new f.a;this.Eh.Gpj(Ba,Wa);return Wa.task}get clientId(){return this._clientId}get JZj(){return this.jOg}dispose(){this.hv||(this.bDa.gx(),this.lh.vwj(this.ym),this.ym.wQd(),r.a.instance&&r.a.instance.dDd(),this.hv=!0)}C2i(Ba,Wa){this.skb(Wa,"StateChangedSignalR")&&this.wX(this.xNe(Ba.newState),this.xNe(Ba.oldState))}wX(Ba,
Wa){if((1!==this.NM||0!==Wa||1!==Ba)&&this.NM!==Wa){var Na=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.NM,Wa,Ba]));c.ULS.sendTraceTag(3290053,500,10,Na)}if(this.NM!==Ba){switch(Ba){case 2:r.a.instance&&r.a.instance.STi();this.v3=this.wQ.id;c.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.v3,this.Ym);this.SRi(this.wQ);c.ULS.sendTraceTag(4298369,500,50,
"Retrieving complete session state");Na=null;this.gi&&(Na=this.gi.qd("WebServiceCall","Receive First Presence"));const ta=this.Mlb;this.Eh.ppj(Object(b.a)(this,this.skb,"verifyConnectionToken"),ta,this.EOc,Object(b.a)(this,this.w8c,"clearExistingPersistentState"),this.k_h(),Na);this.Re.rtcClientMessageTelemetryEnabled&&w.kod(this.Eh,this.Re,100*Math.random()<=this.Re.xFj).start();break;case 1:2===Wa&&c.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",
this.v3);break;case 0:if(w.instance&&w.instance.stop(),this.bDa.FMa)c.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.v3);else{1===Wa&&(c.ULS.sendTraceTag(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.v3),this.ym.h1f());2===Wa&&c.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",
this.v3);this.Tbc();return}}this.NM=Ba;this.Eh.yoj(Ba,Wa)}}SRi(Ba){if(Ba&&Ba.transport&&Ba.transport.name){Ba=Ba.transport.name;var Wa=Ba.toLowerCase();"websockets"===Wa?c.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Ba,this.Ym):"serversentevents"===Wa?c.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",Ba,this.Ym):"foreverframe"===Wa?c.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Ba,this.Ym):"longpolling"===Wa?c.ULS.sendTraceTag(4290754,500,
50,"Transport name - {0} for [{1}]",Ba,this.Ym):"mocktransport"!==Wa&&c.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",Ba)}else c.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}ccj(){if(this.Re.r9f){const Ba=k.a.mz(this.sRa,"mid");c.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.v3,Ba)}else c.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.v3)}Rbj(){c.ULS.sendTraceTag(3249545,
600,15,"SignalR ERROR for connection [{0}];",this.v3)}Sbj(Ba){Ba=a(751).RtcUtils.ycb(Ba);if(this.Re.r9f&&Ba.startsWith("Keep alive timed out.")){const Wa=k.a.mz(this.sRa,"mid");c.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",Ba,Wa)}else this.JZj&&2E3>this.ure&&!Ba.startsWith("Invok")&&!Ba.startsWith("Trigger")&&(c.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",Ba),this.ure++)}w8c(){let Ba;const Wa=[];({value:Ba}=this.YH.nd(this._clientId)).returnValue&&this.YH.remove(this._clientId);
for(let Na of this.YH.keys)Array.add(Wa,Na);for(const Na of Wa)this.YH.remove(Na);Ba&&this.YH.ia(this._clientId,Ba);this.Eh.Voj(Wa)}xNe(Ba){switch(Ba){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",Ba,"Unknown SignalR state");}}uhi(Ba){return Ba&&Ba.timeStamp?(new Date).getTime()-Ba.timeStamp.getTime()>(this.Re.A4g?6E4:this.Re.z4g)?2:1:1}static createInstance(Ba,Wa,Na,ta,V,ia,X,la=null,sa=null,Va=null,nb=null,ha=null,jb=null){return Da(Ba,
Wa,Na,jb,ta,V,ia,X,la,sa,Va,ha,nb)}}Xa.yDf=31E3;Xa.$Ed=8E3;Xa.Ekk=15E3;Object(u.a)(Xa,"RealtimeChannel",null,[352,924])},913:function(u,C,a){a.d(C,"a",function(){return c});u=a(0);class c{constructor(){this.$re=!1;this.cXc=null;this.fde=0;this.kQc=this.JQe();this.pXb=this.JQe();this.YFa=this.pZa=0;this.Jx=()=>new Date}get w3j(){return this.$re}JQe(){const b=Array(6);for(let f=0;f<b.length;f++)b[f]=0;return b}O5h(){return this.kQc.toString()}D2h(){return this.pXb.toString()}y1j(){this.cXc=this.Jx()}DNb(b,
f,e=!1){this.w3j||(e&&(this.$re=!0),e=this.Jx(),0===b&&5<this.pZa||1===b&&5<this.YFa||(this.fde<b?(1===this.pZa%2&&(this.kQc[this.pZa]=-1,this.pZa++),this.fde=b,1===f&&(this.pXb[this.YFa]=-1,this.YFa++),this.pXb[this.YFa]=this.s2d(e),this.YFa++):0===b?(this.kQc[this.pZa]=this.s2d(e),this.pZa++):(this.pXb[this.YFa]=this.s2d(e),this.YFa++)))}s2d(b){const f=b.getTime()-this.cXc.getTime();this.cXc=b;return f}static get instance(){c.Oa||(c.Oa=new c);return c.Oa}static set instance(b){c.Oa=b}}c.Oa=null;
Object(u.a)(c,"LatencyMetrics",null,[])},986:function(u,C,a){u=a(0);var c=a(15),b=a(88),f=a(115),e;(function(k){k[k.SendNotification=0]="SendNotification";k[k.SendPersistentState=1]="SendPersistentState";k[k.FindSession=2]="FindSession";k[k.Last=3]="Last"})(e||(e={}));Object(u.b)("ApiType",e);var d;(function(k){k[k.AttemptCount=0]="AttemptCount";k[k.SuccessCount=1]="SuccessCount";k[k.DropCount=2]="DropCount";k[k.FailedCount=3]="FailedCount";k[k.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";
k[k.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";k[k.ThrottledCount=6]="ThrottledCount";k[k.Last=7]="Last"})(d||(d={}));Object(u.b)("EventCountType",d);var h=a(913);a.d(C,"a",function(){return l});class l{constructor(k){this.IMe=this.b4e=null;this.xDf=this.d6e=0;this.ym=null;this.Yke=this.TUc=0;this.lh=k;this.rui();this.WPc=this.Dfe=this.pVc=!1;this.NUc=0}get ZPh(){return this.WPc}x1j(k){this.Yke=k;window.setInterval(Object(b.a)(this,this.dDd,"logMetricsBatchAndReset"),k);this.TUc=(new Date).getTime()}rz(k,
n){this.qTj(k)&&!this.Dfe||this.ZPh||!window.navigator.onLine||this.lh.B$a||(this.ym[k][n]++,this.pVc=!0)}rui(){this.ym=Array(3);for(let k=0;3>k;k++){this.ym[k]=Array(7);for(let n=0;7>n;n++)this.ym[k][n]=0}}U7g(){const k={};for(let n=0;3>n;n++)for(let v=0;7>v;v++)this.tJi(n,v)&&(k[e[n]+d[v]]=this.ym[n][v]);k.FSDomain=this.b4e;k.ConnectionDomain=this.IMe;k.FSRetryInterval=this.d6e;k.MaxPayloadSize=this.xDf;k.LogNumber=this.NUc;1===this.NUc&&(k.FSLatencies=h.a.instance.O5h(),k.ConLatencies=h.a.instance.D2h());
return k}tJi(k,n){return 2===k&&3!==n&&0!==n?!1:!0}qTj(k){return 2===k?!1:!0}dDd(){if(this.pVc){this.NUc++;if((new Date).getTime()-this.TUc<5E3+this.Yke){var k=f.a.toJSON(this.U7g());c.ULS.sendTraceTag(50644352,500,15,k)}this.TUc=(new Date).getTime();for(k=0;3>k;k++)for(let n=0;7>n;n++)this.ym[k][n]=0;this.pVc=!1}}STi(){this.Dfe=!0}static get instance(){return l.Oa}static create(k){l.instance||(l.Oa=new l(k));return l.instance}}l.Oa=null;Object(u.a)(l,"FrequentLoggingMetrics",null,[932])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSOpt.cl.js.map/a8143dba40f1417032969483fc807036/EwaDSOpt.cl.js.map