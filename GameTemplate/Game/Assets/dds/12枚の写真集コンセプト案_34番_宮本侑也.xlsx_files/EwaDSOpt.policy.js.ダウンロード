'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[53],{1508:function(u,C,a){a.r(C);var c=a(0),b=a(15),f=a(88),e=a(892),d=a(199),h=a(563);class l{constructor(Zb,Wc,md=null){this.id=Zb.Id;md||(md="");this.Frj=md;this.sensitivityLabel=Zb}}Object(c.a)(l,"AutoPolicyLabelData",null,[]);class k{constructor(Zb,Wc){this.oN=Zb;this.displayName=Wc}}Object(c.a)(k,"PolicyLabelRequestState",null,[]);class n{constructor(){this.kWd=this.jHd=""}}Object(c.a)(n,"PolicyStrings",null,
[]);var v=a(157),x=a(6),w=a(165),r=a(14),t=a(50),A=a(34);class y{static get QAd(){return y.MKi}}y.MKi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(y,"JustificationDialogHtml",null,[]);class z extends v.a{constructor(Zb,Wc){super(!1,!1,z.ew);this.gta=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.G0b=null;this.E0b=!1;this.q1b=Zb;this.nF=Wc;this.Eg=this.v7g();this.rc=1;this.Te=z.id;this.Hc(1,CommonUIStrings.l_DialogChange);this.tM(1,!1);this.u2(0)}l0d(){if(z.ew)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(f.a)(this,this.V_f,"reactJustificationDialogHandler"),this.gdf(this.E0b));else{const Zb={};for(let Wc=0;Wc<this.gta.length;Wc++)Zb[z.fPd+Wc]=!1;Zb[z.LTb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(f.a)(this,this.LKi,"justificationDialogHandler"),Zb);this.Atj();t.a.addHandler($get(z.LTb),r.a.input,Object(f.a)(this,this.v5j,"textAreaHandler"))}}validate(){if(z.ew)return this.Ovg(this.G0b);const Zb=$get(z.LTb);return Zb.disabled?!0:this.Ovg(Zb.value)}Ovg(Zb){const Wc=
2>Zb.length,md=500<Zb.length,Nd=RegExp("[{|}|;|\\\\]").test(Zb);Zb=""===A.a.ozc(Zb);return!Wc&&!md&&!Nd&&!Zb}LKi(Zb,Wc){let md="";if(1===Zb)for(let Nd=0;Nd<this.gta.length;Nd++)if(Wc[z.fPd+Nd]){md=Nd===this.gta.length-1?Wc[z.LTb]:this.gta[Nd];break}this.nF(Zb,this.q1b,md)}V_f(Zb){let Wc="";1===Zb&&this.G0b&&(Wc=this.G0b);this.nF(Zb,this.q1b,Wc)}k8i(Zb){this.G0b=Zb;Zb=this.validate();this.E0b!==Zb&&(this.E0b=Zb,this.jXa(CommonUIStrings.l_SensitivityJustificationTitle,Object(f.a)(this,this.V_f,"reactJustificationDialogHandler"),
this.gdf(this.E0b)))}gdf(Zb){return{["id"]:this.Te,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!Zb},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(f.a)(this,this.k8i,"onJustificationUpdated")}}v5j(Zb){Zb.target&&this.tM(1,this.validate())}v7g(){return v.a.$p(z.QAd,x.AFrameworkApplication.lC,w.getImageClass(z.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.gta[0],this.gta[1],this.gta[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}Atj(){const Zb=document.getElementsByName(z.pNi);for(let Wc=0;Wc<Zb.length;Wc++)t.a.addHandler(Zb[Wc],
r.a.focus,Object(f.a)(this,this.zZf,"radioButtonFocusHandler")),t.a.addHandler(Zb[Wc],r.a.click,Object(f.a)(this,this.zZf,"radioButtonFocusHandler"))}zZf(Zb){if(Zb=Zb.target){Zb.checked=!0;var Wc=$get(z.LTb);Zb.id===z.fPd+(this.gta.length-1)?(Wc.disabled=!1,Sys.UI.DomElement.setVisible(Wc,!0),Wc.focus()):(Wc.disabled=!0,Zb.focus());this.tM(1,this.validate())}}static get ew(){return x.AFrameworkApplication.sa.Qa.Qw&&x.AFrameworkApplication.sa.Qa.zyd}}z.QAd=y.QAd;z.pNi="ListRadioBox";z.fPd="radiobox";
z.LTb="txtJustification";z.iconName="Info_32x32x32";z.id="JustificationDialog";Object(c.a)(z,"JustificationDialog",v.a,[]);class E extends v.a{constructor(Zb,Wc,md){super(!1,!1,!0);if(Zb&&md){var Nd={["id"]:"MandatoryLabellingDialog"};this.KFg=md;this.wUc=Wc;if(!x.AFrameworkApplication.fa.ra("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.wUc&&""!==this.wUc)Nd.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.wUc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Wc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Wc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:Zb});Nd.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Wc};Zb={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Nd};Nd.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Nd.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(f.a)(this,this.ITi,"mandatoryLabellingDialogHandler"),Zb)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}ITi(Zb,Wc){1===Zb&&Wc.selectedLabel&&(Zb=Wc.selectedLabel,""!==Zb&&this.KFg(Zb))}}Object(c.a)(E,"MandatoryLabellingDialog",v.a,[]);class G{constructor(){this.Knb=!!x.AFrameworkApplication.sa&&
x.AFrameworkApplication.sa.Qa.Qw}Zoh(Zb,Wc,md){this.Knb&&new E(Zb,Wc,md)}static get instance(){return G.Oa||(G.Oa=new G)}}G.Oa=null;Object(c.a)(G,"MandatoryLabellingDialogFactory",null,[532]);class F{}F.o2j="sbProtectForm14";F.q2j="SBStatusBarMarkAsReadOnly14";F.yMi="Info_16x16x32";F.Xub="QuickSearchCompletedToday_16x16x32";F.IPd="CommonControlCheckboxCheck_16";F.Log="On";F.visible="Visible";F.EUh="ImageIsVisible";F.cF="SourceControlId";F.menuItemId="MenuItemId";F.menu="Menu";F.L3c="AppLockId";F.value=
"Value";F.Fi="LabelText";F.alt="Alt";F.Alf="Image16by16";F.Rma="Image16by16Class";F.n2j="SBProtectForm_16";F.p2j="SBStatusBarMarkAsReadOnly_16";F.icon="Icon";F.iconColor="IconColor";F.customTooltip="CustomTooltip";F.Tqj="MipTagDynamicFillWithOutline_20";F.Uqj="MipTagLockDynamicFillWithOutline_20";F.Sqj="MipTagErrorOutline_20";F.Vqj="MipTagQuestionOutline_20";F.kIc="transparent";F.Nak="UILocation";Object(c.a)(F,"PolicyConstants",null,[]);class O extends v.a{constructor(Zb,Wc,md){super(!1,!1,O.ew);
this.q1b=Zb;this.VZa=Wc;this.nF=md;this.rc=1;this.Te=O.id;this.u2(1);this.u2(0)}J0d(){const Zb={["id"]:"UserDefinedPermissionsDialog"};O.ew&&this.initializeAndShow("Defined Permissions",Object(f.a)(this,this.Ihk,"userDefinedPermissionsDialogHandler"),Zb)}Ihk(Zb){1!==Zb&&this.nF(Zb,this.q1b,"",this.VZa)}static get ew(){return x.AFrameworkApplication.sa.Qa.Qw&&x.AFrameworkApplication.sa.Qa.zyd}}O.id="UserDefinedPermissionsDialog";Object(c.a)(O,"UserDefinedPermissionsDialog",v.a,[]);var M=a(596),P=a(385),
B=a(324),D=a(578),I=a(103),S=a(128),J=a(573),L=a(570),R=a(140),Y=a(435),Q=a(146),W=a(93),Ga=a(172),pa=a(340),aa=a(84),Z=a(111),fa=a(26),ya=a(69),Aa=a(62);class ja{constructor(Zb,Wc,md,Nd){this.Xnb=this.gHa=null;this.yie=this.rTc=this.JTc=this.Nnb=this.Fje=this.hle=this.gPc=!1;this.FYa=this.wha=this.oia=this.gsa=this.VZa=this.Zo=this.b4=this.qf=null;this.cFg=this.aNc=0;this.rfe=this.FTc=this.mNc=this.VWc=null;this.Na=Zb;this.Kf=Wc;this.Ta=md;this.Tg=Nd;this.Cob={};this.eoe={};this.ile={};this.imc=
md.ra("WacApplyManualPolicyLabelIsEnabled");this.Tg.value.Tye(Object(f.a)(this,this.vOd,"processAutoSensitivityLabel"));this.Tg.value.R2c(Object(f.a)(this,this.vOd,"processAutoSensitivityLabel"));this.Tg.value.A4b(Object(f.a)(this,this.pdj,"onUpdateLabelInfo"));x.AFrameworkApplication.sa&&x.AFrameworkApplication.sa.LXg(Object(f.a)(this,this.Jsj,"refreshDocumentPolicyLabelsOnModeChange"));md.ra("SupportsPolicies")&&md.Va("AppliedPolicyId")&&(this.gHa=md.Va("IrmPolicyTitle"),this.Xnb=md.Va("IrmPolicyDescription"));
this.uDg=this.Ta.oe("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.vDg=this.Ta.oe("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get C$a(){return x.AFrameworkApplication.C$a||!!this.FTc&&this.FTc()}vh(){this.Na.xc(fa.a.hLd,Z.a.frame,Object(f.a)(this,this.vcc,"documentLabelPaneHandler"));this.Na.ef(fa.a.Leb,Z.a.frame,Object(f.a)(this,this.Leb,"queryPolicyLabel"),96);this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Na.xc(fa.a.zTf,Z.a.frame,
Object(f.a)(this,this.vcc,"documentLabelPaneHandler")),this.Na.ef(fa.a.jNb,Z.a.frame,Object(f.a)(this,this.jNb,"queryPolicyShortLabel"),96));this.Na.xc(fa.a.SWa,Z.a.frame,Object(f.a)(this,this.SWa,"toggleSensitivity"));this.Na.xc(fa.a.aCa,Z.a.frame,Object(f.a)(this,this.aCa,"populateSensitivityFlyout"));this.Na.xc(fa.a.setSensitivity,Z.a.frame,Object(f.a)(this,this.setSensitivity,"setSensitivity"));this.Na.ef(fa.a.Meb,Z.a.frame,Object(f.a)(this,this.Meb,"querySensitivity"),96);this.Na.xc(fa.a.g9,
Z.a.frame,Object(f.a)(this,this.g9,"querySensitivityToggleButton"));this.Na.xc(fa.a.f9,Z.a.frame,Object(f.a)(this,this.f9,"querySensitivitySubFlyout"));this.brb(fa.a.SWa)||this.Na.Ygb(fa.a.SWa,4);this.brb(fa.a.aCa)||this.Na.Ygb(fa.a.aCa,4);this.brb(fa.a.setSensitivity)||this.Na.Ygb(fa.a.setSensitivity,4);this.brb(fa.a.g9)||this.Na.Ygb(fa.a.g9,4);this.brb(fa.a.f9)||this.Na.Ygb(fa.a.f9,4);this.Kf.updateCommandUI();x.AFrameworkApplication.fa&&R.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&
this.Tg.value.wyj(Object(f.a)(this,this.U1f,"registerActionsHandler"))}U1f(){this.vh()}AUb(){this.Na.$A(fa.a.hLd,Z.a.frame,Object(f.a)(this,this.vcc,"documentLabelPaneHandler"));this.Na.$A(fa.a.Leb,Z.a.frame,Object(f.a)(this,this.Leb,"queryPolicyLabel"));this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this.Na.$A(fa.a.zTf,Z.a.frame,Object(f.a)(this,this.vcc,"documentLabelPaneHandler")),this.Na.$A(fa.a.jNb,Z.a.frame,Object(f.a)(this,this.jNb,"queryPolicyShortLabel")));
this.Na.$A(fa.a.SWa,Z.a.frame,Object(f.a)(this,this.SWa,"toggleSensitivity"));this.Na.$A(fa.a.aCa,Z.a.frame,Object(f.a)(this,this.aCa,"populateSensitivityFlyout"));this.Na.$A(fa.a.setSensitivity,Z.a.frame,Object(f.a)(this,this.setSensitivity,"setSensitivity"));this.Na.$A(fa.a.Meb,Z.a.frame,Object(f.a)(this,this.Meb,"querySensitivity"));this.Na.$A(fa.a.g9,Z.a.frame,Object(f.a)(this,this.g9,"querySensitivityToggleButton"));this.Na.$A(fa.a.f9,Z.a.frame,Object(f.a)(this,this.f9,"querySensitivitySubFlyout"))}SWa(){return 32}J7e(Zb){const Wc=
"mandatoryLabelling_"+Zb.Id;this.ile[Wc]=Zb.Id;return{["type"]:"AppToggleButtonProps",["id"]:Wc,["label"]:Zb.DisplayName,["hideLabel"]:!1,["customTooltip"]:Zb.Tooltip}}xQa(){return this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}Axd(){return this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)}q9h(){const Zb=[],Wc=this.b4;for(let Nd in Wc){var md=Wc[Nd];const kd=this.Zo[Nd];if(kd&&kd.Enabled&&!kd.HasUserDefinedPermissions)if(md.count){const yd=
{["sections"]:[],["shouldAutoOpen"]:!1},lc={["id"]:"mandatoryLabelling_flyoutMenuSection_"+kd.Id,["controls"]:[]};for(let Lc of md)(md=this.Zo[Lc])&&md.Enabled&&!md.HasUserDefinedPermissions&&Array.add(lc.controls,this.J7e(md));Array.add(yd.sections,lc);Array.add(Zb,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+kd.Id,["label"]:kd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:yd})}else Array.add(Zb,this.J7e(kd))}return Zb}aCa(Zb,Wc,md,Nd,kd){if(1===
md||!this.Tg.value.qja(!0))return 32;kd.MenuItems=Object.assign(new J.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(kd.MenuItems.MenuSectionList,this.jd(!this.isReactRibbonEnabled()));this.qf.CustomUrl&&Array.add(kd.MenuItems.MenuSectionList,this.Ooh(this.isReactRibbonEnabled()?this.qf.CustomUrl:A.a.Sf(this.qf.CustomUrl)));this.isReactRibbonEnabled()||(kd.PopulationXML=B.q(kd.MenuItems));return 32}Meb(Zb,Wc,md,Nd,kd){if(1===md||!kd||!this.imc)return 32;this.qf=this.Tg.value.Cn;
if(this.Tg.value.qja(!0)&&(kd[F.visible]=!0,this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",!1)?this.Fje||(S.a("MipLabelsAvailable"),this.Fje=!0):S.a("MipLabelsAvailable"),this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.qf&&this.qf.AreLabelsAvailable&&(Zb=aa.a.instance.qc("Common.ISystemInitiatedFeedback")))){const yd=ja.sh(this.qf.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";
Zb.execute(lc=>{lc.logActivity(yd,null)})}return 32}g9(Zb,Wc,md,Nd,kd){if(1===md||!kd)return 32;let yd,lc;kd[F.Log]=!!(yd=kd[F.menuItemId])&&!!(lc=this.Cob[yd])&&lc===this.qf.AppliedPolicyId;return 32}f9(Zb,Wc,md,Nd,kd){if(1===md||!kd)return 32;let yd,lc,Lc;Zb=!!(yd=kd[F.cF])&&!!(lc=this.Cob[yd])&&!!(Lc=this.b4[lc])&&Lc.contains(this.qf.AppliedPolicyId);kd[F.EUh]=Zb;kd[F.Log]=Zb;return 32}setSensitivity(Zb,Wc,md,Nd,kd){if(1===md||!kd)return 32;Zb=this.Cob[kd[F.cF]];Wc=this.Oak(kd[F.Nak]);md=new ya.a;
md.name="SensitivityPickerLocation";md.int64=Wc;S.a("SensitivityPickerUsage",void 0,void 0,[md]);return this.lqa(Zb,kd,2)}Pmc(){return!!x.AFrameworkApplication.sa&&1===x.AFrameworkApplication.sa.mode}Jsj(){this.rTc&&!this.Pmc()&&(this.rTc=!1,this.Tg.value.Isj())}Kpg(){this.qf.DefaultLabelId&&this.qf.MandatoryLabelingEnforced?this.gPc||this.Pmc()?this.qf.AppliedPolicyId?this.egd(""):(this.Tg.value.xGi(this.Tg.value.AHb)||this.Pmc())&&this.nXe():this.Ocg():this.qf.DefaultLabelId?this.Ocg():this.qf.MandatoryLabelingEnforced&&
(this.qf.AppliedPolicyId?this.egd(""):this.nXe())}gsf(){return this.qf.MandatoryLabelingEnforced?this.qf&&this.qf.AreLabelsAvailable?this.Ta.ra("TestOverrideIsReactDialogEnabled")||this.Kf&&this.Kf.Qa&&this.Kf.Qa.Qw?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),
!1)}nXe(){!this.gsf()||x.AFrameworkApplication.w7||this.hle||(this.hle=x.AFrameworkApplication.w7=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Tg.value.UZf("",1),this.Tg.value.E1c(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,()=>{this.GTi()}))}egd(Zb){this.gsf()&&x.AFrameworkApplication.w7&&(x.AFrameworkApplication.w7=
!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Tg.value.IRd(),this.Tg.value.UZf(Zb,2))}GTi(){G.instance.Zoh(this.q9h(),this.qf.CustomUrl,Object(f.a)(this,this.HTi,"mandatoryLabellingDialogCallback"))}HTi(Zb){this.egd(this.ile[Zb])}UDe(){return this.Ta.ra("CoAuthForProtectedFilesEnabled")&&this.Ta.ra("SupportsOfficeClientCoauthoring")&&this.Ta.ra("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.rfe&&this.C$a}lqa(Zb,Wc,md,Nd=null){this.Tg.value.ypj(md);
let kd=32,yd=!1,lc=!0;const Lc=2===md||8===md||16===md,nd=Zb===this.qf.AppliedPolicyId;if(this.mNc&&this.mNc(Zb,Lc))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",md),this.Kf.updateCommandUI();else if(Wc&&F.L3c in Wc&&this.Tg.value.xOj(Wc[F.L3c]),Zb)if(this.Tg.value.quf()||this.UDe()&&this.JTc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",
md),this.Kf.updateCommandUI(),Lc&&this.o5b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.Ta.ra("HasDocumentEditRights"))if(this.Tg.value.Pah(Zb))if(!this.xQa()&&this.Zo[Zb]&&this.Zo[Zb].HasUserDefinedPermissions&&!nd)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",md),1!==md&&4!==md&&this.A_g();else if(Lc&&this.qf.MandatoryLabelingEnforced&&nd)b.ULS.sendTraceTag(570972054,
306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",md),this.o5b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Lc&&this.Ta.ra("WacLabelingJustificationDialogIsEnabled")&&this.qf.RequiredDowngradeJustification&&(nd||this.Zo[Zb].RequiredDowngradeJustification)&&(this.xQa()?!this.yie&&!Nd:!this.VZa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
md),this.l0d(Zb),kd;if(this.xQa()&&this.Zo[Zb].HasUserDefinedPermissions&&!nd)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",md),this.J0d(Zb,Nd),kd;if(this.UDe()&&!this.rfe())this.aNc<this.uDg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.aNc,md),this.JTc=!0,this.aNc++,Aa.Task.delay(this.vDg).continueWith(()=>{this.JTc=!1;this.lqa(Zb,Wc,md)})):(b.ULS.sendTraceTag(577356771,
306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",md),yd=1!==md,lc=!1,kd=8);else{if(this.aFi(Zb)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",md),1===md||8===md||4===md))return kd;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",md);this.setPolicyLabel(nd?"":Zb,this.xQa()?Nd:this.VZa,"",md);return kd}}else b.ULS.sendTraceTag(42796169,
306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",md),this.Kf.updateCommandUI(),Lc&&this.o5b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",md),this.Kf.updateCommandUI(),Lc&&this.o5b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);
else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",md),this.Kf.updateCommandUI(),yd=Lc,lc=!1,kd=8;this.Tg.value.vPd(0,md,yd,lc);return kd}W1a(Zb,Wc,md=null,Nd=!1){I.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.Ta.ra("SupportsOfficeClientCoauthoring")&&this.Ta.ra("CoAuthForProtectedFilesIsEnabled")?(this.Nnb=!1,(this.qf=this.Tg.value.Cn)&&!this.qf.AppliedPolicyId?this.Nnb=!0:this.qf&&
this.qf.PolicyLabelAssignmentMethod&&(this.Nnb=Ga.e(this.qf.PolicyLabelAssignmentMethod)===Ga.e("standard"))):this.Nnb=Nd;Zb=ja.sh(Zb)?null:this.Zo[Zb];(Wc=ja.sh(Wc)?null:this.Zo[Wc])?this.oia=new l(Wc,!0,md):(this.Tg.value.Ofa(29),this.wha=null);Zb?this.gsa=new l(Zb,!1):this.FYa=null;this.vOd(null,null);return 32}H1g(Zb){""!==this.qf.AppliedPolicyId?this.Tg.value.vPd(14,16,!0):this.lqa(Zb,null,16)}Cdg(){this.Zo={};if(this.qf=this.Tg.value.Cn)for(const Zb of this.qf.SensitivityLabels)this.Zo[Zb.Id]=
Zb}aFi(Zb){if(this.b4&&Zb in this.b4){Zb=this.b4[Zb];for(let Wc of Zb)if((Zb=this.Zo[Wc])&&Zb.Enabled)return!0}return!1}heg(){this.b4={};if(this.qf=this.Tg.value.Cn){for(const Zb of this.qf.SensitivityLabels)Zb.ParentId||(this.b4[Zb.Id]=new d.a);for(const Zb of this.qf.SensitivityLabels){if(this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RemoveDisabledLabelsFromChildLabel",!1)){if(!(Zb.ParentId&&Zb.ParentId in this.b4&&Zb.Enabled))continue}else if(!(Zb.ParentId&&Zb.ParentId in this.b4))continue;
this.b4[Zb.ParentId].add(Zb.Id)}}}lZf(){this.qf=this.Tg.value.Cn;const Zb=this.imc&&this.isReactRibbonEnabled()&&this.Tg.value.qja();ja.CAc(Zb)}ftj(Zb){this.mNc=Zb}Ztj(Zb){this.FTc=Zb}Ocg(){if(this.Ta.ra("WacApplyDefaultPolicyLabelIsEnabled"))if(this.Pmc())this.rTc=!0;else if(!this.gPc)if(this.gPc=!0,this.qf=this.Tg.value.Cn,this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.qf&&this.qf.DefaultLabelId)if(!this.qf.AppliedPolicyId)b.ULS.sendTraceTag(509732190,
306,50,"Default labeling triggered. DefaultLabelType: {0}",this.qf.DefaultLabelType),this.lqa(this.qf.DefaultLabelId,null,1);else if(h.a.Ah().equals(this.qf.DefaultLabelType,"documentLibraryDefault")){const Zb=this.Zo[this.qf.AppliedPolicyId],Wc=this.Zo[this.qf.DefaultLabelId];this.qf.AppliedPolicyId!==this.qf.DefaultLabelId&&h.a.Ah().equals(this.qf.PolicyLabelAssignmentMethod,"standard")&&Zb.Order<Wc.Order&&(b.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",
this.qf.DefaultLabelType),this.lqa(this.qf.DefaultLabelId,null,1))}}else this.qf&&this.qf.DefaultLabelId&&!this.qf.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.qf.DefaultLabelId),this.lqa(this.qf.DefaultLabelId,null,1))}vOd(){if(!this.Tg.value.quf()){var Zb=this.Zo[this.qf.AppliedPolicyId];this.Nnb&&this.gsa&&this.FYa!==this.gsa.id&&(!Zb||Zb.Order<this.gsa.sensitivityLabel.Order)&&(Zb=this.lqa(this.gsa.id,{},4),32!==Zb?b.ULS.sendTraceTag(50868813,
306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Zb):(this.FYa=this.gsa.id,this.wha&&(Zb=this.Zo[this.wha])&&Zb.Order<=this.gsa.sensitivityLabel.Order&&(this.Tg.value.Ofa(29),this.wha=null)));Zb=this.Zo[this.Tg.value.Cn.AppliedPolicyId];if(this.oia&&this.wha!==this.oia.id&&(!Zb||Zb.Order<this.oia.sensitivityLabel.Order)){const Wc=this.oia.id;this.Tg.value.Ofa(29);this.Tg.value.S3b(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,
this.lic(this.oia.sensitivityLabel))+" "+this.oia.Frj,CommonUIStrings.l_PolicyLabelRecommendationButton,()=>{this.lqa(Wc,{},8)});this.wha=this.oia.id}this.oia=this.gsa=null}}setPolicyLabel(Zb,Wc,md,Nd=2){this.xQa()?Wc&&(this.yie=!0):this.VZa=Wc;this.Tg.value.setPolicyLabel(Zb);this.Kf.updateCommandUI();md=new k(Nd,this.lic(this.Zo[Zb]));this.Tg.value.sYd(Zb,this.xQa()?Wc:this.VZa,md)}Pjh(Zb,Wc,md,Nd){1===Zb&&this.setPolicyLabel(Wc,Nd,md)}Ojh(Zb,Wc,md){1===Zb?this.xQa()?this.lqa(Wc,null,2,md):this.setPolicyLabel(Wc===
this.qf.AppliedPolicyId?"":Wc,md,""):this.Kf.updateCommandUI()}l0d(Zb){(new z(Zb,Object(f.a)(this,this.Ojh,"continueToSetPolicyLabelFromJustificationDialog"))).l0d()}J0d(Zb,Wc){(new O(Zb,Wc,Object(f.a)(this,this.Pjh,"continueToSetPolicyLabelFromUDPDialog"))).J0d()}o5b(Zb="",Wc=""){const md=new Q.StandardDialog;md.Iu=x.AFrameworkApplication.qEb;md.rc=0;md.Hc(1,CommonUIStrings.l_DialogClose);md.BT(Zb,Wc,null)}F5g(Zb){1===Zb&&this.Tg.value.Dpj()}A_g(){const Zb=new Q.StandardDialog;Zb.Iu=x.AFrameworkApplication.qEb;
Zb.rc=1;Zb.Hc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Zb.Hc(0,CommonUIStrings.l_DialogClose);Zb.BT(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(f.a)(this,this.F5g,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.Kf&&!!this.Kf.Qa&&this.Kf.Qa.Ik}vp(){return this.Kf&&this.Kf.Qa?this.Kf.Qa.vp:!1}vcc(){return 32}tPj(Zb,Wc,md,Nd){Zb?(Nd[F.value]=Zb,Nd[F.Fi]=Zb,Nd[F.customTooltip]=Wc,this.Kdg(md,x.AFrameworkApplication.protectedFile,
Nd)):(Nd[F.iconColor]=F.kIc,this.qf.MandatoryLabelingEnforced?(Nd[F.value]=Nd[F.Fi]=this.pic().kWd,Nd[F.icon]=F.Sqj):(Nd[F.value]=Nd[F.Fi]=this.pic().jHd,Nd[F.icon]=F.Vqj));Nd[F.visible]=!0}lOj(Zb){let Wc="",md="",Nd="";if(this.qf.AreLabelsAvailable){let kd=null;this.Zo&&(kd=this.Zo[this.qf.AppliedPolicyId]);kd&&(Wc=this.lic(kd),md=kd.Tooltip,x.AFrameworkApplication.protectedFile=this.Tg.value.N$a(kd),Nd=this.Ild(kd));if(!this.Tg.value.qja()&&!kd)return}else{if(!this.gHa)return;Wc=this.gHa;Nd=F.kIc;
md=this.Xnb?this.Xnb:""}this.tPj(Wc,md,Nd,Zb)}Leb(Zb,Wc,md,Nd,kd){if(1===md)return 32;this.qf=this.Tg.value.Cn;if(!this.qf||!kd)return 32;kd[F.value]="";kd[F.Fi]="";kd[F.alt]=null;kd[F.Alf]=null;kd[F.Rma]=null;kd[F.customTooltip]="";kd[F.visible]=!1;kd[F.iconColor]="";kd[F.icon]="";if(this.Axd())this.lOj(kd);else{md=Wc=Zb="";if(!this.qf.AreLabelsAvailable){if(!this.gHa)return 32;Zb=this.gHa;md=F.kIc;this.Xnb&&(Wc=this.Xnb)}else if(this.qf.AppliedPolicyId){Nd=null;for(const yd of this.qf.SensitivityLabels)if(yd.Id.toLowerCase()===
this.qf.AppliedPolicyId.toLowerCase()){Nd=yd;break}Nd&&(Zb=this.lic(Nd),Wc=Nd.Tooltip,x.AFrameworkApplication.protectedFile=this.Tg.value.N$a(Nd),md=this.Ild(Nd))}Zb&&(kd[F.value]=Zb,kd[F.Fi]=Zb,this.vp()?kd[F.customTooltip]=Wc:kd[F.alt]=Wc,this.Kdg(md,x.AFrameworkApplication.protectedFile,kd),kd[F.visible]=!0)}return 32}jNb(Zb,Wc,md,Nd,kd){if(1===md)return 32;this.qf=this.Tg.value.Cn;if(!this.qf||!kd)return 32;kd[F.Fi]="";if(this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",
!1)&&this.qf.HideBarByDefault)return 32;Zb="";if(this.qf.AreLabelsAvailable)if(this.qf.AppliedPolicyId){if(!this.Zo)return 32;(Wc=this.Zo[this.Tg.value.Cn.AppliedPolicyId])&&(Zb=Wc.ParentId&&this.Zo[Wc.ParentId]?this.Zo[Wc.ParentId].DisplayName:Wc.DisplayName)}else Zb=this.qf.MandatoryLabelingEnforced?this.pic().kWd:this.pic().jHd;else{if(!this.gHa)return 32;Zb=this.gHa}kd[F.Fi]=Zb;return 32}lic(Zb){return Zb?this.Zo?Zb.ParentId&&this.Zo[Zb.ParentId]?this.Zo[Zb.ParentId].DisplayName+"\\"+Zb.DisplayName:
Zb.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Zb.DisplayName):""}Kdg(Zb,Wc,md){this.Axd()?(md[F.icon]=this.dff(Wc),md[F.iconColor]=this.eff(Zb)):this.vp()?md[F.icon]=Wc?F.n2j:F.p2j:(md[F.Alf]=x.AFrameworkApplication.lC,md[F.Rma]=Wc?w.getImageClass(F.o2j):w.getImageClass(F.q2j))}Ooh(Zb){const Wc=this.xV("LearnMoreSection",!0);Zb=Object.assign(new P.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Zb,
LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:x.AFrameworkApplication.lC,Image16by16Class:w.getImageClass(F.yMi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Wc.ControlList,Zb);return Wc}BQe(Zb,Wc,md=!1){let Nd;Nd="Toggle_"+Zb.Id;Nd="Sensitivity_"+Nd;const kd=Zb.DisplayName,yd=Zb.Tooltip;var lc=Zb.Id===this.qf.AppliedPolicyId,Lc=md?A.a.Sf(Nd):Nd;this.Axd()?(lc=this.Ild(Zb),Wc=Object.assign(new Y.a,{Id:Lc,ExternalId:Lc,LabelText:md?A.a.Sf(kd):kd,
Command:"2935633379",MenuItemId:Lc,QueryCommand:"991261903",Visible:!0,Alt:md?A.a.Sf(yd):yd,AriaLabel:W.a.a6b,IconColor:this.eff(lc),KeyTip:Wc}),Wc.ExternalImageId=this.dff(this.Tg.value.N$a(Zb))):(Lc=Object.assign(new M.a,{Id:Lc,ExternalId:Lc,LabelText:md?A.a.Sf(kd):kd,Command:"2935633379",MenuItemId:Lc,QueryCommand:"991261903",CheckedImage:x.AFrameworkApplication.lC,Visible:!0,Alt:md?A.a.Sf(yd):yd,IsChecked:lc,AriaLabel:W.a.a6b,KeyTip:Wc}),this.isReactRibbonEnabled()?(Lc.CheckedImageClass=w.getImageClass(F.IPd),
Lc.ExternalImageId=F.IPd):Lc.CheckedImageClass=w.getImageClass(F.Xub),Wc=Lc);Lc=Nd;this.Cob[Lc]=Zb.Id;this.eoe[Zb.Id]=Lc;return Wc}xV(Zb,Wc=!1){return Object.assign(new L.a,{Title:"",Id:Zb,DisplayMode:F.menu,ShowMenuSectionSeparator:Wc,ControlsId:"Ctrl_"+Zb,ControlList:[]})}Prh(Zb,Wc,md){Zb=this.xV(Zb+"Sub");let Nd=1;for(let kd of Wc)(Wc=this.Zo[kd])&&Wc.Enabled&&(Array.add(Zb.ControlList,this.BQe(Wc,Nd.toString(),md)),Nd++);return Zb}jd(Zb=!1){const Wc=this.xV("SensitivitySection");let md=1;const Nd=
this.b4;for(let yd in Nd){const lc=Nd[yd],Lc=this.Zo[yd];if(Lc&&Lc.Enabled){if(lc.count){var kd="Sensitivity_"+Lc.Name;Zb&&A.a.Sf(kd);kd="Label"+this.cFg++;const nd=Object.assign(new D.a,{Id:kd,ExternalId:kd,LabelText:Zb?A.a.Sf(Lc.DisplayName):Lc.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new J.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:W.a.a6b,KeyTip:md.toString(),Alt:Zb?A.a.Sf(Lc.Tooltip):
Lc.Tooltip});this.isReactRibbonEnabled()?nd.ExternalImageId=F.IPd:(nd.Image16by16=x.AFrameworkApplication.lC,nd.Image16by16Class=w.getImageClass(F.Xub));Array.add(nd.Menu.MenuSectionList,this.Prh(kd,lc,Zb));Array.add(Wc.ControlList,nd);this.Cob[nd.Id]=Lc.Id;this.eoe[Lc.Id]=nd.Id}else Array.add(Wc.ControlList,this.BQe(Lc,md.toString(),Zb));md++}}return Wc}brb(Zb){return!!this.Na.w6(Zb)&&!!this.Na.w6(Zb).flags&&!!this.Na.w6(Zb).flags.length}pdj(Zb,Wc){Wc.onSuccess&&this.Zo&&(Zb=this.Zo[this.Tg.value.Cn.AppliedPolicyId])&&
(this.wha&&(Wc=this.Zo[this.wha])&&Wc.Order<=Zb.Order&&(this.Tg.value.Ofa(29),this.wha=null),this.FYa&&this.FYa!==Zb.Id&&(this.Tg.value.Ofa(28),this.FYa=null))}dff(Zb){return Zb?F.Uqj:F.Tqj}eff(Zb){return Zb?Zb:F.kIc}Ild(Zb){if(Zb.Color||!Zb.ParentId)return Zb.Color;const Wc=this.Zo[Zb.ParentId];return Wc?Wc.Color:Zb.Color}Oak(Zb){switch(Zb){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}pic(){this.VWc||(this.VWc=Object.assign(new n,{jHd:HeaderStrings.NoSensitivityLabel,kWd:HeaderStrings.SelectASensitivityLabel}));
return this.VWc}static igk(){x.AFrameworkApplication.fa&&!x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||!R.c()||appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",!0))}static CAc(Zb){x.AFrameworkApplication.fa&&x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Zb?(pa.a.JHd("ribbon","sensitivity"),pa.a.DHd("ribbon","sensitivity")):
pa.a.IHd("ribbon","sensitivity"));R.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Zb))}static sh(Zb){return Zb&&Zb.length?!1:!0}}Object(c.a)(ja,"PolicyActor",null,[499]);var za=a(662),ra=a(105),fb;(function(Zb){Zb[Zb.unknown=0]="unknown";Zb[Zb.boot=1]="boot";Zb[Zb.refresh=2]="refresh";Zb[Zb.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(fb||(fb={}));Object(c.b)("GetPolicyLabelsReason",fb);class Ua extends Sys.EventArgs{constructor(Zb,Wc,md,Nd,kd,yd){super();this.fub=
Zb;this.title=Wc;this.message=md;this.buttonText=Nd;this.Iba=kd;this.aGb=yd}}Object(c.a)(Ua,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class Ca extends Sys.EventArgs{constructor(Zb,Wc,md,Nd,kd){super();this.fub=Zb;this.title=Wc;this.message=md;this.buttonText=Nd;this.Iba=kd}}Object(c.a)(Ca,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ia;(function(Zb){Zb[Zb.none=0]="none";Zb[Zb.reasonDefaultLabel=1]="reasonDefaultLabel";Zb[Zb.reasonManual=2]="reasonManual";
Zb[Zb.reasonAutomatic=4]="reasonAutomatic";Zb[Zb.reasonRecommended=8]="reasonRecommended";Zb[Zb.reasonMandatory=16]="reasonMandatory"})(Ia||(Ia={}));Object(c.b)("ApplyLabelFlags",Ia);class oa extends Sys.EventArgs{constructor(Zb,Wc,md){super();this.QKe=Zb;this.PKe=Wc;this.existingLabelPriority=md}}Object(c.a)(oa,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Da extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Da,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);class bb extends Sys.EventArgs{constructor(){super()}}
Object(c.a)(bb,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Za{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=this.HideBarByDefault=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=
this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl="";this.HideBarByDefault=!1}}Object(c.a)(Za,"GetPolicyLabelsData",null,[]);class Xa extends Sys.EventArgs{constructor(Zb=!1){super();this.onSuccess=Zb}}Object(c.a)(Xa,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class Ba extends Sys.EventArgs{constructor(Zb,Wc){super();this.MAa=Zb;this.RAe=Wc}}Object(c.a)(Ba,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);class Wa extends Sys.EventArgs{constructor(Zb,
Wc,md,Nd){super();this.title=Zb;this.kxc=Wc;this.buttonText=md;this.NIf=Nd}}Object(c.a)(Wa,"PolicyTipEventArgs",Sys.EventArgs,[]);class Na extends Sys.EventArgs{constructor(Zb,Wc){super();this.fub=Zb;this.aGb=Wc}}Object(c.a)(Na,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ta extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ta,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class V extends Sys.EventArgs{constructor(Zb,Wc){super();this.jxc=Zb;this.oN=
Wc}}Object(c.a)(V,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(Zb,Wc,md,Nd=null,kd=null,yd=null,lc=null){super();this.errorType=Zb;this.xig=md;this.title=Nd;this.message=kd;this.buttonText=yd;this.Iba=lc}}Object(c.a)(ia,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class X extends Sys.EventArgs{constructor(){super()}}Object(c.a)(X,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class la extends Sys.EventArgs{constructor(Zb){super();this.KUj=Zb}}
Object(c.a)(la,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var sa=a(112),Va=a(108),nb=a(43),ha=a(82),jb=a(41);class Fb{constructor(Zb,Wc,md,Nd,kd,yd,lc,Lc=null,nd=null,Wd=!1,$d=null,se=null,je=null,Le=null,oe=!1,ue=null,df=null,Se=null,bf=null,Ye=null,gf=null){this.url=Zb;this.zjk=Wc;this.body=md;this.headers=Nd;this.Mhb=kd;this.priority=yd;this.state=lc;this.Ywg=Lc;this.uP=nd;this.vO=Wd;this.koj=$d;this.vKj=se;this.name=je;this.Hdb=Le;this.Rjd=oe;this.JLd=ue;this.yec=df;this.$lc=Se;this.ogb=
bf;this.Jpi=Ye;this.responseType=gf}}Object(c.a)(Fb,"ClientRequest",null,[]);var Rb=a(470),mb=a(234);class sb{static UMj(Zb,Wc){if(!Zb||!Wc||Zb.count!==Wc.count)return!1;for(let md of Zb)if(!Wc.contains(md))return!1;return!0}static toArray(Zb){if(!Zb)return null;const Wc=Array(Zb.count);let md=0;for(let Nd of Zb)Wc[md]=Nd,md++;return Wc}}Object(c.a)(sb,"HashSetUtils",null,[]);var Ya=a(292),Ma=a(184);class xb{constructor(Zb,Wc,md,Nd=0,kd=null){this.dPc=this.Gee=null;this.$ta=this.enb=this.gnb=0;this.p3=
"";this.bIa=this.UMc=this.Xhe=this.asa=this.LUc=null;this.zie=!1;this.CFa=null;this.HRc=0;this.t0b=this.dIa=this.JGa=this.s0b=null;this.$a=new ra.a;this.tRb=this.ABb=this.jw=null;this.wSc=!1;this.AHb=null;this.Ta=Zb;this.lh=Wc;this.gi=md;this.w_b=Nd;this.Cn=new Za;this.doe=this.Ta.Va("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.tQ=kd;this.imc=Zb.ra("WacApplyManualPolicyLabelIsEnabled");this.Cmc=Zb.ra("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Zb.ra("SupportsOfficeClientCoauthoring");
this.uHi=!1;this.mPj=3E4;this.Ce=Va.a.instance;Zb.ra("SupportsPolicies")&&S.a("MipSupportsPolicies");this.Cmc&&this.supportsOfficeClientCoauthoring&&S.a("MipSupportsOfficeClientCoauthoring")}get svd(){return this.wSc}Iye(Zb){this.$a.addHandler("PolicyTipEvent",Zb)}A4b(Zb){this.$a.addHandler("LabelInfoUpdateEvent",Zb)}wyj(Zb){this.$a.removeHandler("LabelInfoUpdateEvent",Zb)}Tye(Zb){this.$a.addHandler("SetPolicyLabelEventKey",Zb)}Fzj(Zb){this.$a.removeHandler("SetPolicyLabelEventKey",Zb)}R2c(Zb){this.$a.addHandler("SetPolicyLabelFailureEventKey",
Zb)}Ezj(Zb){this.$a.removeHandler("SetPolicyLabelFailureEventKey",Zb)}VWg(Zb){this.$a.addHandler("GetPolicyLabelEventKey",Zb)}UWg(Zb){this.$a.addHandler("GetPolicyLabelFailureEventKey",Zb)}SWg(Zb){this.$a.addHandler("GetAutoPolicyLabelEventKey",Zb);this.svd&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.jPd(new Da(0)))}$xj(Zb){this.$a.removeHandler("GetAutoPolicyLabelEventKey",Zb)}rWg(Zb){this.$a.addHandler("CreateAutoCLPSecurityNodesEventKey",
Zb)}Fxj(Zb){this.$a.removeHandler("CreateAutoCLPSecurityNodesEventKey",Zb)}jZg(Zb){this.$a.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Zb)}Szj(Zb){this.$a.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Zb)}kZg(Zb){this.$a.addHandler("UpdateAutoCLPSITNodesEventKey",Zb)}Tzj(Zb){this.$a.removeHandler("UpdateAutoCLPSITNodesEventKey",Zb)}pxe(Zb){this.$a.addHandler("AddAutoPolicyBusinessBarEntryEventKey",Zb)}Xwj(Zb){this.$a.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Zb)}Jye(Zb){this.$a.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
Zb)}ozj(Zb){this.$a.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Zb)}qxe(Zb){this.$a.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Zb)}Zwj(Zb){this.$a.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Zb)}Kye(Zb){this.$a.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Zb)}pzj(Zb){this.$a.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Zb)}GXg(Zb){this.$a.addHandler("MandatoryLabellingAppHandlerEventKey",Zb)}Gyj(Zb){this.$a.removeHandler("MandatoryLabellingAppHandlerEventKey",
Zb)}gZg(Zb){this.$a.addHandler("UDPLabelingAppHandlerEventKey",Zb)}Qzj(Zb){this.$a.removeHandler("UDPLabelingAppHandlerEventKey",Zb)}get Dwd(){if(!this.Gee)return!1;for(const Zb of this.Gee.Qnk())if(!Zb.Capabilities||!Zb.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get LGi(){return!!this.jw}ldh(){return this.Xhe?this.Xhe():!1}btj(Zb){this.UMc=Zb}Jx(){return(new Date).getTime()}jhc(){this.gi&&(this.s0b=this.gi.qd("WebServiceCall","Call Get Policy Endpoint On Server"));var Zb=Ya.a.rka(1,
1);this.Ta.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(Zb=new Fb(this.Q7a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Zb),this.lh.send(Zb).NQd(Object(f.a)(this,this.lKf,"onDataLossPolicySuccessCallback"),Object(f.a)(this,this.kKf,"onDataLossPolicyFailureCallback"))):this.lh.Fn(this.Q7a("datalosspolicy"),1,null,null,!0,2,Object(f.a)(this,this.lKf,"onDataLossPolicySuccessCallback"),Object(f.a)(this,this.kKf,"onDataLossPolicyFailureCallback"),
null);this.gnb++;b.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.doe,this.gnb)}Isj(){this.nmd(this.p3,2,this.asa)}nmd(Zb,Wc=0,md=null,Nd=!1){I.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Dmd(void 0,Wc));this.ABb=this.Jx();const kd=this.Wad(Wc);this.ihc(Zb,kd,md,Nd,Wc);this.lTd(!0)}lKf(Zb){this.VVf();let Wc="";({data:Wc}=this.D5d(Zb)).returnValue&&(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.gnb=0,this.gi&&(this.t0b=this.gi.qd("Task","Parse and Handle Get Policy Response")),this.wgj(Wc),this.t0b&&(this.t0b.stop(),this.t0b=null))}kKf(Zb){this.VVf();this.gnb<=this.w_b?this.jhc():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Zb?Zb.data?Zb.data.mUa:null:null),this.gnb=0)}quf(){return 0<this.$ta}setPolicyLabel(Zb){this.Cn.AppliedPolicyId=Zb}sYd(Zb,Wc,md=null){const Nd=this.toh(md);this.lPj(Zb,Wc,Nd,md)}nRf(Zb){this.dIa&&
(this.dIa.stop(),this.dIa=null);let Wc,md;({Hag:Wc,peg:md}=this.ief(Zb));const Nd=Zb.data.state,kd=Nd?Nd.oN:2;let yd="";({data:yd}=this.D5d(Zb)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",kd),this.$ta=0,this.Qgj(yd,Wc,md,Nd)):this.TUd(kd)}ypj(Zb){I.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Dmd(Zb));this.tRb=this.Jx();b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");
this.$a.raiseEvent("SetPolicyLabelTriggeredEventKey",new X(Zb))}fZi(){this.Cmc&&this.supportsOfficeClientCoauthoring&&this.LGi&&this.jw.P9(12,null,!0)}mRf(Zb){this.dIa&&(this.dIa.stop(),this.dIa=null);let Wc;({Hag:md,peg:Wc}=this.ief(Zb));if(this.$ta<=this.w_b)this.sYd(md,Wc);else{var md=(md=Zb.data.state)?md.oN:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Zb?Zb.data?Zb.data.mUa:null:null,md);this.AHb="WACServerConnectionFailed";
this.$ta=0;this.TUd(md)}}xGi(Zb){if(Zb&&("LabelNotSupported"===Zb||"LabelErrorRetryLater"===Zb||"CoherencyFailure"===Zb||"LabelIdNotFound"===Zb||"LabelDisabled"===Zb))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Zb),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",Zb);return!1}N$a(Zb){return this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPAsProtectedLabelEnabled",!1)?Zb.IsEndpointProtectionEnabled||Zb.HasUserDefinedPermissions:
Zb.IsEndpointProtectionEnabled}Pah(Zb){if(!Zb)return!1;let Wc=null,md=null;for(const Nd of this.Cn.SensitivityLabels)Nd.Id===Zb&&(Wc=Nd),Nd.Id===this.p3&&(md=Nd);if(!Wc)return!1;if(this.Cmc&&this.supportsOfficeClientCoauthoring){if(this.UMc&&this.UMc()||this.Dwd)return!0}else if(x.AFrameworkApplication.lA&&x.AFrameworkApplication.lA.jAb||this.asa&&this.asa())return!0;return this.N$a(Wc)===(!!md&&this.N$a(md))}S3b(Zb,Wc,md,Nd,kd){28===Zb?this.BZf(new Ua(Zb,Wc,md,Nd,kd,!1)):this.BZf(new Ua(Zb,Wc,md,
Nd,kd,!0))}Ofa(Zb){28===Zb?this.h_f(new Na(Zb,!1)):this.h_f(new Na(Zb,!0))}Boj(Zb,Wc,md){b.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.$a.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new oa(Zb,Wc,md))}Epj(Zb){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.$a.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new oa(null,null,Zb))}Fpj(Zb,Wc){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");
this.$a.raiseEvent("UpdateAutoCLPSITNodesEventKey",new oa(Zb,Wc,null))}UZf(Zb,Wc){b.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Wc?"Reading":"Edit")+" switch event.");this.$a.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Ba(Zb,Wc))}E1c(Zb,Wc,md,Nd,kd){37===Zb&&this.roj(new Ca(37,Wc,md,Nd,kd))}IRd(){this.rpj(new ta)}Dpj(){b.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.$a.raiseEvent("UDPLabelingAppHandlerEventKey",new la(!0))}qja(Zb=!1){const Wc=
!!this.Cn&&this.Cn.AreLabelsAvailable&&!!this.Cn.SensitivityLabels&&0<this.Cn.SensitivityLabels.length&&mb.a.any(this.Cn.SensitivityLabels,md=>!!md&&md.Enabled);Wc||Zb||ja.CAc(!1);return Wc}qMf(Zb){this.JGa&&(this.JGa.stop(),this.JGa=null);var Wc="";this.lTd(!1);({data:Wc}=this.D5d(Zb)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.enb=0,Wc=this.Ggj(Wc),Zb=this.Lcf(Zb.data),I.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.tgc(void 0,
Zb,this.ABb)),this.ABb=null,Zb=new Da(Zb),this.Ooj(Zb),this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Wc&&this.oTj()?this.svd?this.Uck():(this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.jwb(),this.jPd(Zb),this.wSc=!0):Wc||this.oyc():!this.svd&&Wc&&this.Ta.ra("WacApplyManualPolicyLabelIsEnabled")&&this.jCe()?(this.jPd(Zb),this.wSc=!0):Wc||this.oyc()):this.oyc()}oTj(){if(!this.Ta.ra("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,
306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.jCe())return!1;if(""===this.p3)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.CFa===this.HRc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");
return!0}jwb(){this.usg();b.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.bIa.count,this.CFa);const Zb=sb.toArray(this.bIa);this.Boj(Zb,Zb,this.CFa)}Uck(){var Zb=this.bIa;this.usg();sb.UMj(Zb,this.bIa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.bIa.count),Zb=sb.toArray(this.bIa),this.Fpj(Zb,Zb));this.zie&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",
this.CFa),this.Epj(this.CFa))}usg(){const Zb=new za.a(h.a.Ah());for(const Wc of this.Cn.SensitivityLabels)if(Wc&&Wc.AutoLabelingSensitiveTypeIds&&0<Wc.AutoLabelingSensitiveTypeIds.length)for(const md of Wc.AutoLabelingSensitiveTypeIds)md&&Zb.add(md);this.bIa=Zb}pMf(Zb){const Wc=this.Lcf(Zb.data);I.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.tgc(void 0,Wc,this.ABb));this.ABb=null;this.JGa&&(this.JGa.stop(),this.JGa=null);if(this.enb<=this.w_b){if(this.Ta.ra("SendHostAttributionInfoForPolicyLabelEnabled")){const md=
Zb.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in md&&md[Ya.a.LVd]&&"HostAttributionInfo.ScenarioTypeParamName"in md&&md[Ya.a.MVd]){Zb.data.request.get_headers();Zb.data.request.get_headers();Zb=this.Wad(Wc);this.ihc(this.p3,Zb,this.asa,void 0,Wc);return}}this.nmd(this.p3,Wc,this.asa)}else b.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",Zb?Zb.data?Zb.data.mUa:null:null),this.oyc(),this.enb=0,this.lTd(!1)}Lcf(Zb){return Zb.state?
Zb.state:0}Q7a(Zb,Wc=!1){let md=String.format("{0}{1}?action={2}&{3}",this.Ta.Va("PolicyHandlerWebServiceBase")||x.AFrameworkApplication.sa.Qa.s1,this.doe,Zb,x.AFrameworkApplication.ej);"setpolicylabel"===Zb&&x.AFrameworkApplication.lA&&x.AFrameworkApplication.lA.yqf&&(md=ha.a.Pl(md,"sl","1"));Wc&&(md=ha.a.Pl(md,"cbd","1"));return md}ief(Zb){let Wc,md;Wc=md=null;Zb&&Zb.data&&Zb.data.request&&Zb.data.request.get_headers()&&(Wc=Zb.data.request.get_headers()[Rb.a.Iag],md=Zb.data.request.get_headers()[Rb.a.qeg]);
return{Hag:Wc,peg:md}}D5d(Zb){Zb=Zb?Zb.data?Zb.data.Fe:null:null;return Zb&&Zb.length&&!this.pHi(Zb)?{returnValue:!0,data:Zb}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:Zb})}wgj(Zb){let Wc;try{Wc=nb.b(Zb)}catch(md){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Wc)if(Wc.IsPolicyTipAvailable)switch(Wc.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");
break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.dPc=Wc.NavigateUrl;this.IYj(Wc.GeneralText,Object(f.a)(this,this.p3i,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Wc.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,
306,10,"policyData is null after deserializing DataLossPrevention response.")}Ikh(Zb){switch(Zb){case "CoherencyFailure":return 1;case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;
case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}Qgj(Zb,Wc,md,Nd){var kd=Nd?Nd.oN:2;let yd=0,lc="",Lc;if(({qt:Lc}=nb.d(Zb)).returnValue)if(Lc){lc="Success";Zb=this.Wad(3);if(Lc.IsSuccessful){I.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.tgc(kd,void 0,this.tRb));this.AHb=this.tRb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",kd);2===
kd&&this.Ofa(29);this.iQj(Wc,kd);this.fZi();this.Ofa(28);Nd&&4===kd&&this.S3b(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Nd.displayName),CommonUIStrings.l_DialogOk,()=>{});S.a("MipAppliedLabels",void 0,void 0,[Object.assign(new ya.a,{name:"SetPolicyLabelApplyFlag",string:Ia[kd]})]);this.ihc(Wc,Zb,this.asa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
kd,Lc.FailureReason);this.AHb=Lc.FailureReason;this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",!1)?yd=this.Ikh(Lc.FailureReason):"FileTooLarge"===Lc.FailureReason?yd=7:"LabelNotSupported"===Lc.FailureReason?yd=13:"LabelDisabled"===Lc.FailureReason?yd=9:"MinorVersionLimitExceeded"===Lc.FailureReason&&(yd=15);this.uHi&&0<=Lc.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Nd=new sa.a(2,1,this.mPj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",
this.$ta);this.$ta<=this.w_b&&this.sYd(Wc,md)}),this.Ce.jg(Nd));this.Cmc&&this.supportsOfficeClientCoauthoring&&this.ihc(this.Cn.AppliedPolicyId,Zb,this.asa,!0,3)}else lc="setPolicyLabelData null.",b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",kd);else lc="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",kd);this.TUd(kd,
yd);kd=this.tgc(kd,void 0,this.tRb);this.tRb=null;kd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.AHb);kd.extendedProperties.set("SetPolicyLabelDataParseStatus",lc.toString());I.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,kd)}TUd(Zb,Wc=0){const md=2===Zb||8===Zb||16===Zb;this.setPolicyLabel(this.p3);this.SZf(new Xa);this.vPd(Wc,Zb,md,!1)}iQj(Zb,Wc){this.setPolicyLabel(this.p3=Zb);if(""===Zb)x.AFrameworkApplication.protectedFile=!1,x.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(const md of this.Cn.SensitivityLabels)if(md.Id===Zb){x.AFrameworkApplication.protectedFile=this.N$a(md);break}this.xpj(new V(Zb,Wc))}Xek(){for(const Zb of this.Cn.SensitivityLabels)Zb&&Zb.Enabled&&(Zb.Id===this.p3&&(this.zie=this.CFa!==Zb.Order,this.CFa=Zb.Order),Zb.Order>this.HRc&&(this.HRc=Zb.Order))}Ggj(Zb){if(!({qt:Zb}=nb.d(Zb)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Zb)return b.ULS.sendTraceTag(42467542,
306,10,"policyData is null after deserializing label policy data response."),!1;if(!Zb.AreLabelsAvailable)return!1;this.Cn=Zb;this.p3=Zb.AppliedPolicyId;this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnablePdfProtectionUsageTelemetry",!1)&&this.Ta.appSettings&&(this.Ta.appSettings.AppliedPolicyId=this.p3);this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.Xek();this.qja()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.SZf(new Xa(!0));return!0}jCe(){if(!this.qja())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const Zb of this.Cn.SensitivityLabels)if(Zb&&Zb.AutoLabelingSensitiveTypeIds&&0<Zb.AutoLabelingSensitiveTypeIds.length)return!0;b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}SZf(Zb){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");
this.$a.raiseEvent("LabelInfoUpdateEvent",Zb)}Ooj(Zb){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.$a.raiseEvent("GetPolicyLabelEventKey",Zb)}oyc(){ja.CAc(!1);this.$a.raiseEvent("GetPolicyLabelFailureEventKey",new bb)}jPd(Zb){this.tQ&&this.tQ.execute(Wc=>{Wc=[Wc.isFeatureEnabled("MsoClpSpTwo",!0),Wc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Wc).then(md=>{mb.a.any(md,Nd=>Nd)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.$a.raiseEvent("GetAutoPolicyLabelEventKey",
Zb),this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.jwb(),S.a("MipAutoClassificationEnabled"));return null})})}Dmd(Zb=null,Wc=null){const md=new Map;md.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=Zb&&md.set("ApplyLabelFlags",Ia[Zb]);null!=Wc&&md.set("GetPolicyLabelsReason",fb[Wc]);return md}tgc(Zb=null,Wc=null,md=null){const Nd=new Ma.a;Nd.extendedProperties=this.Dmd(Zb,Wc);null!=md&&(Nd.durationMs=this.Jx()-md);
return Nd}xpj(Zb){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.$a.raiseEvent("SetPolicyLabelEventKey",Zb)}BZf(Zb){b.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");Zb&&Zb.aGb&&S.a("MipRecommendations");this.$a.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Zb)}h_f(Zb){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.$a.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Zb)}roj(Zb){b.ULS.sendTraceTag(573842331,
306,50,"Raising an add mandatory labelling business bar entry event.");this.$a.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Zb)}rpj(Zb){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.$a.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Zb)}IYj(Zb,Wc=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.$a.raiseEvent("PolicyTipEvent",new Wa(CommonUIStrings.l_PolicyBusinessBarTitle,Zb,CommonUIStrings.l_PolicyOverrideButton,
Wc))}vPd(Zb,Wc,md,Nd=!0){b.ULS.sendTraceTag(42074656,306,Nd?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Wc);Nd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let kd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,yd=null,lc=null;switch(Zb){case 2:Nd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;kd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:kd=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;
break;case 7:Nd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;kd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Nd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;kd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:Nd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;kd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;
break;case 10:kd=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:Nd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;kd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 15:Nd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,kd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,yd=CommonUIStrings.l_LearnMore,lc=()=>{this.nPj()}}Zb=
new ia(Zb,Wc,md,Nd,kd,yd,lc);this.$a.raiseEvent("SetPolicyLabelFailureEventKey",Zb)}xOj(Zb){this.LUc=Zb}p3i(){this.dPc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),jb.a.jW(this.dPc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}pHi(Zb){if(!Zb.startsWith("<")||-1===Zb.indexOf("Error")&&-1===Zb.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");
return!0}VVf(){this.s0b&&(this.s0b.stop(),this.s0b=null)}DZh(Zb){if(!Zb)return"manual";switch(Zb.oN){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}}M_h(Zb){if(!Zb)return"privileged";Zb=Zb.oN;let Wc="privileged";if(4===Zb||1===Zb)Wc="standard";return Wc}ihc(Zb,Wc,md=null,Nd=!1,kd=0){this.Ta.ra("WacLabelingGetPolicyLabelsIsEnabled")&&(this.p3=Zb,this.asa=md,this.gi&&(this.JGa=this.gi.qd("WebServiceCall",
"Call Get Policy Endpoint On Server")),md={},md[Rb.a.u1g]=Zb,this.Ta.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(Zb=new Fb(this.Q7a("getpolicylabels",Nd),1,null,md,!0,2,kd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Wc),this.lh.send(Zb).NQd(Object(f.a)(this,this.qMf,"onGetPolicyLabelsSuccessCallback"),Object(f.a)(this,this.pMf,"onGetPolicyLabelsFailureCallback"))):this.lh.Fn(this.Q7a("getpolicylabels",Nd),1,null,md,!0,2,Object(f.a)(this,this.qMf,"onGetPolicyLabelsSuccessCallback"),
Object(f.a)(this,this.pMf,"onGetPolicyLabelsFailureCallback"),kd,void 0,void 0,void 0,void 0,"22"),this.enb++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.enb))}lPj(Zb,Wc,md,Nd=null){if(this.imc){this.gi&&(this.dIa=this.gi.qd("WebServiceCall","Call Set Policy Endpoint On Server"));var kd={};kd[Rb.a.Iag]=Zb;Wc&&(kd[Rb.a.qeg]=encodeURIComponent(Wc));this.LUc&&(kd[Rb.a.L0g]=this.LUc);Nd?(kd[Rb.a.meg]=this.DZh(Nd),kd[Rb.a.oeg]=this.M_h(Nd),this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",
!1)&&1===Nd.oN&&this.Cn.DefaultLabelType&&(kd[Rb.a.kPj]=this.Cn.DefaultLabelType)):(kd[Rb.a.meg]="manual",kd[Rb.a.oeg]="privileged");this.supportsOfficeClientCoauthoring&&this.Cn&&(kd[Rb.a.Mij]=this.Cn.PolicyLabelVersionToken);this.Ta.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(Zb=new Fb(this.Q7a("setpolicylabel",!0),1,null,kd,!0,2,Nd,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,md),this.lh.send(Zb).NQd(Object(f.a)(this,this.nRf,"onSetPolicyLabelSuccessCallback"),
Object(f.a)(this,this.mRf,"onSetPolicyLabelFailureCallback"))):this.lh.Fn(this.Q7a("setpolicylabel",!0),1,null,kd,!0,2,Object(f.a)(this,this.nRf,"onSetPolicyLabelSuccessCallback"),Object(f.a)(this,this.mRf,"onSetPolicyLabelFailureCallback"),Nd,void 0,void 0,void 0,void 0,"32");this.$ta++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.$ta)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}nPj(){const Zb=
new Q.StandardDialog,Wc=this.Ta.Va("BreadcrumbFolderUrl");Wc?(Zb.rc=11,Zb.Hc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Zb.Hc(2,CommonUIStrings.l_DialogOk)):(Zb.rc=0,Zb.Hc(1,CommonUIStrings.l_DialogOk));Zb.iwe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Zb.dwj();Zb.BT(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,
md=>{1===md&&Wc&&jb.a.Jf(Wc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}Wad(Zb){switch(Zb){case 1:return Ya.a.rka(1,1);case 2:return Ya.a.rka(7,1);case 3:return Ya.a.rka(8,1);default:return Ya.a.rka(7,0)}}toh(Zb=null){if(!Zb)return Ya.a.rka(8,0);switch(Zb.oN){case 1:case 16:return Ya.a.rka(1,1);case 4:case 2:case 8:return Ya.a.rka(8,1);default:return Ya.a.rka(8,0)}}lTd(Zb){this.Ta.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",
!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",Zb)}}Object(c.a)(xb,"PolicyManager",null,[498]);var qb=a(142),Ra=a(260);class Jb{constructor(){this.r3=this.Jta=this.Db=this.Tg=null}get name(){return"Common.App.Policy"}init(){x.AFrameworkApplication.fa.ra("ShouldInitCommonPolicyPackage")&&(x.AFrameworkApplication.fa.ra("IsDataLossPreventionEnabledForUser")&&x.AFrameworkApplication.sa&&(this.Tg=this.Db.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Tg.Iye(Object(f.a)(this,this.v0d,
"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?qb.a.get_instance().wj(5,()=>{this.Tg.jhc()}):qb.a.get_instance().wj(6,()=>{this.Tg.jhc()})),x.AFrameworkApplication.fa.ra("WacLabelingPoliciesIsEnabled")&&x.AFrameworkApplication.fa.ra("SupportsPolicies")?x.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",
!1)?qb.a.get_instance().wj(5,Object(f.a)(this,this.YHf,"onAfterRibbonBehaviorAttached")):qb.a.get_instance().wj(6,Object(f.a)(this,this.YHf,"onAfterRibbonBehaviorAttached")):(ja.igk(),ja.CAc(!1)))}dispose(){}Di(Zb){Zb.register(498,"Common.App.Policy.Contracts.IPolicyManager").Uc().dd(()=>new xb(x.AFrameworkApplication.fa,x.AFrameworkApplication.de,x.AFrameworkApplication.sa.hF,x.AFrameworkApplication.fa.oe("MaxGetPolicyRetries",1),Zb.qc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
x.AFrameworkApplication.sa.Qa.Ii));Zb.register(ja,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").Uc().dd(()=>new ja(x.AFrameworkApplication.Qb,x.AFrameworkApplication.sa,x.AFrameworkApplication.fa,Zb.zUd("Common.App.Policy.Contracts.IPolicyManager")));this.Db=Zb}YHf(){this.r3=this.Db.ah("CommonUI.BusinessBar");this.Tg||(this.Tg=this.Db.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Jta=this.Db.resolve("Common.App.Policy.PolicyActor");R.a("isSharedUxGateEnabled")&&
appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Tg.A4b(Object(f.a)(this.Jta,this.Jta.U1f,"registerActionsHandler")):this.Jta.vh();this.Tg.A4b(Object(f.a)(this,this.R6d,"updateLabelInfo"));x.AFrameworkApplication.fa.ra("WacApplyManualPolicyLabelIsEnabled")&&(this.Tg.R2c(Object(f.a)(this,this.umi,"handleSetPolicyLabelFailure")),this.Tg.pxe(Object(f.a)(this,this.S3b,"addAutoPolicyBusinessBarEntry")),this.Tg.Jye(Object(f.a)(this,this.Ofa,"removeAutoPolicyBusinessBarEntry")),
this.Tg.qxe(Object(f.a)(this,this.E1c,"addMandatoryLabellingBusinessBarEntry")),this.Tg.Kye(Object(f.a)(this,this.IRd,"removeMandatoryLabellingBusinessBarEntry")))}R6d(){this.Jta.heg();this.Jta.Cdg();this.Jta.lZf();const Zb=this.Tg.ldh();x.AFrameworkApplication.fa.ra("HasDocumentEditRights")&&!Zb?this.Jta.Kpg():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",x.AFrameworkApplication.fa.ra("HasDocumentEditRights"),
Zb);x.AFrameworkApplication.sa.updateCommandUI()}v0d(Zb,Wc){this.Jcf(Wc.title,Wc.kxc,38,Wc.NIf,Wc.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}umi(Zb,Wc){Wc.xig&&(this.Jcf(Wc.title,Wc.message,21,null,null,Wc.Iba,Wc.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}Ofa(){}S3b(Zb,Wc){this.r3&&(this.Tg.Ofa(Wc.fub),Zb=new e.a(Wc.title,
Wc.message,null),Zb.id=Wc.fub,Zb.closeable=!0,Zb.image=3,Zb.addButton(Wc.buttonText,Wc.Iba,Wc.buttonText,!0),this.r3.CD(Zb,!1))}E1c(Zb,Wc){this.r3&&(Zb=new e.a(Wc.title,Wc.message,null),Zb.id=Wc.fub,Zb.closeable=!1,Zb.image=3,Zb.addButton(Wc.buttonText,Wc.Iba,Wc.buttonText,!1),this.r3.CD(Zb,!1))}IRd(){}Jcf(Zb,Wc,md,Nd=null,kd=null,yd=null,lc=null){Zb=new e.a(Zb,Wc,null);Zb.id=md;Zb.closeable=!0;Nd&&Zb.sTg(kd,Nd);yd&&Zb.addButton(lc,yd,lc)}static main(){Ra.a.instance.nj(new Jb)}}Object(c.a)(Jb,"PackageManager",
null,[4,5]);var yb=a(10),Gb=a(562),ub=a(229),Ja=a(52),zb=a(40),na=a(126),Ea=a(42),ma=a(382),Ka=a(200),cb=a(91),Fa=a(33),wa=a(230),ka=a(1),Oa=a(23),hb=a(246);class Pa{constructor(){this.jxc=this.Cbg=null;this.oN=0}}Object(c.a)(Pa,"ApplyPolicyContextParameters",null,[]);var ca=a(2),ba=a(721),ib=a(576),Lb=a(51),gc=a(48);class Gc{constructor(){this.Xua=this.annotationType=null;this.jPa=this.Rx=!1}}Object(c.a)(Gc,"AnnotationActivationOptions",null,[]);var Kb=a(58);const pb=(Zb,Wc,md,Nd,kd,yd,lc=null)=>
{lc=Zb.Pa(1,lc);lc.tenantId=Wc;return Kb.g(Zb,"GetPolicyLabelId",lc,md,Nd,kd,yd,4)},nc=(Zb,Wc,md,Nd,kd,yd,lc,Lc,nd,Wd,$d=null)=>{$d=Zb.Pa(41,$d);$d.labelsInfoJson=Wc;$d.appliedLabelId=md;$d.tenantId=Nd;$d.applyLabelFlag=kd;$d.skipApplyOutcomes=yd;return Kb.g(Zb,"ApplyPolicyLabel",$d,lc,Lc,nd,Wd,0)},Wb=(Zb,Wc,md,Nd,kd,yd,lc=null)=>{lc=Zb.Pa(1,lc);lc.tenantId=Wc;return Kb.g(Zb,"GetPolicyApplicationMethod",lc,md,Nd,kd,yd,4)};var Ha=a(746),$a=a(726);class Nb extends Ha.a{constructor(){super();this.source=
this.automatic=this.recommended=null;this.H_=Object.assign(new $a.a,{T_:Nb.getTypeName(),B_:Nb.je()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static je(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Nb,"LabellingAnnotation",Ha.a,[]);var rb=a(745);class ec extends rb.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new $a.a,{T_:ec.getTypeName(),B_:ec.je()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static je(){return[]}}
Object(c.a)(ec,"SecurityShared",rb.a,[]);class pc extends ec{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new $a.a,{T_:pc.getTypeName(),B_:pc.je()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static je(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(c.a)(pc,"CLP",ec,[]);class vb extends Ha.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new $a.a,{T_:vb.getTypeName(),B_:vb.je()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static je(){return["AugLoop_Core_Annotation"]}}
Object(c.a)(vb,"LabellingAnnotation",Ha.a,[]);var ob=a(1016),Tb=a(910),Rd=a(1018);class Jd extends Ha.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new $a.a,{T_:Jd.getTypeName(),B_:Jd.je()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static je(){return["AugLoop_Core_Annotation"]}}Object(c.a)(Jd,"LinkedDataTypeAnnotation",Ha.a,[]);var ld=a(149),Yd=a(36),Ke=a(100);class Bb extends Ea.a{constructor(Zb,Wc,md,Nd,kd){super();this.kDf=3;this.D9a=
ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6649853_AutoPolicyMigratingToNewALAPI");this.ux=this.augmentationLoopManager=null;this.q2a=!1;this.udb=[];this.yxf=new ba.a(ib.a.yL());this.aOd=0;this.fOd=null;this.jwb=(yd,lc)=>{yd=Object(ca.a)(new ob.a,{parentPath:["session","doc","security"],items:[Object(ca.a)(new Tb.a,{id:"clp",body:Object(ca.a)(new pc,{existingLabelPriority:lc.existingLabelPriority,partialDocSITs:lc.QKe,fullDocSITs:lc.PKe})})]});this.udb.push(yd);this.GDb()};this.ssg=(yd,lc)=>{yd=
Object(ca.a)(new Rd.a,{parentPath:["session","doc","security"],items:[Object(ca.a)(new Tb.a,{id:"clp",body:Object(ca.a)(new pc,{existingLabelPriority:lc.existingLabelPriority})})]});this.udb.push(yd);this.GDb()};this.tsg=(yd,lc)=>{yd=Object(ca.a)(new Rd.a,{parentPath:["session","doc","security"],items:[Object(ca.a)(new Tb.a,{id:"clp",body:Object(ca.a)(new pc,{partialDocSITs:lc.QKe,fullDocSITs:lc.PKe})})]});this.udb.push(yd);this.GDb()};this.u8=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);
this.$.isEditMode?ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.GDb():this.Ylf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.duh())};this.Ecb=()=>{var yd;b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.D9a?null===(yd=this.augmentationLoopManager)||void 0===yd?void 0:yd.unregister("AutoPolicy"):this.MSe();this.augmentationLoopManager=null};this.nLi=(yd,lc)=>{var Lc,
nd,Wd,$d,se;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===lc.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var je=yd=null,Le=null;if(this.lmc()){var oe=lc.QB;if(!oe){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Lc=oe.automatic)||void 0===Lc?0:Lc.id)yd=oe.automatic.id;if(null===
(nd=oe.recommended)||void 0===nd?0:nd.id)je=oe.recommended.id,oe.recommended.policyTip&&(Le=oe.recommended.policyTip)}else{Lc=lc.QB;if(!Lc){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Wd=null===(oe=Lc.automatic)||void 0===oe?void 0:oe.sensitivityLabel)||void 0===Wd?0:Wd.id)yd=Lc.automatic.sensitivityLabel.id;if(null===(se=null===($d=Lc.recommended)||void 0===$d?void 0:$d.sensitivityLabel)||void 0===se?0:se.id)je=
Lc.recommended.sensitivityLabel.id,Lc.recommended.sensitivityLabel.policyTip&&(Le=Lc.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(yd,je,Le,1)}};this.mNi=(yd,lc)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===lc.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(yd=lc.QB)?(yd=yd.classificationId,this.applyPolicyLabel(yd,
yd,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.Z2f=(yd,lc)=>{lc?lc.aGb&&this.businessBar.YF(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!lc.aGb&&this.businessBar.YF(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):
b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.Mhg=(yd,lc)=>{lc?lc.aGb?(this.businessBar.WYj(lc.title,lc.message,lc.buttonText,Lc=>{lc.Iba(Lc);this.businessBar.YF(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.NWj(lc.title,lc.message,lc.buttonText,Lc=>{lc.Iba(Lc);this.businessBar.YF(40)&&
this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.MMd=Zb;this.policyManager=Wc;this.$=md;this.fa=Nd;this.businessBar=kd;this.Jri();this.dtj();this.disposed=!1}get Ec(){return!this.disposed&&this.$.ea.Ec}dispose(){var Zb;this.disposed||(this.disposed=!0,
this.Yvh(),this.D9a?null===(Zb=this.augmentationLoopManager)||void 0===Zb?void 0:Zb.unregister("AutoPolicy"):this.MSe(),this.MMd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}W1a(Zb,Wc,md,Nd,kd=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Nd} with AutoLabelPresent: ${!!Zb}, RecommendedLabelPresent: ${!!Wc}, isStandard: ${kd}.`);this.Ec?this.MMd&&(this.Qah(Wc,Nd)?(this.fOd=Wc,this.aOd=Nd,this.yxf.ia(Nd,Wc)):Wc=
this.fOd,Zb=this.MMd.W1a(Zb,Wc,md,kd),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${Zb}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Ec}.`)}Qah(Zb,Wc){if(!this.policyManager.qja())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;const md=this.policyManager.Cn;
let Nd;({value:Nd}=this.yxf.nd(this.aOd));let kd=null,yd=null,lc=null;for(const Lc of md.SensitivityLabels)Lc.Id===Zb&&(kd=Lc),Lc.Id===Nd&&(yd=Lc),Lc.Id===this.fOd&&(lc=Lc);return yd&&yd.Id===Zb?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.YF(41)&&this.aOd!==Wc&&lc&&(!kd||lc.Order>=kd.Order)?(b.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),
!1):!0}lmc(){return ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}yof(){return ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}dtj(){this.policyManager.pxe(this.Mhg);this.policyManager.Jye(this.Z2f);this.$.ea.E4(this.u8);this.lmc()&&this.yof()&&(this.policyManager.rWg(this.jwb),this.policyManager.jZg(this.ssg),this.policyManager.kZg(this.tsg))}Yvh(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);
this.policyManager.Xwj(this.Mhg);this.policyManager.ozj(this.Z2f);this.$.ea.r9(this.u8);this.lmc()&&this.yof()&&(this.policyManager.Fxj(this.jwb),this.policyManager.Szj(this.ssg),this.policyManager.Tzj(this.tsg))}Jri(){this.ux=new ba.a(ib.a.yL());const Zb=this.lmc()?Nb.getTypeName():vb.getTypeName();this.ux.add(1,Object(ca.a)(new Gc,{annotationType:Zb,Xua:this.nLi,Rx:!1,jPa:!1}));this.ux.add(2,Object(ca.a)(new Gc,{annotationType:Jd.getTypeName(),Xua:this.mNi,Rx:!1,jPa:!1}))}bmg(){for(let Zb of this.udb)this.augmentationLoopManager.submitOperation(Zb);
this.udb=[]}o9(Zb){if(!this.ux.Fb(Zb))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${Zb}.`),!1;if(this.ux.ma(Zb).Rx)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${Zb}.`),!0;this.ux.ma(Zb).Rx=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${Zb}.`);
if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.GDb():this.Ylf();return!0}Ylf(){var Zb=!1;for(let Wc of this.ux)if(Zb=Wc.value.Rx||Zb)break;Zb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),
this.r3b()):this.q2a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.q2a=!0,Zb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${Zb} milliseconds.`),Lb.a.instance.create(()=>{this.Lri()},Zb,gc.a.ODe,!0,!0)):b.ULS.sendTraceTag(537154632,306,
50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}GDb(){var Zb=0<this.udb.length;if(!Zb)for(let Wc of this.ux)if(Zb=Wc.value.Rx||Zb)break;Zb?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.r3b(),this.bmg()):this.q2a?b.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):
(this.q2a=!0,Zb=this.$.xa.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${Zb} milliseconds.`),Lb.a.instance.create(()=>{this.Mri()},Zb,gc.a.ODe,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}Mri(){zb.TaskExtensions.za(ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateAugmentationLoopToNewServiceInfra",
!1)?Object(Ke.d)(ld.a.resolve(Yd.f,{Wa:1})):Ja.GetServiceTaskFactory.Za(this.$.da,328,327,1),Zb=>{this.augmentationLoopManager=Zb.result;this.q2a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.D9a?this.augmentationLoopManager.register(this.augmentationLoopManager.j0().v2("AutoPolicy").t2(this.Ecb).build()):this.augmentationLoopManager.Ive(this.Ecb),this.$.isEditMode?(this.r3b(),this.bmg()):
b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,3)}Lri(){zb.TaskExtensions.za(ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigrateAugmentationLoopToNewServiceInfra",!1)?Object(Ke.d)(ld.a.resolve(Yd.f,{Wa:1})):Ja.GetServiceTaskFactory.Za(this.$.da,328,327,1),Zb=>{this.augmentationLoopManager=
Zb.result;this.q2a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.D9a?this.augmentationLoopManager.register(this.augmentationLoopManager.j0().v2("AutoPolicy").t2(this.Ecb).build()):this.augmentationLoopManager.Ive(this.Ecb),this.$.isEditMode?this.r3b():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.ka,3)}MSe(){for(let Zb of this.ux)Zb.value.Rx&&this.Xvh(Zb.key)}Xvh(Zb){this.ux.ma(Zb).jPa&&this.HRe(Zb);this.ux.ma(Zb).Rx=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${Zb}.`)}r3b(){for(let Zb of this.ux)Zb.value.Rx&&!Zb.value.jPa&&this.activateAnnotation(Zb.key)}activateAnnotation(Zb){this.D9a?this.augmentationLoopManager.o9("AutoPolicy",
{annotationType:this.ux.ma(Zb).annotationType,Jv:!0,HO:this.ux.ma(Zb).Xua}):(this.augmentationLoopManager.grb(this.ux.ma(Zb).annotationType),this.augmentationLoopManager.Bua(this.ux.ma(Zb).annotationType,this.ux.ma(Zb).Xua));this.ux.ma(Zb).jPa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${Zb}.`)}duh(){for(let Zb of this.ux)Zb.value.jPa&&this.HRe(Zb.key)}HRe(Zb){var Wc;this.D9a?null===(Wc=this.augmentationLoopManager)||void 0===Wc?void 0:
Wc.Cbk(this.ux.ma(Zb).annotationType):this.augmentationLoopManager.qzc(this.ux.ma(Zb).annotationType,this.ux.ma(Zb).Xua);this.ux.ma(Zb).jPa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${Zb}.`)}applyPolicyLabel(Zb,Wc,md,Nd){if(this.fa.ra("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.W1a(Zb,Wc,md,Nd);else{b.ULS.sendTraceTag(537154578,
306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const kd=yd=>{this.W1a(Zb,Wc,md,Nd,0===yd||1===yd||4===yd)};this.yod(kd,()=>{kd(2)},this.kDf)}}U4c(Zb,Wc){let md=null,Nd=null;if(!({sensitivityLabel:md,wJa:Nd}=this.zqg(Zb)).returnValue)return b.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Nd&&Nd.Order>=md.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),
!1;this.applyPolicyLabel(md.Id,md.Id,null,Wc);return!0}V4c(Zb,Wc){Wc=!1;let md=null,Nd=null;if(!({sensitivityLabel:md,wJa:Nd}=this.zqg(Zb)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,$9a:Wc};if(Nd&&Nd.ParentId&&md.ParentId&&Nd.ParentId===md.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,
$9a:Wc};if(Nd&&Nd.Order>=md.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,$9a:Wc};if(this.fa.ra("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),Zb=this.policyManager.Cn,Zb=!Zb.AppliedPolicyId||!Zb.PolicyLabelAssignmentMethod||Ga.e(Zb.PolicyLabelAssignmentMethod)===
Ga.e("standard"),this.cCe(md.Id,Zb);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const kd=yd=>{this.cCe(md.Id,0===yd||1===yd||4===yd)};this.yod(kd,()=>{kd(2)},this.kDf)}return{returnValue:!0,$9a:Wc}}yod(Zb,Wc,md,Nd=0){if(this.Ec){var kd=this.$.qa.va.Bc();Wb(this.$.qa.va,this.$.xa.DocumentHostInfo.TenantId,yd=>{this.Uai(yd,Zb)},()=>{this.Tai(Zb,Wc,md,Nd)},null,null,kd)}else b.ULS.sendTraceTag(537154570,
306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Ec}.`)}Uai(Zb,Wc){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Ec?!Zb||wa.a(Zb)?b.ULS.sendTraceTag(537154567,306,15,Zb?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Wc(Zb.Result):b.ULS.sendTraceTag(537154568,
306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Ec}.`)}Tai(Zb,Wc,md,Nd){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.Ec?Nd>=md?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Wc()):this.yod(Zb,Wc,md,Nd+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Ec}.`)}cCe(Zb,
Wc){Wc?this.W1a(Zb,null,null,3,!0):this.W1a(null,Zb,null,3,!1)}zqg(Zb){let Wc,md;md=Wc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Wc,wJa:md};if(!this.policyManager.qja())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Wc,wJa:md};const Nd=this.policyManager.Cn;if(!Nd)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),
{returnValue:!1,sensitivityLabel:Wc,wJa:md};if(mb.a.sh(Nd.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Wc,wJa:md};const kd=Nd.AppliedPolicyId;for(const yd of Zb)for(const lc of Nd.SensitivityLabels)lc.Id===yd&&(!Wc||Wc.Order<lc.Order)&&(Wc=lc),lc.Id===kd&&(md=lc);return Wc?{returnValue:!0,sensitivityLabel:Wc,wJa:md}:(b.ULS.sendTraceTag(537154526,
306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Wc,wJa:md})}}Object(c.a)(Bb,"AutoPolicyManager",Ea.a,[2]);var Ob=a(166),ed=a(13),Sd=a(16);class Pd extends Ob.ErrorDialog{constructor(Zb){super(Zb,Pd.YR(Zb))}cr(){super.cr();if(this.error.Appearance&1&&this.$.$d&2){const Zb=this.getButton(0);ed.DOMElementExtensions.IXd(Zb.get_element(),Sd.a.instance.ha(1315));this.lN(()=>{0===this.returnValue&&this.$.$d&2&&(b.ULS.sendTraceTag(50373725,
306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),zb.TaskExtensions.za(Ja.GetServiceTaskFactory.Za(this.$.da,55,56,0),Wc=>{Wc.result.E$c()},this.$.ka,3))})}}static YR(Zb){return Zb.$d&2?Fa.a.Od(3,1,0,1975,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):Fa.a.Od(1,1,0,1976,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Pd,"BlockSenitivityLabelActionDialog",Ob.ErrorDialog,[]);var ic=a(30),Kc=a(89);class dc extends Ea.a{constructor(Zb,Wc,md,Nd,
kd){super();this.statusBarManager=null;this.R5c=!1;this.Eba=null;this.VJc=!1;this.MAa=this.XWd=null;this.No=this.NMd=!1;this.fHa=this.Wme=this.Zha=this.foe=this.vq=null;this.PWe=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const yd=this.Y1f(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${yd}.`)};this.v0d=(yd,lc)=>{lc?(this.vq=
lc.title,this.foe=lc.kxc,this.Zha=lc.buttonText,this.Wme=lc.NIf,this.Jba.zh(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.$ig=(yd,lc)=>{const Lc=Object(na.a)(ia,lc);Lc?Lc.xig?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Lc.errorType}`),this.Jba.bZj(Lc.title,
Lc.message,Lc.buttonText,nd=>{Lc.Iba&&(this.Jba.YF(54)&&this.Jba.removeEntry(54),Lc.Iba(nd))})):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.Jba.zh(48,null))};this.R6d=(yd,lc)=>{this.Z8&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.Z8.heg(),this.Z8.Cdg(),
this.Z8.lZf(),this.$.$d&64&&(lc.onSuccess&&this.MAa?this.G1g():this.Z8.Kpg()));this.fa.ra("SupportsOfficeClientCoauthoring")&&(yd=this.It.Cn,this.fHa=yd.AppliedPolicyId,"null"===this.labelId&&(this.fHa=""),this.VJc&&(yd=yd.PolicyLabelAssignmentMethod&&Ga.e(yd.PolicyLabelAssignmentMethod)===Ga.e("standard")?4:2,this.applyPolicyLabel(this.labelId,yd,!0,this.XWd)));this.b2e();this.RA()};this.oMf=()=>{this.NMd=!0;this.b2e()};this.lRf=(yd,lc)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${x.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${lc.oN}`);
this.applyPolicyLabel(lc.jxc,lc.oN,!1,null)};this.A0i=(yd,lc)=>{this.fHa=lc.jxc;if(Fa.a.Aq(yd.Errors)){var Lc=Fa.a.l6(yd.Errors,[2045508683]);0<Lc.length&&(yd.Errors=Fa.a.bB(yd.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.To(yd.Errors));Lc=Fa.a.l6(yd.Errors,[2046680228]);0<Lc.length&&(4===lc.oN||1===lc.oN)&&(yd.Errors=Fa.a.bB(yd.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.To(yd.Errors));Lc=yd=null;
for(var nd of this.It.Cn.SensitivityLabels)Oa.a.equals(this.labelId,nd.Id,!1)&&(yd=nd),Oa.a.equals(lc.Cbg,nd.Id,!1)&&(Lc=nd);nd={};nd.ApplyLabelFlag=lc.oN;yd?(nd.currentLabel="Set",nd.currentLabelEnabled=yd.Enabled,nd.currentLabelName=yd.Name?"Set":"NotSet",nd.currentLabelParentId=yd.ParentId?"Set":"NotSet"):nd.currentLabel="NotSet";Lc?(nd.serverLabel="Set",nd.serverLabelEnabled=Lc.Enabled,nd.serverLabelName=Lc.Name?"Set":"NotSet",nd.serverLabelParentId=Lc.ParentId?"Set":"NotSet"):nd.serverLabel=
"NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(nd)}`)}};this.D5g=(yd,lc)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;const Lc=this.It.Cn;if(!Lc)return b.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let nd=null;for(const Wd of Lc.SensitivityLabels)Oa.a.equals(Wd.Id,yd,!1)&&(nd=Wd);return nd&&this.hoi(nd)?(b.ULS.sendTraceTag(50341186,
306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.QWj(lc),!0):!1};this.Oxi=()=>{let yd=!1;!this.$.xa.IsNewWorkbook||this.labelId&&this.labelId.length||(yd=!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${yd}`);return yd};this.$Cf=(yd,lc)=>{1===lc.RAe?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ia.$b(new cb.a(-723527778,
0,this.$.Kc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.MAa=lc.MAa,this.$.ea.E4(this.YBe),this.$.Mjb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.$.Ia.$b(new cb.a(-8805455,0,this.$.Kc,10,null)))};this.nwe=(yd,lc)=>{lc?(yd=!!(this.$.$d&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${yd}`),yd&&(this.$.Mjb(),this.Jba.lYj(lc.title,
lc.message,lc.buttonText,Lc=>{lc.Iba(Lc)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.u3f=()=>{this.Jba.YF(42)&&this.Jba.removeEntry(42)};this.drg=(yd,lc)=>{lc.KUj&&(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),zb.TaskExtensions.za(Ja.GetServiceTaskFactory.Za(this.$.da,55,56,0),Lc=>{Lc.result.E$c()},
this.$.ka,3))};this.YBe=()=>{this.MAa&&this.$.isEditMode?(this.$.ea.r9(this.YBe),this.HAb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.MAa} , edit mode : ${this.$.isEditMode}.`)};this.Gma=()=>{const yd=this.$.ea.Pn;yd&&!Oa.a.equals(yd.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),b.ULS.shipAssertTag(537154463,
306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.ra("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&(this.VJc=!0,this.XWd=yd.AppliedPolicyLabelId),this.fHa=yd.AppliedPolicyLabelId,this.HAb())};this.Dwd=()=>{let yd=!0;if(!this.$.ea.amIAlone)for(const lc of this.$.ea.to)if(!lc.SupportsClientIsMipTrusted){yd=!1;break}b.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${yd}`);
return yd};this.CNf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.VJc=!0;this.HAb()};this.$=Nd;this.It=Zb;this.Jba=md;this.fa=kd;this.It.Iye(this.v0d);this.Z8=Wc}initialize(){this.fa.ra("SupportsPolicies")?(this.fHa=this.fa.Va("AppliedPolicyId"),this.Z8.vh(),this.$.da.Gb(29,Zb=>{this.statusBarManager=Zb;Zb.BK(this)}),this.RA(),Oa.a.sh(this.fa.Va("HostUserId"))||this.Nij(),this.Z8.ftj(this.D5g),this.Z8.Ztj(this.Oxi),this.It.btj(this.Dwd),
this.No=ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste")):R.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!Oa.a.sh(this.fa.Va("HostUserId"))&&ka.EwaSettings.ya(158)&&this.$.ea.oh.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.A4h())}qr(Zb){this.addHandler("LabelInfoChangedKey",Zb)}Rr(Zb){this.removeHandler("LabelInfoChangedKey",Zb)}ro(){return!0}ut(Zb,Wc){if("QueryPolicyLabel"!==
Zb)return!1;if(this.zqa())return Wc.Visible=!1,!0;!Oa.a.sh(Wc.LabelText)&&ic.a.vp()&&window.setTimeout(()=>{appChrome.api.dispatch(appChrome.actions.setControlCustomTooltip(Kc.a.G8b,Wc.Alt))},0);Wc.Visible=!0;return 32===x.AFrameworkApplication.Qb.Be(fa.a.Leb,2,Wc)}dispose(){this.statusBarManager&&(this.statusBarManager.cH(this),this.statusBarManager=null);this.Z8.AUb();this.R5c=!1;this.It.Ezj(this.$ig);this.It.Fzj(this.lRf);this.$.ea.Xw(this.Gma);if(this.fa.ra("SupportsOfficeClientCoauthoring")){const Zb=
this.$.da.Ba(292);Zb&&Zb.xyj(this.CNf)}this.It.Zwj(this.nwe);this.It.pzj(this.u3f);this.It.Gyj(this.$Cf);this.It.Qzj(this.drg);this.It.$xj(this.PWe);this.Eba&&(this.Eba.dispose(),this.Eba=null);super.dispose()}get title(){return this.vq}get kxc(){return this.foe}get linkText(){return this.Zha}get H8i(){return this.Wme}get labelId(){return this.fHa}U4c(Zb,Wc){if(!this.fa.ra("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.NMd)return b.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(mb.a.sh(Zb))return!1;this.Eba||this.Ptd();return this.Eba.U4c(Zb,Wc)}RA(){this.raiseEvent("LabelInfoChangedKey")}A4h(){qb.a.get_instance().wj(10,()=>{this.It.jhc()})}Nij(){qb.a.get_instance().wj(10,()=>{this.It.A4b(this.R6d);this.It.VWg(this.oMf);this.It.UWg(this.oMf);this.It.R2c(this.$ig);this.It.Tye(this.lRf);this.$.ea.nv(this.Gma);this.It.qxe(this.nwe);this.It.Kye(this.u3f);
this.It.GXg(this.$Cf);this.It.gZg(this.drg);if(this.fa.ra("SupportsOfficeClientCoauthoring")){const Zb=this.$.da.Ba(292);Zb&&Zb.wXg(this.CNf)}b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler");this.It.SWg(this.PWe);this.cRh()});this.$.wYd("sensitivity",!0)}cRh(){this.fa.ra("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.HAb():this.E_h(this.$.xa.DocumentHostInfo.TenantId)}Ptd(){this.Eba=
new Bb(this.Z8,this.It,this.$,this.fa,this.Jba)}Y1f(Zb){if(!this.fa.ra("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.Eba||this.Ptd();return this.Eba.o9(Zb)}V4c(Zb,Wc){if(!this.fa.ra("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,$9a:!1};if(!this.NMd)return b.ULS.sendTraceTag(537154516,
306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,$9a:!0};this.Eba||this.Ptd();return this.Eba.V4c(Zb,Wc)}E_h(Zb){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${Zb.length}`);const Wc=this.$.qa.va.Bc();pb(this.$.qa.va,Zb,md=>{this.t3j(md)},null,null,null,Wc)}t3j(Zb){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");
Zb&&!wa.a(Zb)&&(this.fHa=Zb.Result);this.HAb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}HAb(){this.It.nmd(this.labelId,void 0,void 0,!1)}b2e(){if(!this.R5c){this.$.Wf();this.R5c=!0;this.Jba.Vhf();const Zb={};Zb.hasLabel=!!this.labelId&&0<this.labelId.length;Zb.isProtectedFile=this.fa.ra("ProtectedFile");Zb.SupportsPolicies=
this.fa.ra("SupportsPolicies");Zb.AreLabelsAvailableForDisplay=this.It.qja();Zb.SupportsOfficeClientCoauthoring=this.fa.ra("SupportsOfficeClientCoauthoring");Zb.IsAnonymousUser=this.fa.ra("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(Zb)}`)}}G1g(){this.Z8.H1g(this.MAa);this.MAa=null}hoi(Zb){for(const Wc of Zb.LabelActions)if(Oa.a.equals(Wc.Name,"ApplyWatermark",!1))return!0;return!1}QWj(Zb){Zb?(new Pd(this.$)).Rg():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(Zb,
Wc,md,Nd){const kd=nb.c(this.It.Cn);if(void 0===Zb||null===Zb)Zb="";const yd=new Pa;yd.jxc=Zb;yd.Cbg=Nd;yd.oN=Wc;const lc=this.$.qa.va;ma.a(this.$.userOperationManager,(Lc,nd,Wd)=>nc(lc,kd,Zb,this.$.xa.DocumentHostInfo.TenantId,Wc,md,hb.b.call(null,this.A0i,Lc),null,Wd,yd),Lc=>new Ka.a(222,0,Lc),null);this.VJc=!1;this.XWd=null}zqa(){const Zb=this.$.da.Ba(478);return this.No&&Zb?Zb.No():!1}}Object(c.a)(dc,"PolicyManagerWrapper",Ea.a,[196,197,496]);var Hc=a(71);class Uc extends ub.a{constructor(Zb){super();
this.$=Zb;this.kc()}create(){const Zb=Object(Hc.b)("OfficeVSO:7811663_ConvertBusinessBarManagerService2")?Object(Ke.d)(ld.a.resolve(Yd.h,{Wa:this.La})):Ja.GetServiceTaskFactory.Za(this.$.da,5,4,this.La),Wc=x.AFrameworkApplication.de,md=x.AFrameworkApplication.fa;zb.TaskExtensions.za(Zb,()=>{try{const Nd=new Gb.a(()=>new xb(md,Wc,x.AFrameworkApplication.sa.hF,this.$.xa.MaxGetPolicyRetries,aa.a.instance.qc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),kd=new Gb.a(()=>new ja(x.AFrameworkApplication.Qb,
x.AFrameworkApplication.sa,x.AFrameworkApplication.fa,Nd));let yd=this.$.da.Ba(274);yd||(yd=new dc(Nd.value,kd.value,Zb.result,this.$,x.AFrameworkApplication.fa),this.$.da.Ja(274,yd),yd.initialize());this.Pb(yd)}catch(Nd){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Nd.toString()}]`),Nd;}},this.ka,3)}static la(Zb){Zb.da.Ja(275,new Uc(Zb))}}Object(c.a)(Uc,"PolicyManagerFactory",ub.a,[]);var Fd=a(722),Td=a(198);class ad{constructor(Zb){this.$=Zb}hd(){return!1}executeCommand(Zb,
Wc,md){switch(Wc.command){case fa.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(md[F.L3c]=this.$.workbookContext.ExclusiveLockId),Zb=x.AFrameworkApplication.Qb.Be(fa.a.setSensitivity,2,md),Aa.Task.Ua(32===Zb);case fa.a.f9:return Zb=x.AFrameworkApplication.Qb.Be(fa.a.f9,2,md),Aa.Task.Ua(32===Zb);case fa.a.g9:return Zb=x.AFrameworkApplication.Qb.Be(fa.a.g9,2,md),Aa.Task.Ua(32===Zb);default:return Td.a(Wc.command)}}Tc(Zb,Wc){switch(Wc.command){case fa.a.setSensitivity:case fa.a.f9:case fa.a.g9:return!0;
default:return!1}}ld(Zb,Wc,md){switch(Wc){case "PopulateSensitivityFlyout":return 32===x.AFrameworkApplication.Qb.Be(fa.a.aCa,2,md);default:return!1}}}Object(c.a)(ad,"SensitivityCommandHandler",null,[200]);class Qd extends Fd.a{constructor(Zb){super(Zb)}he(){this.Pd([new ad(this.$)])}static la(Zb){Fd.a.ye(316,new Qd(Zb))}}Object(c.a)(Qd,"SensitivityCommandHandlerFactory",Fd.a,[]);Type.registerNamespace("Common.App.Policy");Jb.main();(()=>{yb.a.Fa(Zb=>{Uc.la(Zb);Qd.la(Zb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSOpt.policy.js.map/55c2f420aefa10dcd26b8371ef649b38/EwaDSOpt.policy.js.map