'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[56],{1514:function(u,C,a){a.r(C);u=a(0);var c=a(15),b=a(88);class f extends Sys.EventArgs{constructor(){super()}}Object(u.a)(f,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var e;(function(W){W[W.notYetStarted=0]="notYetStarted";W[W.polling=1]="polling";W[W.subscribed=2]="subscribed";W[W.blocked=3]="blocked";W[W.permanentlyStopped=4]="permanentlyStopped"})(e||(e={}));Object(u.b)("RtcHostNotificationSubscriptionState",
e);var d=a(112);class h extends Sys.EventArgs{constructor(W,Ga,pa,aa){super();this.Xxc=W;this.newState=Ga;this.Klj=pa;this.Llj=aa}}Object(u.a)(h,"StateChangedEventArgs",Sys.EventArgs,[]);var l=a(105);class k{constructor(W){this.$a=new l.a;this.Kre=new Date;this.lde=W;this.QPc=0}get currentState(){return this.lde}get lYe(){return this.QPc}event(W,Ga=null){this.currentState!==W&&(this.DTh(this.currentState,W,this.lYe,Ga),this.QPc=0,this.Kre=new Date);this.lde=W;this.QPc=this.lYe+1}DTh(W,Ga,pa,aa){W=
new h(W,Ga,pa,this.Kre,aa);this.$a.raiseEvent("c",W)}U2c(W){this.$a.addHandler("c",W)}g5f(W){this.$a.removeHandler("c",W)}}Object(u.a)(k,"StateMachine",null,[628]);class n{constructor(W,Ga,pa,aa,Z,fa,ya,Aa,ja){this.Bn=!1;this.x1b=this.I_a=this.OQ=this.sia=null;this.tqb=n.OLc;this.$a=new l.a;this.eua=new k(0);this.eua.U2c(Object(b.a)(this,this.icj,"onStateMachineChanged"));this.pNg=W;this.i1b=Ga;this.oNg=pa;this.fYc=aa;this.Ce=Z;this.HU=fa;ya.execute(za=>{this.Bn||(this.I_a=za,this.I_a.t1a(Object(b.a)(this,
this.ifa,"onUpdateNotificationReceived")),this.start())});Aa.execute(za=>{this.Bn||(this.x1b=za,za.dsb(Object(b.a)(this,this.uSa,"onTokenRefreshed")))});this.Ise=ja}get Aib(){return this.eua.currentState}get puf(){return!this.HU||this.HU.Jvf}get K7(){return 2===this.Aib&&this.Ise()<this.tqb}start(){0!==this.Aib?c.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",e[this.Aib]):(this.eua.event(1),this.RWd(null))}RWd(){this.sia=null;if(this.puf){c.ULS.sendTraceTag(573100181,
502,50,"HostNotifications: Send event when connected.  Current state: {0}",e[this.Aib]);let W=null;this.fYc&&this.fYc.length&&(W={},W.etts=this.fYc);this.I_a.P9(14,W,!0);this.S$f(this.pNg)}else this.eua.event(3)}S$f(W){this.sia=d.a.aac(1E3*W,Object(b.a)(this,this.RWd,"sendSubscribeEvent"),this.i1b,192,"RtcHostNotificationSubscribe");this.Ce.jg(this.sia)}vHj(W){W=1E3*(W+this.oNg);const Ga=this.Ise().getTime()+W;this.tqb=new Date(Ga);W-=this.i1b;this.OQ?this.Ce.Lpa(this.OQ,W):(this.OQ=d.a.aac(W,Object(b.a)(this,
this.S8j,"transitionToPollingEvent"),this.i1b/2,194,"RtcHostNotificationTransitionToPolling"),this.Ce.jg(this.OQ))}S8j(){this.OQ=null;2===this.Aib&&(this.eua.event(1),c.ULS.shipAssertTag(573100185,502,!!this.sia,"Missing task to ensure that we re-subscribe."))}uSa(){this.Wji()}Wji(){3===this.Aib&&this.puf&&(this.eua.event(this.K7?2:1),this.RWd(null))}ifa(W,Ga){if(13===Ga.type&&(W=Ga.y$,c.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:W,
["DurationBeforeExpirationToResubscribeInSec"]:this.i1b}),Ga=W.cts,!this.iak(Ga))){if(W.sb){var pa=2;this.vHj(W.cts)}else pa=1,this.tqb=n.OLc,this.OQ&&(this.Ce.Zp(this.OQ),this.OQ=null);this.eua.event(pa);this.sia?this.Ce.Lpa(this.sia,1E3*Ga):this.S$f(Ga)}}iak(W){if(!isNaN(W)&&isFinite(W)&&0<W)return!1;this.wlg(!1);return!0}wlg(W){this.sia&&(this.Ce.Zp(this.sia),this.sia=null);this.OQ&&(this.Ce.Zp(this.OQ),this.OQ=null);this.I_a&&(this.I_a.MOb(Object(b.a)(this,this.ifa,"onUpdateNotificationReceived")),
this.I_a=null);this.x1b&&(this.x1b.cAc(Object(b.a)(this,this.uSa,"onTokenRefreshed")),this.x1b=null);W||this.eua.event(4)}icj(W,Ga){W=Ga.newState;const pa=Ga.Xxc,aa={};aa.NewState=e[W];aa.PreviousState=e[pa];aa.PreviousStateHits=Ga.Klj;aa.PreviousStateTransitionTime=Ga.Llj.toISOString();aa.IsSubscribed=this.K7;this.tqb!==n.OLc&&(aa.SubscriptionExpiringTime=this.tqb.toISOString());c.ULS.sendTraceTag(572346515,502,4===W?15:50,"HostNotificationChanged: {0}",aa);this.$a.raiseEvent("HN",new f(pa,W))}dispose(){this.Bn||
(this.Bn=!0,this.wlg(!0),this.OQ&&(this.Ce.Zp(this.OQ),this.OQ=null))}}n.OLc=new Date(0);Object(u.a)(n,"RtcHostNotificationSubscriptionManager",null,[600,2]);var v=a(6),x=a(260),w=a(664),r=a(84);class t{constructor(){this.Ay=this.Bn=!1}get name(){return"RtcHostNotificationSubscription"}Di(W){W.register(n,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").Uc().dd(()=>{const Ga=
v.AFrameworkApplication.fa;return new n(Ga.oe("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),Ga.oe("RtcHostNotificationRetryIntervalBufferInSeconds",120),Ga.oe("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.ydi(Ga),v.AFrameworkApplication.Mi,w.SessionStatusManager.instance,W.qc("Common.IRealtimeChannelBasic"),W.qc("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.fa.Hv(()=>{!this.Bn&&v.AFrameworkApplication.fa.ra("RtcHostNotificationEnabled")&&
(this.Ay=!0,r.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Bn||(this.Bn=!0,this.Ay&&r.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}ydi(W){return W.Dq("RtcEventTypesToSubscribe")?W.Kw("RtcEventTypesToSubscribe"):null}static main(){x.a.instance.nj(new t)}}Object(u.a)(t,"RtcHostNotificationSubscriptionPackage",null,[4,5]);var A=a(111),y=a(26);class z{constructor(W,
Ga){this.Na=W;this.f_a=Ga}vh(){this.Na.xc(y.a.Gyf,A.a.frame,Object(b.a)(this,this.Hyf,"livePersonaCardActionHandler"))}AUb(){this.Na.$A(y.a.Gyf,A.a.frame,Object(b.a)(this,this.Hyf,"livePersonaCardActionHandler"))}Hyf(W,Ga,pa,aa,Z){if(!Z||3===pa)return 2;if(1===pa)return this.M0a(this.f_a.oHe(Z.upn||Z.aadObjectId));if(!this.WDh(Z))return 8;switch(Z.action){case 0:return this.M0a(this.f_a.nSg(Z));case 1:return this.M0a(this.f_a.mSg(Z));case 2:return this.M0a(this.f_a.oSg(Z));case 3:return this.M0a(this.f_a.openCard(Z));
case 4:return this.M0a(this.f_a.Jvj(Z));default:return 2}}WDh(W){const Ga=W.upn||W.aadObjectId;return W.targetElement&&(4===W.action||Ga&&""!==Ga)?!0:!1}M0a(W){return W?32:8}}Object(u.a)(z,"LivePersonaCardActor",null,[]);var E=a(170),G=a(126);class F{}Object(u.a)(F,"BootstrapperConfig",null,[]);class O{}Object(u.a)(O,"LivePersonaCardInitializerResult",null,[]);class M{}M.TEe=null;Object(u.a)(M,"LivePersonaCardModule",null,[]);var P=a(569);class B{constructor(W,Ga,pa,aa=null){this.ql=new E.a;this.vLg=
W;this.oKg=Ga;this.Ta=pa;this.fnb=aa}init(){this.bsf()?this.vLg.VNi().continueWith(Object(b.a)(this,this.Y9i,"onPackageLoaded")):this.ql.setResult(Object.assign(new O,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.ql.task}Y9i(){const W=M.TEe;if(W){const Ga=this.w0h();try{W.initializeLivePersonaCardAsync(Ga).then(()=>{this.ql.setResult(Object.assign(new O,{isInitialized:!0,isEnabled:!0}))}).catch(pa=>{const aa=Object(G.a)(String,pa);aa?this.ql.setException(Error.create(aa)):
this.ql.setException(Error.create(JSON.stringify(pa)))})}catch(pa){this.ql.setException(pa)}}else this.ql.setResult(Object.assign(new O,{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))}w0h(){const W=P.a.sL(v.AFrameworkApplication.lcid);return Object.assign(new F,{culture:W?W.name.toLocaleLowerCase():"en-us",clientType:this.Ta.Va("LivePersonaCardClientType"),clientContextType:"Generic",clientCorrelationId:v.AFrameworkApplication.userSessionId,complianceEnvironment:this.A2h(),
logMessage:Object(b.a)(this,this.logMessage,"logMessage"),getAuthToken:Object(b.a)(this,this.getAuthToken,"getAuthToken")})}bsf(){if(!this.Ta.ra("LivePersonaCardIsEnabled")||!this.A0g())return!1;const W=this.Ta.Va("SovereignEnvironmentName");return W&&""!==W?W.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||W.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0}A0g(){return this.Ta.ra("CoauthorGalleryLivePersonaCardIsEnabled")||!!v.AFrameworkApplication.sa&&v.AFrameworkApplication.sa.Qa.AVa}A2h(){return this.Ta.Va("LivePersonaCardComplianceEnvironment")}logMessage(W,
Ga,pa){W=JSON.stringify({["Log Type"]:W,["Log Result Type"]:Ga,["Message"]:pa});c.ULS.sendTraceTag(50431106,3006,50,W)}getAuthToken(W,Ga){v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?this.fnb.continueWith(pa=>{pa.Zh||pa.vg?Ga("LokiTokenManagerTask is either canceled or faulted.",v.AFrameworkApplication.userSessionId):this.fnb.result.Ond().then(aa=>{aa.isSuccess&&aa.token&&aa.token.length?W(aa.token,v.AFrameworkApplication.userSessionId):
Ga(aa.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(aa=>c.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(aa)))}):this.oKg.Ond().then(pa=>{pa.isSuccess&&pa.token&&pa.token.length?W(pa.token,v.AFrameworkApplication.userSessionId):Ga(pa.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(pa=>c.ULS.sendTraceTag(50431107,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(pa)))}}Object(u.a)(B,"LivePersonaCardInitializer",
null,[]);class D{}Object(u.a)(D,"Behavior",null,[]);class I{}Object(u.a)(I,"Identifiers",null,[]);class S{}Object(u.a)(S,"LivePersonaCardParameters",null,[]);class J{}Object(u.a)(J,"PersonaInfo",null,[]);class L{constructor(W){this.uIg=W}oHe(W){return this.uIg.bsf()&&W&&""!==W?!!window.self.LPC:!1}nSg(W){return this.sUb("addedPersonaToPageV2",W,0)}mSg(W){return this.sUb("addedPersonaToPageV2",W,1)}oSg(W){return this.sUb("addedPersonaToPageV2",W,2)}openCard(W){return this.sUb("openCard",W)}Jvj(W){return this.sUb("removedPersonaFromPage",
W)}Aah(W){return!!W.targetElement&&(this.oHe(W.upn||W.aadObjectId)||4===W.action)}sUb(W,Ga,pa=3){if(!this.Aah(Ga))return!1;pa=4!==Ga.action?this.Toh(Ga,pa):null;const aa=window.self.LPC;if(aa&&aa[W]){if(pa)aa[W](Ga.targetElement,pa);else aa[W](Ga.targetElement);return!0}return!1}Toh(W,Ga=3){const pa=Object.assign(new I,{PersonaType:"User",Upn:W.upn,AadObjectId:W.aadObjectId});return Object.assign(new S,{personaInfo:Object.assign(new J,{identifiers:pa,displayName:W.name,personaCoinColor:W.color}),
behavior:Object.assign(new D,{onCardOpen:()=>{c.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(W.onCardOpen)W.onCardOpen()},onCardClose:W.onCardClose,disableClick:2===Ga||3===Ga,disableHover:0===Ga||3===Ga})})}}Object(u.a)(L,"LivePersonaCardManager",null,[]);class R{constructor(W){this.INg=W}VNi(){const W=v.AFrameworkApplication.oT("midgardbootstrapper.js",5);return this.INg.CCd(W).continueWith(()=>{M.TEe=window.self.MidgardBootstrapper})}}Object(u.a)(R,"LivePersonaCardPackageLoader",
null,[492]);var Y=a(528);class Q{constructor(){this.Db=null}get name(){return"Common.App.LivePersonaCard"}init(){v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.Hv(Object(b.a)(this,this.DC,"onFullAppSettingsReady"))}dispose(){}Di(W){this.Db=W}DC(){let W;W=v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?new B(new R(this.Db.resolve("Common.ISharedDependencyLoader")),null,v.AFrameworkApplication.fa,Y.a.dr(this.Db.qc("Common.ILokiTokenManager"))):
new B(new R(this.Db.resolve("Common.ISharedDependencyLoader")),this.Db.resolve("Common.ILokiTokenManager"),v.AFrameworkApplication.fa);W.init().continueWith(Ga=>{Ga.vg&&Ga.exception?c.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",Ga.exception.message):((Ga=Ga.result)||c.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),Ga.isInitialized?c.ULS.sendTraceTag(50431109,3006,100,"Successfully initialized LivePersonaCard"):
c.ULS.sendTraceTag(595067867,3006,Ga.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",Ga.failureMessage))});(new z(v.AFrameworkApplication.Qb,new L(W))).vh()}static main(){x.a.instance.nj(new Q)}}Object(u.a)(Q,"LivePersonaCardPackage",null,[4,5]);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");t.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");Type.registerNamespace("Common.App.LivePersonaCard");Q.main();Type.registerNamespace("AppRealtimeChannel")}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSOpt.rt.js.map/34ee3bda6bdad86d63377ae9dbbb239b/EwaDSOpt.rt.js.map